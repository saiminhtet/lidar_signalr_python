"use strict";!function(n){"object"==typeof module&&module.exports?module.exports=n.default=n:"function"==typeof define&&define.amd?define("highcharts/modules/sonification",["highcharts"],function(t){return n(t),n.Highcharts=t,n}):n("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var n=t?t._modules:{};function i(t,n,i,e){t.hasOwnProperty(n)||(t[n]=e.apply(null,i))}i(n,"modules/sonification/Instrument.js",[n["parts/Globals.js"],n["parts/Utilities.js"]],function(s,t){var a=t.pick,i={type:"oscillator",playCallbackInterval:20,oscillator:{waveformShape:"sine"}};function n(t){this.init(t)}return n.prototype.init=function(t){var n;this.initAudioContext()?(this.options=s.merge(i,t),this.id=this.options.id=t&&t.id||s.uniqueKey(),n=s.audioContext,this.gainNode=n.createGain(),this.setGain(0),this.panNode=n.createStereoPanner&&n.createStereoPanner(),this.panNode?(this.setPan(0),this.gainNode.connect(this.panNode),this.panNode.connect(n.destination)):this.gainNode.connect(n.destination),"oscillator"===this.options.type&&this.initOscillator(this.options.oscillator),this.playCallbackTimers=[]):s.error(29)},n.prototype.copy=function(t){return new n(s.merge(this.options,{id:null},t))},n.prototype.initAudioContext=function(){var t=s.win.AudioContext||s.win.webkitAudioContext,n=!!s.audioContext;return!!t&&(s.audioContext=s.audioContext||new t,!n&&s.audioContext&&"running"===s.audioContext.state&&s.audioContext.suspend(),!!(s.audioContext&&s.audioContext.createOscillator&&s.audioContext.createGain))},n.prototype.initOscillator=function(t){var n=s.audioContext;this.oscillator=n.createOscillator(),this.oscillator.type=t.waveformShape,this.oscillator.connect(this.gainNode),this.oscillatorStarted=!1},n.prototype.setPan=function(t){this.panNode&&this.panNode.pan.setValueAtTime(t,s.audioContext.currentTime)},n.prototype.setGain=function(t,n){this.gainNode&&(1.2<t&&(console.warn("Highcharts sonification warning: Volume of instrument set too high."),t=1.2),n?(this.gainNode.gain.setValueAtTime(this.gainNode.gain.value,s.audioContext.currentTime),this.gainNode.gain.linearRampToValueAtTime(t,s.audioContext.currentTime+n/1e3)):this.gainNode.gain.setValueAtTime(t,s.audioContext.currentTime))},n.prototype.cancelGainRamp=function(){this.gainNode&&this.gainNode.gain.cancelScheduledValues(0)},n.prototype.getValidFrequency=function(i,t,n){var e=this.options.allowedFrequencies,o=a(n,1/0),s=a(t,-1/0);return e&&e.length?e.reduce(function(t,n){return Math.abs(n-i)<Math.abs(t-i)&&n<o&&s<n?n:t},1/0):i},n.prototype.clearPlayCallbackTimers=function(){this.playCallbackTimers.forEach(function(t){clearInterval(t)}),this.playCallbackTimers=[]},n.prototype.setFrequency=function(t,n){var i=n||{},e=this.getValidFrequency(t,i.min,i.max);"oscillator"===this.options.type&&this.oscillatorPlay(e)},n.prototype.oscillatorPlay=function(t){this.oscillatorStarted||(this.oscillator.start(),this.oscillatorStarted=!0),this.oscillator.frequency.setValueAtTime(t,s.audioContext.currentTime)},n.prototype.preparePlay=function(){this.setGain(.001),"suspended"===s.audioContext.state&&s.audioContext.resume(),this.oscillator&&!this.oscillatorStarted&&(this.oscillator.start(),this.oscillatorStarted=!0)},n.prototype.play=function(t){function n(n,i,e){var o,s=t.duration,a=0,r=l.options.playCallbackInterval;"function"==typeof n?(o=setInterval(function(){var t=++a*r/s;1<=t?(l[i](n(1),e),clearInterval(o)):l[i](n(t),e)},r),l.playCallbackTimers.push(o)):l[i](n,e)}var l=this,i=t.duration||0;if(l.id){if("suspended"===s.audioContext.state||this.oscillator&&!this.oscillatorStarted)return l.preparePlay(),void setTimeout(function(){l.play(t)},10);l.playCallbackTimers.length&&l.clearPlayCallbackTimers(),l.cancelGainRamp(),l.stopOscillatorTimeout&&(clearTimeout(l.stopOscillatorTimeout),delete l.stopOscillatorTimeout),l.stopTimeout&&(clearTimeout(l.stopTimeout),delete l.stopTimeout,l.stopCallback&&(l._play=l.play,l.play=function(){},l.stopCallback("cancelled"),l.play=l._play));var e=i<s.sonification.fadeOutDuration+20;l.stopCallback=t.onEnd;var o=function(){delete l.stopTimeout,l.stop(e)};i?(l.stopTimeout=setTimeout(o,e?i:i-s.sonification.fadeOutDuration),n(t.frequency,"setFrequency",null,(t.minFrequency,t.maxFrequency)),n(a(t.volume,1),"setGain",4),n(a(t.pan,0),"setPan")):o()}},n.prototype.mute=function(){this.setGain(1e-4,.8*s.sonification.fadeOutDuration)},n.prototype.stop=function(t,n,i){function e(){o.stopOscillatorTimeout&&delete o.stopOscillatorTimeout;try{o.oscillator.stop()}catch(t){}o.oscillator.disconnect(o.gainNode),o.initOscillator(o.options.oscillator),n&&n(i),o.stopCallback&&o.stopCallback(i)}var o=this;o.playCallbackTimers.length&&o.clearPlayCallbackTimers(),o.stopTimeout&&clearTimeout(o.stopTimeout),t?(o.setGain(0),e()):(o.mute(),o.stopOscillatorTimeout=setTimeout(e,s.sonification.fadeOutDuration+100))},n}),i(n,"modules/sonification/musicalFrequencies.js",[],function(){return[16.351597831287414,17.323914436054505,18.354047994837977,19.445436482630058,20.601722307054366,21.826764464562746,23.12465141947715,24.499714748859326,25.956543598746574,27.5,29.13523509488062,30.86770632850775,32.70319566257483,34.64782887210901,36.70809598967594,38.890872965260115,41.20344461410875,43.653528929125486,46.2493028389543,48.999429497718666,51.91308719749314,55,58.27047018976124,61.7354126570155,65.40639132514966,69.29565774421802,73.41619197935188,77.78174593052023,82.4068892282175,87.30705785825097,92.4986056779086,97.99885899543733,103.82617439498628,110,116.54094037952248,123.47082531403103,130.8127826502993,138.59131548843604,146.8323839587038,155.56349186104046,164.81377845643496,174.61411571650194,184.9972113558172,195.99771799087463,207.65234878997256,220,233.08188075904496,246.94165062806206,261.6255653005986,277.1826309768721,293.6647679174076,311.1269837220809,329.6275569128699,349.2282314330039,369.9944227116344,391.99543598174927,415.3046975799451,440,466.1637615180899,493.8833012561241,523.2511306011972,554.3652619537442,587.3295358348151,622.2539674441618,659.2551138257398,698.4564628660078,739.9888454232688,783.9908719634985,830.6093951598903,880,932.3275230361799,987.7666025122483,1046.5022612023945,1108.7305239074883,1174.6590716696303,1244.5079348883237,1318.5102276514797,1396.9129257320155,1479.9776908465376,1567.981743926997,1661.2187903197805,1760,1864.6550460723597,1975.533205024496,2093.004522404789,2217.4610478149766,2349.31814333926,2489.0158697766474,2637.02045530296,2793.825851464031,2959.955381693075,3135.9634878539946,3322.437580639561,3520,3729.3100921447194,3951.066410048992,4186.009044809578]}),i(n,"modules/sonification/utilities.js",[n["modules/sonification/musicalFrequencies.js"]],function(t){function n(t){this.init(t||[])}return n.prototype.init=function(t){this.supportedSignals=t,this.signals={}},n.prototype.registerSignalCallbacks=function(n){var i=this;i.supportedSignals.forEach(function(t){n[t]&&(i.signals[t]=i.signals[t]||[]).push(n[t])})},n.prototype.clearSignalCallbacks=function(t){var n=this;t?t.forEach(function(t){n.signals[t]&&delete n.signals[t]}):n.signals={}},n.prototype.emitSignal=function(t,i){var e;return this.signals[t]&&this.signals[t].forEach(function(t){var n=t(i);e=void 0!==n?n:e}),e},{musicalFrequencies:t,SignalHandler:n,getMusicalScale:function(e){return t.filter(function(t,n){var i=n%12+1;return e.some(function(t){return t===i})})},calculateDataExtremes:function(t,e){return t.series.reduce(function(i,t){return t.points.forEach(function(t){var n=void 0!==t[e]?t[e]:t.options[e];i.min=Math.min(i.min,n),i.max=Math.max(i.max,n)}),i},{min:1/0,max:-1/0})},virtualAxisTranslate:function(t,n,i){var e=n.max-n.min,o=i.max-i.min,s=i.min+o*(t-n.min)/e;return 0<e?Math.max(Math.min(s,i.max),i.min):i.min}}}),i(n,"modules/sonification/instrumentDefinitions.js",[n["modules/sonification/Instrument.js"],n["modules/sonification/utilities.js"]],function(n,i){var e={};return["sine","square","triangle","sawtooth"].forEach(function(t){e[t]=new n({oscillator:{waveformShape:t}}),e[t+"Musical"]=new n({allowedFrequencies:i.musicalFrequencies,oscillator:{waveformShape:t}}),e[t+"Major"]=new n({allowedFrequencies:i.getMusicalScale([1,3,5,6,8,10,12]),oscillator:{waveformShape:t}})}),e}),i(n,"modules/sonification/Earcon.js",[n["parts/Globals.js"],n["parts/Utilities.js"]],function(p,t){var m=t.pick;function n(t){this.init(t||{})}return n.prototype.init=function(t){this.options=t,this.options.id||(this.options.id=this.id=p.uniqueKey()),this.instrumentsPlaying={}},n.prototype.sonify=function(t){var n=p.merge(this.options,t),a=m(n.volume,1),r=n.pan,l=this,u=t&&t.onEnd,c=l.options.onEnd;n.instruments.forEach(function(t){var n,i,e,o="string"==typeof t.instrument?p.sonification.instruments[t.instrument]:t.instrument,s=p.merge(t.playOptions);o&&o.play?t.playOptions&&("function"!=typeof t.playOptions.volume&&(s.volume=m(a,1)*m(t.playOptions.volume,1)),s.pan=m(r,s.pan),n=s.onEnd,s.onEnd=function(){delete l.instrumentsPlaying[e],n&&n.apply(this,arguments),Object.keys(l.instrumentsPlaying).length||(u&&u.apply(this,arguments),c&&c.apply(this,arguments))},i=o.copy(),e=i.id,(l.instrumentsPlaying[e]=i).play(s)):p.error(30)})},n.prototype.cancelSonify=function(n){var i=this.instrumentsPlaying,t=i&&Object.keys(i);t&&t.length&&(t.forEach(function(t){i[t].stop(!n,null,"cancelled")}),this.instrumentsPlaying={})},n}),i(n,"modules/sonification/pointSonify.js",[n["parts/Globals.js"],n["parts/Utilities.js"],n["modules/sonification/utilities.js"]],function(u,t,c){var p=t.pick,m={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};return{pointSonify:function(t){function s(n,t,i,e){return"number"==typeof n||void 0===n?n:"function"==typeof n?t?function(t){return n(a,o,t)}:n(a,o):"string"==typeof n?(o[n]=o[n]||c.calculateDataExtremes(a.series.chart,n),c.virtualAxisTranslate(p(a[n],a.options[n]),o[n],i,e)):void 0}var a=this,r=a.series.chart,o=t.dataExtremes||{};(r.sonification.currentlyPlayingPoint=a).sonification=a.sonification||{},a.sonification.instrumentsPlaying=a.sonification.instrumentsPlaying||{};var l=a.sonification.signalHandler=a.sonification.signalHandler||new c.SignalHandler(["onEnd"]);l.clearSignalCallbacks(),l.registerSignalCallbacks({onEnd:t.onEnd}),!a.isNull&&a.visible&&a.series.visible?t.instruments.forEach(function(n){var t="string"==typeof n.instrument?u.sonification.instruments[n.instrument]:n.instrument,i=n.instrumentMapping||{},e=u.merge(m,n.instrumentOptions),o=t.id;t&&t.play?(a.sonification.instrumentsPlaying[t.id]=t).play({frequency:s(i.frequency,!0,{min:e.minFrequency,max:e.maxFrequency}),duration:s(i.duration,!1,{min:e.minDuration,max:e.maxDuration}),pan:s(i.pan,!0,{min:e.minPan,max:e.maxPan}),volume:s(i.volume,!0,{min:e.minVolume,max:e.maxVolume}),onEnd:function(t){n.onEnd&&n.onEnd.apply(this,arguments),r.sonification&&r.sonification.currentlyPlayingPoint&&delete r.sonification.currentlyPlayingPoint,a.sonification&&a.sonification.instrumentsPlaying&&(delete a.sonification.instrumentsPlaying[o],Object.keys(a.sonification.instrumentsPlaying).length||l.emitSignal("onEnd",t))},minFrequency:e.minFrequency,maxFrequency:e.maxFrequency}):u.error(30)}):l.emitSignal("onEnd")},pointCancelSonify:function(n){var i=this.sonification&&this.sonification.instrumentsPlaying,t=i&&Object.keys(i);t&&t.length&&(t.forEach(function(t){i[t].stop(!n,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}}}),i(n,"modules/sonification/chartSonify.js",[n["parts/Globals.js"],n["parts/Utilities.js"],n["modules/sonification/utilities.js"]],function(c,t,p){var m=t.isArray,f=t.pick,h=t.splat;function d(t,n){return"function"==typeof n?n(t):f(t[n],t.options[n])}function y(t,e){return t.points.reduce(function(t,n){var i=d(n,e);return t.min=Math.min(t.min,i),t.max=Math.max(t.max,i),t},{min:1/0,max:-1/0})}function g(o,t,n){return(t||[]).reduce(function(i,e){return Object.keys(e.instrumentMapping||{}).forEach(function(t){var n=e.instrumentMapping[t];"string"!=typeof n||i[n]||(i[n]=p.calculateDataExtremes(o,n))}),i},c.merge(n))}function r(t,a){var r=a.timeExtremes||y(t,a.pointPlayTime,a.dataExtremes),l=g(t.chart,a.instruments,a.dataExtremes),u=a.instruments.map(function(t){var n=t.instrument,i=("string"==typeof n?c.sonification.instruments[n]:n).copy();return c.merge(t,{instrument:i})}),n=t.points.reduce(function(t,n){var i,o,e=(o=n,(a.earcons||[]).reduce(function(t,n){var i,e=n.earcon;return n.condition?(i=n.condition(o))instanceof c.sonification.Earcon?t.push(i):i&&t.push(e):n.onPoint&&o.id===n.onPoint&&t.push(e),t},[])),s=(i=n,p.virtualAxisTranslate(d(i,a.pointPlayTime),r,{min:0,max:a.duration}));return t.concat(new c.sonification.TimelineEvent({eventObject:n,time:s,id:n.id,playOptions:{instruments:u,dataExtremes:l}}),e.map(function(t){return new c.sonification.TimelineEvent({eventObject:t,time:s})}))},[]);return new c.sonification.TimelinePath({events:n,onStart:function(){a.onStart&&a.onStart(t)},onEventStart:function(t){var n=t.options&&t.options.eventObject;if(n instanceof c.Point){if(!n.series.visible&&!n.series.chart.series.some(function(t){return t.visible}))return t.timelinePath.timeline.pause(),t.timelinePath.timeline.resetCursor(),!1;a.onPointStart&&a.onPointStart(t,n)}},onEventEnd:function(t){var n=t.event&&t.event.options&&t.event.options.eventObject;n instanceof c.Point&&a.onPointEnd&&a.onPointEnd(t.event,n)},onEnd:function(){a.onEnd&&a.onEnd(t)}})}function v(t,n){var s=Math.max(n-t.reduce(function(t,n){var i=h(n);return t+(1===i.length&&i[0].options&&i[0].options.silentWait||0)},0),0),a=t.reduce(function(t,n){return t+h(n).reduce(function(t,n){var i=n.series&&n.seriesOptions&&n.seriesOptions.timeExtremes;return i?Math.max(t,i.max-i.min):t},0)},0);return t.reduce(function(t,n){var i=h(n).reduce(function(t,n){var i,e,o;return n instanceof c.sonification.TimelinePath?t.push(n):n.series&&(n.seriesOptions.duration=n.seriesOptions.duration||(i=n.seriesOptions.timeExtremes.max-n.seriesOptions.timeExtremes.min,e=a,o=s,p.virtualAxisTranslate(i,{min:0,max:e},{min:0,max:o})),t.push(r(n.series,n.seriesOptions))),t},[]);return t.push(i),t},[])}return{chartSonify:function(s){this.sonification.timeline&&this.sonification.timeline.pause();var t,o,a,n,r,l,u=g(this,s.instruments,s.dataExtremes),i=(t=s.order,o=this,a=function(t){return n=t,i=u,o=(e=s).seriesOptions||{},c.merge({dataExtremes:i,timeExtremes:y(n,e.pointPlayTime),instruments:e.instruments,onStart:e.onSeriesStart,onEnd:e.onSeriesEnd,earcons:e.earcons},m(o)?c.find(o,function(t){return t.id===f(n.id,n.options.id)})||{}:o,{pointPlayTime:e.pointPlayTime});var n,i,e,o},"sequential"===t||"simultaneous"===t?(n=o.series.reduce(function(t,n){return n.visible&&t.push({series:n,seriesOptions:a(n)}),t},[]),"simultaneous"===t&&(n=[n])):n=t.reduce(function(t,n){var i=h(n).reduce(function(t,n){var i,e;return"string"==typeof n?(e=o.get(n)).visible&&(i={series:e,seriesOptions:a(e)}):n instanceof c.sonification.Earcon&&(i=new c.sonification.TimelinePath({events:[new c.sonification.TimelineEvent({eventObject:n})]})),n.silentWait&&(i=new c.sonification.TimelinePath({silentWait:n.silentWait})),i&&t.push(i),t},[]);return i.length&&t.push(i),t},[]),n);r=i;var e=v(i=(l=s.afterSeriesWait||0)?r.reduce(function(t,n,i){var e=h(n);return t.push(e),i<r.length-1&&e.some(function(t){return t.series})&&t.push(new c.sonification.TimelinePath({silentWait:l})),t},[]):r,s.duration);e.forEach(function(t){var n,o;o=(n=t).reduce(function(t,n){var i=n.events;return i&&i.length&&(t.min=Math.min(i[0].time,t.min),t.max=Math.max(i[i.length-1].time,t.max)),t},{min:1/0,max:-1/0}),n.forEach(function(t){var n=t.events,i=n&&n.length,e=[];i&&n[0].time<=o.min||e.push(new c.sonification.TimelineEvent({time:o.min})),i&&n[n.length-1].time>=o.max||e.push(new c.sonification.TimelineEvent({time:o.max})),e.length&&t.addTimelineEvents(e)})}),this.sonification.timeline=new c.sonification.Timeline({paths:e,onEnd:s.onEnd}),this.sonification.timeline.play()},seriesSonify:function(t){var n=r(this,t),i=this.chart.sonification;i.timeline&&i.timeline.pause(),i.timeline=new c.sonification.Timeline({paths:[n]}),i.timeline.play()},pause:function(t){this.sonification.timeline?this.sonification.timeline.pause(f(t,!0)):this.sonification.currentlyPlayingPoint&&this.sonification.currentlyPlayingPoint.cancelSonify(t)},resume:function(t){this.sonification.timeline&&this.sonification.timeline.play(t)},rewind:function(t){this.sonification.timeline&&this.sonification.timeline.rewind(t)},cancel:function(t){this.pauseSonify(t),this.resetSonifyCursor()},getCurrentPoints:function(){var n;return this.sonification.timeline?(n=this.sonification.timeline.getCursor(),Object.keys(n).map(function(t){return n[t].eventObject}).filter(function(t){return t instanceof c.Point})):[]},setCursor:function(t){var n=this.sonification.timeline;n&&h(t).forEach(function(t){n.setCursor(t.id)})},resetCursor:function(){this.sonification.timeline&&this.sonification.timeline.resetCursor()},resetCursorEnd:function(){this.sonification.timeline&&this.sonification.timeline.resetCursorEnd()}}}),i(n,"modules/sonification/Timeline.js",[n["parts/Globals.js"],n["parts/Utilities.js"],n["modules/sonification/utilities.js"]],function(c,t,n){var p=t.splat;function i(t){this.init(t||{})}function e(t){this.init(t)}function o(t){this.init(t||{})}return i.prototype.init=function(t){this.options=t,this.time=t.time||0,this.id=this.options.id=t.id||c.uniqueKey()},i.prototype.play=function(t){var n=this.options.eventObject,i=this.options.onEnd,e=t&&t.onEnd,o=this.options.playOptions&&this.options.playOptions.onEnd,s=c.merge(this.options.playOptions,t);n&&n.sonify?(s.onEnd=i||e||o?function(){var n=arguments;[i,e,o].forEach(function(t){t&&t.apply(this,n)})}:void 0,n.sonify(s)):(e&&e(),i&&i())},i.prototype.cancel=function(t){this.options.eventObject.cancelSonify(t)},e.prototype.init=function(t){this.options=t,this.id=this.options.id=t.id||c.uniqueKey(),this.cursor=0,this.eventsPlaying={},this.events=t.silentWait?[new i({time:0}),new i({time:t.silentWait})]:this.options.events,this.sortEvents(),this.updateEventIdMap(),this.signalHandler=new n.SignalHandler(["playOnEnd","masterOnEnd","onStart","onEventStart","onEventEnd"]),this.signalHandler.registerSignalCallbacks(c.merge(t,{masterOnEnd:t.onEnd}))},e.prototype.sortEvents=function(){this.events=this.events.sort(function(t,n){return t.time-n.time})},e.prototype.updateEventIdMap=function(){this.eventIdMap=this.events.reduce(function(t,n,i){return t[n.id]=i,t},{})},e.prototype.addTimelineEvents=function(t){this.events=this.events.concat(t),this.sortEvents(),this.updateEventIdMap()},e.prototype.getCursor=function(){return this.events[this.cursor]},e.prototype.setCursor=function(t){var n=this.eventIdMap[t];return void 0!==n&&(this.cursor=n,!0)},e.prototype.play=function(t){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playEvents(1)},e.prototype.rewind=function(t){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playEvents(-1)},e.prototype.resetCursor=function(){this.cursor=0},e.prototype.resetCursorEnd=function(){this.cursor=this.events.length-1},e.prototype.pause=function(n){var i=this;clearTimeout(i.nextScheduledPlay),Object.keys(i.eventsPlaying).forEach(function(t){i.eventsPlaying[t]&&i.eventsPlaying[t].cancel(n)}),i.eventsPlaying={}},e.prototype.playEvents=function(t){function i(t){e.signalHandler.emitSignal("masterOnEnd",t),e.signalHandler.emitSignal("playOnEnd",t)}var n,e=this,o=e.events[this.cursor],s=e.events[this.cursor+t];!1!==(o.timelinePath=e).signalHandler.emitSignal("onEventStart",o)?((e.eventsPlaying[o.id]=o).play({onEnd:function(t){var n={event:o,cancelled:!!t};delete e.eventsPlaying[o.id],e.signalHandler.emitSignal("onEventEnd",n),s||i(n)}}),s&&((n=Math.abs(s.time-o.time))<1?(e.cursor+=t,e.playEvents(t)):this.nextScheduledPlay=setTimeout(function(){e.cursor+=t,e.playEvents(t)},n))):i({event:o,cancelled:!0})},o.prototype.init=function(t){this.options=t,this.cursor=0,this.paths=t.paths,this.pathsPlaying={},this.signalHandler=new n.SignalHandler(["playOnEnd","masterOnEnd","onPathStart","onPathEnd"]),this.signalHandler.registerSignalCallbacks(c.merge(t,{masterOnEnd:t.onEnd}))},o.prototype.play=function(t){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playPaths(1)},o.prototype.rewind=function(t){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playPaths(-1)},o.prototype.playPaths=function(o){var s=p(this.paths[this.cursor]),a=this.paths[this.cursor+o],r=this,l=this.signalHandler,u=0;s.forEach(function(t){t&&(t.timeline=r,setTimeout(function(){var e;e=t,l.emitSignal("onPathStart",e),(r.pathsPlaying[e.id]=e)[0<o?"play":"rewind"](function(t){var n=t&&t.cancelled,i={path:e,cancelled:n};delete r.pathsPlaying[e.id],l.emitSignal("onPathEnd",i),++u>=s.length&&(a&&!n?(r.cursor+=o,p(a).forEach(function(t){t[0<o?"resetCursor":"resetCursorEnd"]()}),r.playPaths(o)):(l.emitSignal("playOnEnd",i),l.emitSignal("masterOnEnd",i)))})},c.sonification.fadeOutTime))})},o.prototype.pause=function(n){var i=this;Object.keys(i.pathsPlaying).forEach(function(t){i.pathsPlaying[t]&&i.pathsPlaying[t].pause(n)}),i.pathsPlaying={}},o.prototype.resetCursor=function(){this.paths.forEach(function(t){p(t).forEach(function(t){t.resetCursor()})}),this.cursor=0},o.prototype.resetCursorEnd=function(){this.paths.forEach(function(t){p(t).forEach(function(t){t.resetCursorEnd()})}),this.cursor=this.paths.length-1},o.prototype.setCursor=function(n){return this.paths.some(function(t){return p(t).some(function(t){return t.setCursor(n)})})},o.prototype.getCursor=function(){return this.getCurrentPlayingPaths().reduce(function(t,n){return t[n.id]=n.getCursor(),t},{})},o.prototype.atStart=function(){return!this.getCurrentPlayingPaths().some(function(t){return t.cursor})},o.prototype.getCurrentPlayingPaths=function(){return p(this.paths[this.cursor])},{TimelineEvent:i,TimelinePath:e,Timeline:o}}),i(n,"modules/sonification/sonification.js",[n["parts/Globals.js"],n["parts/Utilities.js"],n["modules/sonification/Instrument.js"],n["modules/sonification/instrumentDefinitions.js"],n["modules/sonification/Earcon.js"],n["modules/sonification/pointSonify.js"],n["modules/sonification/chartSonify.js"],n["modules/sonification/utilities.js"],n["modules/sonification/Timeline.js"]],function(t,n,i,e,o,s,a,r,l){var u=n.extend;t.sonification={fadeOutDuration:20,utilities:r,Instrument:i,instruments:e,Earcon:o,TimelineEvent:l.TimelineEvent,TimelinePath:l.TimelinePath,Timeline:l.Timeline},t.Point.prototype.sonify=s.pointSonify,t.Point.prototype.cancelSonify=s.pointCancelSonify,t.Series.prototype.sonify=a.seriesSonify,u(t.Chart.prototype,{sonify:a.chartSonify,pauseSonify:a.pause,resumeSonify:a.resume,rewindSonify:a.rewind,cancelSonify:a.cancel,getCurrentSonifyPoints:a.getCurrentPoints,setSonifyCursor:a.setCursor,resetSonifyCursor:a.resetCursor,resetSonifyCursorEnd:a.resetCursorEnd,sonification:{}})}),i(n,"masters/modules/sonification.src.js",[],function(){})});