"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/series-label",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var e=t?t._modules:{};function o(t,e,o,r){t.hasOwnProperty(e)||(t[e]=r.apply(null,o))}o(e,"modules/series-label.src.js",[e["parts/Globals.js"],e["parts/Utilities.js"]],function(k,t){var z=t.extend,M=t.isNumber,E=t.pick,e=t.syncTimeout,o=k.addEvent,r=k.Series,i=k.SVGRenderer,a=k.Chart;function s(t,e,o,r,i,a){var h=(a-e)*(o-t)-(r-e)*(i-t);return 0<h||!(h<0)}function l(t,e,o,r,i,a,h,n){return s(t,e,i,a,h,n)!==s(o,r,i,a,h,n)&&s(t,e,o,r,i,a)!==s(t,e,o,r,h,n)}function Y(t,e,o,r,i,a,h,n){return l(t,e,t+o,e,i,a,h,n)||l(t+o,e,t+o,e+r,i,a,h,n)||l(t,e+r,t+o,e+r,i,a,h,n)||l(t,e,t,e+r,i,a,h,n)}function h(i){var a=this,h=k.animObject(a.renderer.globalAnimation).duration;a.labelSeries=[],a.labelSeriesMaxSum=0,k.clearTimeout(a.seriesLabelTimer),a.series.forEach(function(t){var e=t.options.label,o=t.labelBySeries,r=o&&o.closest;e.enabled&&t.visible&&(t.graph||t.area)&&!t.isSeriesBoosting&&(a.labelSeries.push(t),e.minFontSize&&e.maxFontSize&&(t.sum=t.yData.reduce(function(t,e){return(t||0)+(e||0)},0),a.labelSeriesMaxSum=Math.max(a.labelSeriesMaxSum,t.sum)),"load"===i.type&&(h=Math.max(h,k.animObject(t.options.animation).duration)),r&&(void 0!==r[0].plotX?o.animate({x:r[0].plotX+r[1],y:r[0].plotY+r[2]}):o.attr({opacity:0})))}),a.seriesLabelTimer=e(function(){a.series&&a.labelSeries&&a.drawSeriesLabels()},a.renderer.forExport||!h?0:h)}k.setOptions({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!1,connectorNeighbourDistance:24,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),i.prototype.symbols.connector=function(t,e,o,r,i){var a,h,n=i&&i.anchorX,s=i&&i.anchorY,l=o/2;return M(n)&&M(s)&&(a=["M",n,s],(h=e-s)<0&&(h=-r-h),h<o&&(l=n<t+o/2?h:o-h),e+r<s?a.push("L",t+l,e+r):s<e?a.push("L",t+l,e):n<t?a.push("L",t,e+r/2):t+o<n&&a.push("L",t+o,e+r/2)),a||[]},r.prototype.getPointsOnGraph=function(){if(this.xAxis||this.yAxis){var t,e,o,r,i,a,h,n,s,l,c=this.points,p=[],d=this.graph||this.area,u=d.element,x=this.chart.inverted,b=this.xAxis,f=this.yAxis,g=x?f.pos:b.pos,m=x?b.pos:f.pos,y=E(this.options.label.onArea,!!this.area),Y=f.getThreshold(this.options.threshold),X={};if(this.getPointSpline&&u.getPointAtLength&&!y&&c.length<this.chart.plotSizeX/16){for(d.toD&&(l=d.attr("d"),d.attr({d:d.toD})),h=u.getTotalLength(),o=0;o<h;o+=16)w({chartX:g+(t=u.getPointAtLength(o)).x,chartY:m+t.y,plotX:t.x,plotY:t.y});l&&d.attr({d:l}),(t=c[c.length-1]).chartX=g+t.plotX,t.chartY=m+t.plotY,w(t)}else for(h=c.length,o=0;o<h;o+=1){if(t=c[o],e=c[o-1],t.chartX=g+t.plotX,t.chartY=m+t.plotY,y&&(t.chartCenterY=m+(t.plotY+E(t.yBottom,Y))/2),0<o&&(r=Math.abs(t.chartX-e.chartX),i=Math.abs(t.chartY-e.chartY),16<(a=Math.max(r,i))))for(n=Math.ceil(a/16),s=1;s<n;s+=1)w({chartX:e.chartX+(t.chartX-e.chartX)*(s/n),chartY:e.chartY+(t.chartY-e.chartY)*(s/n),chartCenterY:e.chartCenterY+(t.chartCenterY-e.chartCenterY)*(s/n),plotX:e.plotX+(t.plotX-e.plotX)*(s/n),plotY:e.plotY+(t.plotY-e.plotY)*(s/n)});M(t.plotY)&&w(t)}return p}function w(t){var e=Math.round(t.plotX/8)+","+Math.round(t.plotY/8);X[e]||(X[e]=1,p.push(t))}},r.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},r.prototype.checkClearPoint=function(t,e,o,r){var i,a,h,n,s,l,c,p,d,u,x,b=Number.MAX_VALUE,f=Number.MAX_VALUE,g=E(this.options.label.onArea,!!this.area),m=g||this.options.label.connectorAllowed,y=this.chart;for(p=0;p<y.boxesToAvoid.length;p+=1)if(u=y.boxesToAvoid[p],!((x={left:t,right:t+o.width,top:e,bottom:e+o.height}).left>u.right||x.right<u.left||x.top>u.bottom||x.bottom<u.top))return!1;for(p=0;p<y.series.length;p+=1)if(n=(h=y.series[p]).interpolatedPoints,h.visible&&n){for(d=1;d<n.length;d+=1){if(n[d].chartX>=t-16&&n[d-1].chartX<=t+o.width+16){if(Y(t,e,o.width,o.height,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))return!1;this===h&&!s&&r&&(s=Y(t-16,e-16,o.width+32,o.height+32,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))}!m&&!s||this===h&&!g||(l=t+o.width/2-n[d].chartX,c=e+o.height/2-n[d].chartY,b=Math.min(b,l*l+c*c))}if(!g&&m&&this===h&&(r&&!s||b<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(d=1;d<n.length;d+=1)(i=Math.min(Math.pow(t+o.width/2-n[d].chartX,2)+Math.pow(e+o.height/2-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2)))<f&&(f=i,a=n[d]);s=!0}}return!(r&&!s)&&{x:t,y:e,weight:b-(a?f:0),connectorPoint:a}},a.prototype.drawSeriesLabels=function(){var T=this,t=this.labelSeries;T.boxesToAvoid=[],t.forEach(function(t){t.interpolatedPoints=t.getPointsOnGraph(),(t.options.label.boxesToAvoid||[]).forEach(function(t){T.boxesToAvoid.push(t)})}),T.series.forEach(function(t){if(t.xAxis||t.yAxis){var e,o,r,i,a,h,n,s,l,c,p,d,u,x=[],b=t.options.label,f=T.inverted,g=f?t.yAxis.pos:t.xAxis.pos,m=f?t.xAxis.pos:t.yAxis.pos,y=T.inverted?t.yAxis.len:t.xAxis.len,Y=T.inverted?t.xAxis.len:t.yAxis.len,X=t.interpolatedPoints,w=E(b.onArea,!!t.area),M=t.labelBySeries,A=!M,S=b.minFontSize,v=b.maxFontSize,P="highcharts-color-"+E(t.colorIndex,"none");if(w&&!f&&(n=[t.xAxis.toPixels(t.xData[0]),t.xAxis.toPixels(t.xData[t.xData.length-1])],s=Math.min.apply(Math,n),l=Math.max.apply(Math,n)),t.visible&&!t.isSeriesBoosting&&X){for(M||(t.labelBySeries=M=T.renderer.label(t.name,0,-9999,"connector").addClass("highcharts-series-label highcharts-series-label-"+t.index+" "+(t.options.className||"")+P),T.renderer.styledMode||M.css(z({color:w?T.renderer.getContrast(t.color):t.color},t.options.label.style)),S&&v&&M.css({fontSize:t.labelFontSize(S,v)}),M.attr({padding:0,opacity:T.renderer.forExport?1:0,stroke:t.color,"stroke-width":1,zIndex:3}).add()),(e=M.getBBox()).width=Math.round(e.width),a=X.length-1;0<a;--a)w?C(o=X[a].chartX-e.width/2,r=X[a].chartCenterY-e.height/2,e)&&(h=t.checkClearPoint(o,r,e)):(C(o=X[a].chartX+3,r=X[a].chartY-e.height-3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&x.push(h),C(o=X[a].chartX+3,r=X[a].chartY+3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&x.push(h),C(o=X[a].chartX-e.width-3,r=X[a].chartY+3,e)&&(h=t.checkClearPoint(o,r,e,!0)),h&&x.push(h),C(o=X[a].chartX-e.width-3,r=X[a].chartY-e.height-3,e)&&(h=t.checkClearPoint(o,r,e,!0))),h&&x.push(h);if(b.connectorAllowed&&!x.length&&!w)for(o=g+y-e.width;g<=o;o-=16)for(r=m;r<m+Y-e.height;r+=16)(i=t.checkClearPoint(o,r,e,!0))&&x.push(i);x.length?(x.sort(function(t,e){return e.weight-t.weight}),h=x[0],T.boxesToAvoid.push({left:h.x,right:h.x+e.width,top:h.y,bottom:h.y+e.height}),(c=Math.sqrt(Math.pow(Math.abs(h.x-M.x),2),Math.pow(Math.abs(h.y-M.y),2)))&&(p={opacity:T.renderer.forExport?1:0,x:h.x,y:h.y},d={opacity:1},c<=10&&(d={x:p.x,y:p.y},p={}),t.labelBySeries.attr(z(p,{anchorX:h.connectorPoint&&h.connectorPoint.plotX+g,anchorY:h.connectorPoint&&h.connectorPoint.plotY+m})).animate(d,A?.2*k.animObject(t.options.animation).duration:T.renderer.globalAnimation),t.options.kdNow=!0,t.buildKDTree(),u=t.searchPoint({chartX:h.x,chartY:h.y},!0),M.closest=[u,h.x-u.plotX,h.y-u.plotY])):L()}else L()}function C(t,e,o){var r=Math.max(g,E(s,-1/0)),i=Math.min(g+y,E(l,1/0));return r<t&&t<=i-o.width&&m<=e&&e<=m+Y-o.height}function L(){M&&(t.labelBySeries=M.destroy())}}),k.fireEvent(T,"afterDrawSeriesLabels")},o(a,"load",h),o(a,"redraw",h)}),o(e,"masters/modules/series-label.src.js",[],function(){})});