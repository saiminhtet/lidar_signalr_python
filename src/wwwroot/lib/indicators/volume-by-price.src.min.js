"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){var t=e?e._modules:{};function o(e,t,o,s){e.hasOwnProperty(t)||(e[t]=s.apply(null,o))}o(t,"indicators/volume-by-price.src.js",[t["parts/Globals.js"],t["parts/Utilities.js"]],function(u,e){var x=e.arrayMax,m=e.arrayMin,s=e.extend,d=e.isArray;var b=Math.abs,t=u.noop,i=u.addEvent,V=u.correctFloat,o=u.seriesType,S=u.seriesTypes.column.prototype;o("vbp","sma",{params:{ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}},{nameBase:"Volume by Price",bindTo:{series:!1,eventName:"afterSetExtremes"},calculateOn:"render",markerAttribs:t,drawGraph:t,getColumnMetrics:S.getColumnMetrics,crispCol:S.crispCol,init:function(e){var t,o,s,i=this;return u.seriesTypes.sma.prototype.init.apply(i,arguments),t=i.options.params,o=i.linkedParent,s=e.get(t.volumeSeriesID),i.addCustomEvents(o,s),i},addCustomEvents:function(e,t){var o=this;function s(){o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG.destroy(),delete o.zoneLinesSVG)}return o.dataEventsToUnbind.push(i(e,"remove",function(){s()})),t&&o.dataEventsToUnbind.push(i(t,"remove",function(){s()})),o},animate:function(e){var o=this,t={};u.svg&&!e&&(t.translateX=o.yAxis.pos,o.group.animate(t,s(u.animObject(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})),o.animate=null)},drawPoints:function(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),S.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),S.drawPoints.apply(e,arguments)},posNegVolume:function(e,t){var o,s,i,n,a=this,r=t?["positive","negative"]:["negative","positive"],l=a.options.volumeDivision,p=a.points.length,h=[],u=[],d=0;for(e?(a.posWidths=h,a.negWidths=u):(h=a.posWidths,u=a.negWidths);d<p;d++)(n=a.points[d])[r[0]+"Graphic"]=n.graphic,n.graphic=n[r[1]+"Graphic"],e&&(o=n.shapeArgs.width,(i=(s=a.priceZones[d]).wholeVolumeData)?(h.push(o/i*s.positiveVolumeData),u.push(o/i*s.negativeVolumeData)):(h.push(0),u.push(0))),n.color=t?l.styles.positiveColor:l.styles.negativeColor,n.shapeArgs.width=t?a.posWidths[d]:a.negWidths[d],n.shapeArgs.x=t?n.shapeArgs.x:a.posWidths[d]},translate:function(){var e,t,o,s,i,n,a,r,l,p,h,u,d=this,c=d.options,m=d.chart,v=d.yAxis,g=v.min,f=d.options.zoneLines,y=d.priceZones,D=0;S.translate.apply(d),(e=d.points).length&&(l=c.pointPadding<.5?c.pointPadding:.1,t=d.volumeDataArray,o=x(t),s=m.plotWidth/2,p=m.plotTop,i=b(v.toPixels(g)-v.toPixels(g+d.rangeStep)),a=b(v.toPixels(g)-v.toPixels(g+d.rangeStep)),l&&(n=b(i*(1-2*l)),D=b((i-n)/2),i=b(n)),e.forEach(function(e,t){h=e.barX=e.plotX=0,u=e.plotY=v.toPixels(y[t].start)-p-(v.reversed?i-a:i)-D,r=V(s*y[t].wholeVolumeData/o),e.pointWidth=r,e.shapeArgs=d.crispCol.apply(d,[h,u,r,i]),e.volumeNeg=y[t].negativeVolumeData,e.volumePos=y[t].positiveVolumeData,e.volumeAll=y[t].wholeVolumeData}),f.enabled&&d.drawZones(m,v,d.zoneStarts,f.styles))},getValues:function(e,t){var o,s,i=e.processedXData,n=e.processedYData,a=this.chart,r=t.ranges,l=[],p=[],h=[];return e.chart?(s=a.get(t.volumeSeriesID))?(o=d(n[0]))&&4!==n[0].length?u.error("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,a):((this.priceZones=this.specifyZones(o,i,n,r,s)).forEach(function(e,t){l.push([e.x,e.end]),p.push(l[t][0]),h.push(l[t][1])}),{values:l,xData:p,yData:h}):u.error("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,a):u.error("Base series not found! In case it has been removed, add a new one.",!0,a)},specifyZones:function(e,t,o,s,i){var n,a,r=!!e&&function(e){for(var t,o=e.length,s=e[0][3],i=s,n=1;n<o;n++)(t=e[n][3])<s&&(s=t),i<t&&(i=t);return{min:s,max:i}}(o),l=r?r.min:m(o),p=r?r.max:x(o),h=this.zoneStarts=[],u=[],d=0,c=1;if(!l||!p)return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG.destroy()),[];for(n=this.rangeStep=V(p-l)/s,h.push(l);d<s-1;d++)h.push(V(h[d]+n));for(h.push(p),a=h.length;c<a;c++)u.push({index:c-1,x:t[0],start:h[c-1],end:h[c]});return this.volumePerZone(e,u,i,t,o)},volumePerZone:function(t,e,o,s,i){var n,a,r,l,p,h=this,u=o.processedXData,d=o.processedYData,c=e.length-1,m=i.length,v=d.length;return b(m-v)&&(s[0]!==u[0]&&d.unshift(0),s[m-1]!==u[v-1]&&d.push(0)),h.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,p=0;p<m;p++)r=a=!1,l=t?i[p][3]:i[p],n=p?t?i[p-1][3]:i[p-1]:l,l<=e.start&&0===e.index&&(a=!0),l>=e.end&&e.index===c&&(r=!0),(l>e.start||a)&&(l<e.end||r)&&(e.wholeVolumeData+=d[p],l<n?e.negativeVolumeData+=d[p]:e.positiveVolumeData+=d[p]);h.volumeDataArray.push(e.wholeVolumeData)}),e},drawZones:function(t,o,e,s){var i,n=t.renderer,a=this.zoneLinesSVG,r=[],l=t.plotWidth,p=t.plotTop;e.forEach(function(e){i=o.toPixels(e)-p,r=r.concat(t.renderer.crispLine(["M",0,i,"L",l,i],s.lineWidth))}),a?a.animate({d:r}):a=this.zoneLinesSVG=n.path(r).attr({"stroke-width":s.lineWidth,stroke:s.color,dashstyle:s.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}},{destroy:function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),u.Point.prototype.destroy.apply(this,arguments)}})}),o(t,"masters/indicators/volume-by-price.src.js",[],function(){})});