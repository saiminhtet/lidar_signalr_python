import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var objectEach=U.objectEach,pick=U.pick,fireEvent=H.fireEvent,eventEmitterMixin={addEvents:function(){var t=this;objectEach(t.options.events,function(e,r){var a=function(a){"click"===r&&t.cancelClick||e.call(t,t.chart.pointer.normalize(a),t.target)};-1===H.inArray(r,t.nonDOMEvents||[])?t.graphic.on(r,a):H.addEvent(t,r,a)}),t.options.draggable&&(H.addEvent(t.graphic.element,"mousedown",function(e){t.onMouseDown(e)}),H.addEvent(t,"drag",t.onDrag),t.graphic.renderer.styledMode||t.graphic.css({cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[t.options.draggable]})),t.isUpdating||fireEvent(t,"add")},removeDocEvents:function(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())},onMouseDown:function(t){var e,r,a=this,n=a.chart.pointer;t.preventDefault&&t.preventDefault(),2!==t.button&&(t=n.normalize(t),e=t.chartX,r=t.chartY,a.cancelClick=!1,a.chart.hasDraggedAnnotation=!0,a.removeDrag=H.addEvent(H.doc,"mousemove",function(t){a.hasDragged=!0,(t=n.normalize(t)).prevChartX=e,t.prevChartY=r,fireEvent(a,"drag",t),e=t.chartX,r=t.chartY}),a.removeMouseUp=H.addEvent(H.doc,"mouseup",function(t){a.cancelClick=a.hasDragged,a.hasDragged=!1,a.chart.hasDraggedAnnotation=!1,fireEvent(pick(a.target,a),"afterUpdate"),a.onMouseUp(t)}))},onMouseUp:function(){var t=this.chart,e=this.target||this,r=t.options.annotations,a=t.annotations.indexOf(e);this.removeDocEvents(),r[a]=e.options},onDrag:function(t){if(this.chart.isInsidePlot(t.chartX-this.chart.plotLeft,t.chartY-this.chart.plotTop)){var e=this.mouseMoveToTranslation(t);"x"===this.options.draggable&&(e.y=0),"y"===this.options.draggable&&(e.x=0),this.points.length?this.translate(e.x,e.y):(this.shapes.forEach(function(t){t.translate(e.x,e.y)}),this.labels.forEach(function(t){t.translate(e.x,e.y)})),this.redraw(!1)}},mouseMoveToRadians:function(t,e,r){var a,n=t.prevChartY-r,o=t.prevChartX-e,i=t.chartY-r,s=t.chartX-e;return this.chart.inverted&&(a=o,o=n,n=a,a=s,s=i,i=a),Math.atan2(i,s)-Math.atan2(n,o)},mouseMoveToTranslation:function(t){var e,r=t.chartX-t.prevChartX,a=t.chartY-t.prevChartY;return this.chart.inverted&&(e=a,a=r,r=e),{x:r,y:a}},mouseMoveToScale:function(t,e,r){var a,n=t.prevChartX-e,o=t.prevChartY-r,i=(t.chartX-e||1)/(n||1),s=(t.chartY-r||1)/(o||1);return this.chart.inverted&&(a=s,s=i,i=a),{x:i,y:s}},destroy:function(){this.removeDocEvents(),H.removeEvent(this),this.hcEvents=null}};export default eventEmitterMixin;