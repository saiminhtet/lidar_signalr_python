"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,extend=U.extend,isNumber=U.isNumber,pick=U.pick,pInt=U.pInt;import"../parts/Axis.js";import"../parts/Color.js";import"../parts/Point.js";import"../parts/Series.js";import"../parts/ScatterSeries.js";import"./BubbleLegend.js";var Axis=H.Axis,color=H.color,noop=H.noop,Point=H.Point,Series=H.Series,seriesType=H.seriesType,seriesTypes=H.seriesTypes;seriesType("bubble","scatter",{dataLabels:{formatter:function(){return this.point.z},inside:!0,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"},{pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",bubblePadding:!0,zoneAxis:"z",directTouch:!0,isBubble:!0,pointAttribs:function(i,t){var a=this.options.marker.fillOpacity,e=Series.prototype.pointAttribs.call(this,i,t);return 1!==a&&(e.fill=color(e.fill).setOpacity(a).get("rgba")),e},getRadii:function(i,t,a){var e,r,s,o=this.zData,n=this.yData,h=a.minPxSize,l=a.maxPxSize,p=[];for(r=0,e=o.length;r<e;r++)s=o[r],p.push(this.getRadius(i,t,h,l,s,n[r]));this.radii=p},getRadius:function(i,t,a,e,r,s){var o=this.options,n="width"!==o.sizeBy,h=o.zThreshold,l=t-i,p=.5;if(null===s||null===r)return null;if(isNumber(r)){if(o.sizeByAbsoluteValue&&(r=Math.abs(r-h),t=l=Math.max(t-h,Math.abs(i-h)),i=0),r<i)return a/2-1;l>0&&(p=(r-i)/l)}return n&&p>=0&&(p=Math.sqrt(p)),Math.ceil(a+p*(e-a))/2},animate:function(i){!i&&this.points.length<this.options.animationLimit&&(this.points.forEach(function(i){var t,a=i.graphic;a&&a.width&&(t={x:a.x,y:a.y,width:a.width,height:a.height},a.attr({x:i.plotX,y:i.plotY,width:1,height:1}),a.animate(t,this.options.animation))},this),this.animate=null)},hasData:function(){return!!this.processedXData.length},translate:function(){var i,t,a,e=this.data,r=this.radii;for(seriesTypes.scatter.prototype.translate.call(this),i=e.length;i--;)t=e[i],a=r?r[i]:0,isNumber(a)&&a>=this.minPxSize/2?(t.marker=extend(t.marker,{radius:a,width:2*a,height:2*a}),t.dlBox={x:t.plotX-a,y:t.plotY-a,width:2*a,height:2*a}):t.shapeArgs=t.plotY=t.dlBox=void 0},alignDataLabel:seriesTypes.column.prototype.alignDataLabel,buildKDTree:noop,applyZones:noop},{haloPath:function(i){return Point.prototype.haloPath.call(this,0===i?0:(this.marker&&this.marker.radius||0)+i)},ttBelow:!1}),Axis.prototype.beforePadding=function(){var i=this,t=this.len,a=this.chart,e=0,r=t,s=this.isXAxis,o=s?"xData":"yData",n=this.min,h={},l=Math.min(a.plotWidth,a.plotHeight),p=Number.MAX_VALUE,m=-Number.MAX_VALUE,u=this.max-n,d=t/u,c=[];this.series.forEach(function(t){var e,r=t.options;!t.bubblePadding||!t.visible&&a.options.chart.ignoreHiddenSeries||(i.allowZoomOutside=!0,c.push(t),s&&(["minSize","maxSize"].forEach(function(i){var t=r[i],a=/%$/.test(t);t=pInt(t),h[i]=a?l*t/100:t}),t.minPxSize=h.minSize,t.maxPxSize=Math.max(h.maxSize,h.minSize),(e=t.zData.filter(isNumber)).length&&(p=pick(r.zMin,Math.min(p,Math.max(arrayMin(e),!1===r.displayNegative?r.zThreshold:-Number.MAX_VALUE))),m=pick(r.zMax,Math.max(m,arrayMax(e))))))}),c.forEach(function(t){var a,h=t[o],l=h.length;if(s&&t.getRadii(p,m,t),u>0)for(;l--;)isNumber(h[l])&&i.dataMin<=h[l]&&h[l]<=i.dataMax&&(a=t.radii?t.radii[l]:0,e=Math.min((h[l]-n)*d-a,e),r=Math.max((h[l]-n)*d+a,r))}),c.length&&u>0&&!this.isLog&&(r-=t,d*=(t+Math.max(0,e)-Math.min(r,t))/t,[["min","userMin",e],["max","userMax",r]].forEach(function(t){void 0===pick(i.options[t[0]],i[t[1]])&&(i[t[0]]+=t[2]/d)}))};