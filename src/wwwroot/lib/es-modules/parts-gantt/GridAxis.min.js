"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var defined=U.defined,erase=U.erase,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick,addEvent=H.addEvent,argsToArray=function(t){return Array.prototype.slice.call(t,1)},dateFormat=H.dateFormat,isObject=function(t){return U.isObject(t,!0)},merge=H.merge,wrap=H.wrap,Chart=H.Chart,Axis=H.Axis,Tick=H.Tick,applyGridOptions=function(t){var i=t.options,e=i&&isObject(i.grid)?i.grid:{},s=i.labels.style.fontSize,n=t.chart.renderer.fontMetrics(s);i.labels||(i.labels={}),i.labels.align=pick(i.labels.align,"center"),t.categories||(i.showLastLabel=!1),t.horiz&&(i.tickLength=e.cellHeight||n.h*(25/11)),t.labelRotation=0,i.labels.rotation=0},axisSide={top:0,right:1,bottom:2,left:3,0:"top",1:"right",2:"bottom",3:"left"};Axis.prototype.isOuterAxis=function(){var t=this,i=t.chart,e=t.columnIndex,s=t.linkedParent&&t.linkedParent.columns||t.columns,n=e?t.linkedParent:t,r=-1,a=0;return i[t.coll].forEach(function(i,e){i.side!==t.side||i.options.isInternal||(a=e,i===n&&(r=e))}),a===r&&(!isNumber(e)||s.length===e)},Axis.prototype.getMaxLabelDimensions=function(t,i){var e={width:0,height:0};return i.forEach(function(i){var s,n=t[i],r=0,a=0;isObject(n)&&(r=(s=isObject(n.label)?n.label:{}).getBBox?s.getBBox().height:0,s.textStr&&!isNumber(s.textPxLength)&&(s.textPxLength=s.getBBox().width),a=isNumber(s.textPxLength)?Math.round(s.textPxLength):0,e.height=Math.max(r,e.height),e.width=Math.max(a,e.width))}),e},H.dateFormats.W=function(t){var i,e=new Date(t);return e.setHours(0,0,0,0),e.setDate(e.getDate()-(e.getDay()||7)),i=new Date(e.getFullYear(),0,1),Math.ceil(((e-i)/864e5+1)/7)},H.dateFormats.E=function(t){return dateFormat("%a",t,!0).charAt(0)},addEvent(Tick,"afterGetLabelPosition",function(t){var i,e,s,n,r,a,o,h=this.label,d=this.axis,l=d.reversed,c=d.chart,f=d.options,x=f&&isObject(f.grid)?f.grid:{},u=d.options.labels,g=u.align,m=axisSide[d.side],p=t.tickmarkOffset,b=d.tickPositions,k=this.pos-p,A=isNumber(b[t.index+1])?b[t.index+1]-p:d.max+p,v=d.tickSize("tick",!0),O=isArray(v)?v[0]:0,y=v&&v[1]/2;!0===x.enabled&&("top"===m?r=(n=d.top+d.offset)-O:"bottom"===m?n=(r=c.chartHeight-d.bottom+d.offset)+O:(n=d.top+d.len-d.translate(l?A:k),r=d.top+d.len-d.translate(l?k:A)),"right"===m?o=(a=c.chartWidth-d.right+d.offset)+O:"left"===m?a=(o=d.left+d.offset)-O:(a=Math.round(d.left+d.translate(l?A:k))-y,o=Math.round(d.left+d.translate(l?k:A))-y),this.slotWidth=o-a,t.pos.x="left"===g?a:"right"===g?o:a+(o-a)/2,t.pos.y=r+(n-r)/2,e=c.renderer.fontMetrics(u.style.fontSize,h.element),i=h.getBBox().height,u.useHTML?t.pos.y+=e.b+-i/2:(s=Math.round(i/e.h),t.pos.y+=(e.b-(e.h-e.f))/2+-(s-1)*e.h/2),t.pos.x+=d.horiz&&u.x||0)}),addEvent(Axis,"afterTickSize",function(t){var i,e=this.maxLabelDimensions,s=this.options;!0===(s&&isObject(s.grid)?s.grid:{}).enabled&&(i=2*Math.abs(this.defaultLeftAxisOptions.labels.x)+(this.horiz?e.height:e.width),isArray(t.tickSize)?t.tickSize[0]=i:t.tickSize=[i])}),addEvent(Axis,"afterGetTitlePosition",function(t){var i=this.options;if(!0===(i&&isObject(i.grid)?i.grid:{}).enabled){var e=this.axisTitle,s=e&&e.getBBox().width,n=this.horiz,r=this.left,a=this.top,o=this.width,h=this.height,d=i.title,l=this.opposite,c=this.offset,f=this.tickSize()||[0],x=d.x||0,u=d.y||0,g=pick(d.margin,n?5:10),m=this.chart.renderer.fontMetrics(d.style&&d.style.fontSize,e).f,p=(n?a+h:r)+(n?1:-1)*(l?-1:1)*(f[0]/2)+(this.side===axisSide.bottom?m:0);t.titlePosition.x=n?r-s/2-g+x:p+(l?o:0)+c+x,t.titlePosition.y=n?p-(l?h:0)+(l?m:-m)/2+c+u:a-g+u}}),wrap(Axis.prototype,"unsquish",function(t){var i=this.options;return!0===(i&&isObject(i.grid)?i.grid:{}).enabled&&this.categories?this.tickInterval:t.apply(this,argsToArray(arguments))}),addEvent(Axis,"afterSetOptions",function(t){var i,e=this.options,s=t.userOptions,n=e&&isObject(e.grid)?e.grid:{};!0===n.enabled&&(i=merge(!0,{className:"highcharts-grid-axis "+(s.className||""),dateTimeLabelFormats:{hour:{list:["%H:%M","%H"]},day:{list:["%A, %e. %B","%a, %e. %b","%E"]},week:{list:["Week %W","W%W"]},month:{list:["%B","%b","%o"]}},grid:{borderWidth:1},labels:{padding:2,style:{fontSize:"13px"}},margin:0,title:{text:null,reserveSpace:!1,rotation:0},units:[["millisecond",[1,10,100]],["second",[1,10]],["minute",[1,5,15]],["hour",[1,6]],["day",[1]],["week",[1]],["month",[1]],["year",null]]},s),"xAxis"===this.coll&&(defined(s.linkedTo)&&!defined(s.tickPixelInterval)&&(i.tickPixelInterval=350),defined(s.tickPixelInterval)||!defined(s.linkedTo)||defined(s.tickPositioner)||defined(s.tickInterval)||(i.tickPositioner=function(t,e){var s=this.linkedParent&&this.linkedParent.tickPositions&&this.linkedParent.tickPositions.info;if(s){var n,r,a,o,h,d=i.units;for(o=0;o<d.length;o++)if(d[o][0]===s.unitName){n=o;break}if(!d[n][1])return;return d[n+1]&&(a=d[n+1][0],r=(d[n+1][1]||[1])[0]),h=H.timeUnits[a],this.tickInterval=h*r,this.getTimeTicks({unitRange:h,count:r,unitName:a},t,e,this.options.startOfWeek)}})),merge(!0,this.options,i),this.horiz&&(e.minPadding=pick(s.minPadding,0),e.maxPadding=pick(s.maxPadding,0)),isNumber(e.grid.borderWidth)&&(e.tickWidth=e.lineWidth=n.borderWidth))}),addEvent(Axis,"afterSetAxisTranslation",function(){var t=this.options,i=t&&isObject(t.grid)?t.grid:{},e=this.tickPositions&&this.tickPositions.info,s=this.userOptions.labels||{};this.horiz&&(!0===i.enabled&&this.series.forEach(function(t){t.options.pointRange=0}),e&&(!1===t.dateTimeLabelFormats[e.unitName].range||e.count>1)&&!defined(s.align)&&(t.labels.align="left",defined(s.x)||(t.labels.x=3)))}),addEvent(Axis,"trimTicks",function(){var t=this.options,i=t&&isObject(t.grid)?t.grid:{},e=this.categories,s=this.tickPositions,n=s[0],r=s[s.length-1],a=this.linkedParent&&this.linkedParent.min,o=this.linkedParent&&this.linkedParent.max,h=a||this.min,d=o||this.max,l=this.tickInterval,c=n<h&&n+l>h,f=r>d&&r-l<d;!0!==i.enabled||e||!this.horiz&&!this.isLinked||(c&&!t.startOnTick&&(s[0]=h),f&&!t.endOnTick&&(s[s.length-1]=d))}),addEvent(Axis,"afterRender",function(){var t,i,e,s,n=this.options,r=n&&isObject(n.grid)?n.grid:{},a=this.chart.renderer;if(!0===r.enabled){if(this.maxLabelDimensions=this.getMaxLabelDimensions(this.ticks,this.tickPositions),this.rightWall&&this.rightWall.destroy(),this.isOuterAxis()&&this.axisLine){var o=n.lineWidth;if(o){var h=this.getLinePath(o);e=h.indexOf("M")+1,s=h.indexOf("L")+1,t=h.indexOf("M")+2,i=h.indexOf("L")+2;var d=(this.tickSize("tick")[0]-1)*(this.side===axisSide.top||this.side===axisSide.left?-1:1);this.horiz?(h[t]=h[t]+d,h[i]=h[i]+d):(h[e]=h[e]+d,h[s]=h[s]+d),this.axisLineExtra?this.axisLineExtra.animate({d:h}):(this.axisLineExtra=a.path(h).attr({zIndex:7}).addClass("highcharts-axis-line").add(this.axisGroup),a.styledMode||this.axisLineExtra.attr({stroke:n.lineColor,"stroke-width":o})),this.axisLine[this.showAxis?"show":"hide"](!0)}}(this.columns||[]).forEach(function(t){t.render()})}});var onGridAxisAfterGetOffset=function(){(this.columns||[]).forEach(function(t){t.getOffset()})},onGridAxisAfterInit=function(){var t=this.chart,i=this.userOptions,e=this.options,s=e&&isObject(e.grid)?e.grid:{};if(s.enabled&&(applyGridOptions(this),wrap(this,"labelFormatter",function(t){var i=this.axis,e=i.tickPositions,s=this.value,n=(i.isLinked?i.linkedParent:i).series[0],r=s===e[0],a=s===e[e.length-1],o=n&&H.find(n.options.data,function(t){return t[i.isXAxis?"x":"y"]===s});return this.isFirst=r,this.isLast=a,this.point=o,t.call(this)})),s.columns)for(var n=this.columns=[],r=this.columnIndex=0;++r<s.columns.length;){var a=merge(i,s.columns[s.columns.length-r-1],{linkedTo:0,type:"category"});delete a.grid.columns;var o=new Axis(this.chart,a,!0);o.isColumn=!0,o.columnIndex=r,erase(t.axes,o),erase(t[this.coll],o),n.push(o)}},onGridAxisAfterSetChartSize=function(){this.axes.forEach(function(t){(t.columns||[]).forEach(function(t){t.setAxisSize(),t.setAxisTranslation()})})},onGridAxisAfterSetScale=function(){(this.columns||[]).forEach(function(t){t.setScale()})},onGridAxisDestroy=function(t){(this.columns||[]).forEach(function(i){i.destroy(t.keepEvents)})},onGridAxisInit=function(t){var i=t.userOptions,e=i&&isObject(i.grid)?i.grid:{};e.enabled&&defined(e.borderColor)&&(i.tickColor=i.lineColor=e.borderColor)},onGridAxisAfterSetOptions=function(t){var i=t.userOptions,e=i&&isObject(i.grid)?i.grid:{},s=e.columns;e.enabled&&s&&merge(!0,this.options,s[s.length-1])},axisEvents={afterGetOffset:onGridAxisAfterGetOffset,afterInit:onGridAxisAfterInit,afterSetOptions:onGridAxisAfterSetOptions,afterSetScale:onGridAxisAfterSetScale,destroy:onGridAxisDestroy,init:onGridAxisInit};Object.keys(axisEvents).forEach(function(t){addEvent(Axis,t,axisEvents[t])}),addEvent(Chart,"afterSetChartSize",onGridAxisAfterSetChartSize);