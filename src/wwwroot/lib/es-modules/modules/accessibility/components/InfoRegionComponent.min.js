"use strict";import H from"../../../parts/Globals.js";import U from"../../../parts/Utilities.js";var extend=U.extend,pick=U.pick;import AccessibilityComponent from"../AccessibilityComponent.js";import A11yUtilities from"../utilities.js";var merge=H.merge,makeHTMLTagFromText=A11yUtilities.makeHTMLTagFromText;H.Chart.prototype.getTypeDescription=function(t){var e=t[0],i=this.series&&this.series[0]||{},a=i.mapTitle,s={numSeries:this.series.length,numPoints:i.points&&i.points.length,chart:this,mapTitle:a};if(!e)return this.langFormat("accessibility.chartTypes.emptyChart",s);if("map"===e)return a?this.langFormat("accessibility.chartTypes.mapTypeDescription",s):this.langFormat("accessibility.chartTypes.unknownMap",s);if(this.types.length>1)return this.langFormat("accessibility.chartTypes.combinationChart",s);var n=this.langFormat("accessibility.seriesTypeDescriptions."+e,{chart:this}),r=this.series&&1===this.series.length?"Single":"Multiple";return(this.langFormat("accessibility.chartTypes."+e+r,s)||this.langFormat("accessibility.chartTypes.default"+r,s))+(n?" "+n:"")};var InfoRegionComponent=function(){};InfoRegionComponent.prototype=new AccessibilityComponent,extend(InfoRegionComponent.prototype,{init:function(){var t=this.chart,e=this;this.addEvent(t,"afterGetTable",function(i){t.options.accessibility.enabled&&(e.tableAnchor.setAttribute("aria-expanded",!0),i.html=i.html.replace("<table ",'<table tabindex="0" summary="'+t.langFormat("accessibility.tableSummary",{chart:t})+'"'))}),this.addEvent(t,"afterViewData",function(t){setTimeout(function(){var e=t&&t.getElementsByTagName("table")[0];e&&e.focus&&e.focus()},300)})},onChartUpdate:function(){var t=this.chart,e=t.options.accessibility,i="highcharts-information-region-"+t.index,a=this.screenReaderRegion=this.screenReaderRegion||this.createElement("div"),s=this.tableHeading=this.tableHeading||this.createElement("h6"),n=this.tableAnchor=this.tableAnchor||this.createElement("a"),r=this.chartHeading=this.chartHeading||this.createElement("h6");if(a.setAttribute("id",i),"all"===e.landmarkVerbosity&&a.setAttribute("role","region"),a.setAttribute("aria-label",t.langFormat("accessibility.screenReaderRegionLabel",{chart:t})),a.innerHTML=e.screenReaderSectionFormatter?e.screenReaderSectionFormatter(t):this.defaultScreenReaderSectionFormatter(t),t.getCSV&&t.options.accessibility.addTableShortcut){var o="highcharts-data-table-"+t.index;n.innerHTML=t.langFormat("accessibility.viewAsDataTable",{chart:t}),n.href="#"+o,n.setAttribute("tabindex","-1"),n.setAttribute("role","button"),n.setAttribute("aria-expanded",!1),n.onclick=t.options.accessibility.onTableAnchorClick||function(){t.viewData()},s.appendChild(n),a.appendChild(s)}r.innerHTML=t.langFormat("accessibility.chartHeading",{chart:t}),r.setAttribute("aria-hidden",!1),t.renderTo.insertBefore(r,t.renderTo.firstChild),t.renderTo.insertBefore(a,t.renderTo.firstChild),this.unhideElementFromScreenReaders(a),merge(!0,r.style,this.hiddenStyle),merge(!0,a.style,this.hiddenStyle)},defaultScreenReaderSectionFormatter:function(){var t=this.chart.options;return this.defaultTypeDescriptionHTML(this.chart)+this.defaultSubtitleHTML(t)+this.defaultCaptionHTML(t)+this.defaultAxisDescriptionHTML("xAxis")+this.defaultAxisDescriptionHTML("yAxis")},defaultCaptionHTML:function(t){var e=t.caption,i=e&&e.text,a=t.accessibility.description||i;return a?makeHTMLTagFromText("div",a):""},defaultAxisDescriptionHTML:function(t){var e=this.getAxesDescription()[t];return e?makeHTMLTagFromText("div",e):""},defaultTypeDescriptionHTML:function(t){return t.types?makeHTMLTagFromText("h5",t.options.accessibility.typeDescription||t.getTypeDescription(t.types)):""},defaultSubtitleHTML:function(t){var e=t.subtitle,i=e&&e.text;return i?makeHTMLTagFromText("div",i):""},getAxesDescription:function(){var t=this.chart,e=this,i=t.xAxis,a=i.length>1||i[0]&&pick(i[0].options.accessibility&&i[0].options.accessibility.enabled,!t.angular&&t.hasCartesianSeries&&t.types.indexOf("map")<0),s=t.yAxis,n=s.length>1||s[0]&&pick(s[0].options.accessibility&&s[0].options.accessibility.enabled,t.hasCartesianSeries&&t.types.indexOf("map")<0),r={};return a&&(r.xAxis=t.langFormat("accessibility.axis.xAxisDescription"+(i.length>1?"Plural":"Singular"),{chart:t,names:t.xAxis.map(function(t){return t.getDescription()}),ranges:t.xAxis.map(function(t){return e.getAxisRangeDescription(t)}),numAxes:i.length})),n&&(r.yAxis=t.langFormat("accessibility.axis.yAxisDescription"+(s.length>1?"Plural":"Singular"),{chart:t,names:t.yAxis.map(function(t){return t.getDescription()}),ranges:t.yAxis.map(function(t){return e.getAxisRangeDescription(t)}),numAxes:s.length})),r},getAxisRangeDescription:function(t){var e=this.chart,i=t.options||{};if(i.accessibility&&void 0!==i.accessibility.rangeDescription)return i.accessibility.rangeDescription;if(t.categories)return e.langFormat("accessibility.axis.rangeCategories",{chart:e,axis:t,numCategories:t.dataMax-t.dataMin+1});if(t.isDatetimeAxis&&(0===t.min||0===t.dataMin)){var a={},s="Seconds";return a.Seconds=(t.max-t.min)/1e3,a.Minutes=a.Seconds/60,a.Hours=a.Minutes/60,a.Days=a.Hours/24,["Minutes","Hours","Days"].forEach(function(t){a[t]>2&&(s=t)}),a.value=a[s].toFixed("Seconds"!==s&&"Minutes"!==s?1:0),e.langFormat("accessibility.axis.timeRange"+s,{chart:e,axis:t,range:a.value.replace(".0","")})}var n=e.options.accessibility;return e.langFormat("accessibility.axis.rangeFromTo",{chart:e,axis:t,rangeFrom:t.isDatetimeAxis?e.time.dateFormat(n.axisRangeDateFormat,t.min):t.min,rangeTo:t.isDatetimeAxis?e.time.dateFormat(n.axisRangeDateFormat,t.max):t.max})}});export default InfoRegionComponent;