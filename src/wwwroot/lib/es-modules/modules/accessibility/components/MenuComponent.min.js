"use strict";import H from"../../../parts/Globals.js";import U from"../../../parts/Utilities.js";var extend=U.extend;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";function exportingShouldHaveA11y(t){var e=t.options.exporting;return e&&!1!==e.enabled&&e.accessibility&&e.accessibility.enabled&&t.exportSVGElements&&t.exportSVGElements[0]&&t.exportSVGElements[0].element}H.Chart.prototype.showExportMenu=function(){this.exportSVGElements&&this.exportSVGElements[0]&&(this.exportSVGElements[0].element.onclick(),this.highlightExportItem(0))},H.Chart.prototype.hideExportMenu=function(){var t=this.exportDivElements;t&&this.exportContextMenu&&(t.forEach(function(t){"highcharts-menu-item"===t.className&&t.onmouseout&&t.onmouseout()}),this.highlightedExportItemIx=0,this.exportContextMenu.hideMenu(),this.container.focus())},H.Chart.prototype.highlightExportItem=function(t){var e,i=this.exportDivElements&&this.exportDivElements[t],o=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];if(i&&"DIV"===i.tagName&&(!i.children||!i.children.length))return e=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus,i.focus&&e&&i.focus(),o&&o.onmouseout&&o.onmouseout(),i.onmouseover&&i.onmouseover(),this.highlightedExportItemIx=t,!0},H.Chart.prototype.highlightLastExportItem=function(){var t;if(this.exportDivElements)for(t=this.exportDivElements.length;t--;)if(this.highlightExportItem(t))return!0;return!1};var MenuComponent=function(){};MenuComponent.prototype=new AccessibilityComponent,extend(MenuComponent.prototype,{init:function(){var t=this.chart,e=this;this.addEvent(t,"exportMenuShown",function(){e.onMenuShown()}),this.addEvent(t,"exportMenuHidden",function(){e.onMenuHidden()})},onMenuHidden:function(){var t=this.chart.exportContextMenu;t&&t.setAttribute("aria-hidden","true"),this.setExportButtonExpandedState("false")},onMenuShown:function(){var t=this.chart.exportContextMenu;t&&(this.addAccessibleContextMenuAttribs(),this.unhideElementFromScreenReaders(t),this.chart.highlightExportItem(0)),this.setExportButtonExpandedState("true")},setExportButtonExpandedState:function(t){var e=this.exportButtonProxy;e&&e.setAttribute("aria-expanded",t)},onChartRender:function(){var t=this.chart,e=t.options.accessibility;if(this.removeElement(this.exportProxyGroup),exportingShouldHaveA11y(t)){this.exportProxyGroup=this.addProxyGroup("all"===e.landmarkVerbosity?{"aria-label":t.langFormat("accessibility.exporting.exportRegionLabel",{chart:t}),role:"region"}:null);var i=this.chart.exportSVGElements[0];this.exportButtonProxy=this.createProxyButton(i,this.exportProxyGroup,{"aria-label":t.langFormat("accessibility.exporting.menuButtonLabel",{chart:t}),"aria-expanded":"false"})}},addAccessibleContextMenuAttribs:function(){var t=this.chart,e=t.exportDivElements;if(e&&e.length){e.forEach(function(t){"DIV"!==t.tagName||t.children&&t.children.length?t.setAttribute("aria-hidden","true"):(t.setAttribute("role","listitem"),t.setAttribute("tabindex",0))});var i=e[0].parentNode;i.setAttribute("role","list"),i.removeAttribute("aria-hidden"),i.setAttribute("aria-label",t.langFormat("accessibility.exporting.chartMenuLabel",{chart:t}))}},getKeyboardNavigation:function(){var t=this.keyCodes,e=this.chart,i=this;return new KeyboardNavigationHandler(e,{keyCodeMap:[[[t.left,t.up],function(){i.onKbdPrevious(this)}],[[t.right,t.down],function(){i.onKbdNext(this)}],[[t.enter,t.space],function(){i.onKbdClick(this)}],[[t.esc],function(){return this.response.prev}]],validate:function(){return e.exportChart&&!1!==e.options.exporting.enabled&&!1!==e.options.exporting.accessibility.enabled},init:function(t){e.showExportMenu(),t<0&&e.highlightLastExportItem()},terminate:function(){e.hideExportMenu()}})},onKbdPrevious:function(t){for(var e=this.chart,i=e.options.accessibility,o=t.response,n=e.highlightedExportItemIx||0;n--;)if(e.highlightExportItem(n))return o.success;return i.keyboardNavigation.wrapAround?(e.highlightLastExportItem(),o.success):o.prev},onKbdNext:function(t){for(var e=this.chart,i=e.options.accessibility,o=t.response,n=(e.highlightedExportItemIx||0)+1;n<e.exportDivElements.length;++n)if(e.highlightExportItem(n))return o.success;return i.keyboardNavigation.wrapAround?(e.highlightExportItem(0),o.success):o.next},onKbdClick:function(t){var e=this.chart;return this.fakeClickEvent(e.exportDivElements[e.highlightedExportItemIx]),t.response.success}});export default MenuComponent;