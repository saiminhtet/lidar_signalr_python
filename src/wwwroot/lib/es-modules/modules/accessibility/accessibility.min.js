"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var extend=U.extend,pick=U.pick;import KeyboardNavigationHandler from"./KeyboardNavigationHandler.js";import AccessibilityComponent from"./AccessibilityComponent.js";import KeyboardNavigation from"./KeyboardNavigation.js";import LegendComponent from"./components/LegendComponent.js";import MenuComponent from"./components/MenuComponent.js";import SeriesComponent from"./components/SeriesComponent.js";import ZoomComponent from"./components/ZoomComponent.js";import RangeSelectorComponent from"./components/RangeSelectorComponent.js";import InfoRegionComponent from"./components/InfoRegionComponent.js";import ContainerComponent from"./components/ContainerComponent.js";import whcm from"./high-contrast-mode.js";import highContrastTheme from"./high-contrast-theme.js";import defaultOptions from"./options.js";import copyDeprecatedOptions from"./deprecatedOptions.js";import"../../modules/accessibility/a11y-i18n.js";var addEvent=H.addEvent,doc=H.win.document,merge=H.merge;function Accessibility(t){this.init(t)}merge(!0,H.defaultOptions,defaultOptions,{accessibility:{highContrastTheme:highContrastTheme}}),H.KeyboardNavigationHandler=KeyboardNavigationHandler,H.AccessibilityComponent=AccessibilityComponent,extend(H.SVGElement.prototype,{addFocusBorder:function(t,e){this.focusBorder&&this.removeFocusBorder();var i=this.getBBox(),o=pick(t,3);i.x+=this.translateX?this.translateX:0,i.y+=this.translateY?this.translateY:0,this.focusBorder=this.renderer.rect(i.x-o,i.y-o,i.width+2*o,i.height+2*o,e&&e.borderRadius).addClass("highcharts-focus-border").attr({zIndex:99}).add(this.parentGroup),this.renderer.styledMode||this.focusBorder.attr({stroke:e&&e.stroke,"stroke-width":e&&e.strokeWidth})},removeFocusBorder:function(){this.focusBorder&&(this.focusBorder.destroy(),delete this.focusBorder)}}),H.Chart.prototype.setFocusToElement=function(t,e){var i=this.options.accessibility.keyboardNavigation.focusBorder,o=e||t.element;o&&o.focus&&(o.hcEvents&&o.hcEvents.focusin||addEvent(o,"focusin",function(){}),o.focus(),i.hideBrowserFocusOutline&&(o.style.outline="none")),i.enabled&&(this.focusElement&&this.focusElement.removeFocusBorder(),t.addFocusBorder(i.margin,{stroke:i.style.color,strokeWidth:i.style.lineWidth,borderRadius:i.style.borderRadius}),this.focusElement=t)},H.Axis.prototype.getDescription=function(){return this.userOptions&&this.userOptions.accessibility&&this.userOptions.accessibility.description||this.axisTitle&&this.axisTitle.textStr||this.options.id||this.categories&&"categories"||this.isDatetimeAxis&&"Time"||"values"},Accessibility.prototype={init:function(t){this.chart=t,doc.addEventListener&&t.renderer.isSVG?(copyDeprecatedOptions(t),this.initComponents(),this.keyboardNavigation=new KeyboardNavigation(t,this.components),this.update()):t.renderTo.setAttribute("aria-hidden",!0)},initComponents:function(){var t=this.chart,e=t.options.accessibility;this.components={container:new ContainerComponent,infoRegion:new InfoRegionComponent,legend:new LegendComponent,chartMenu:new MenuComponent,rangeSelector:new RangeSelectorComponent,series:new SeriesComponent,zoom:new ZoomComponent},e.customComponents&&extend(this.components,e.customComponents);var i=this.components;Object.keys(i).forEach(function(e){i[e].initBase(t),i[e].init()})},update:function(){var t=this.components,e=this.chart,i=e.options.accessibility;e.types=this.getChartTypes(),Object.keys(t).forEach(function(e){t[e].onChartUpdate()}),this.keyboardNavigation.update(i.keyboardNavigation.order),!e.highContrastModeActive&&whcm.isHighContrastModeActive(e)&&whcm.setHighContrastTheme(e)},destroy:function(){var t=this.chart||{},e=this.components;Object.keys(e).forEach(function(t){e[t].destroy(),e[t].destroyBase()}),this.keyboardNavigation&&this.keyboardNavigation.destroy(),t.renderTo&&t.renderTo.setAttribute("aria-hidden",!0),t.focusElement&&t.focusElement.removeFocusBorder()},getChartTypes:function(){var t={};return this.chart.series.forEach(function(e){t[e.type]=1}),Object.keys(t)}},H.Chart.prototype.updateA11yEnabled=function(){var t=this.accessibility,e=this.options.accessibility;e&&e.enabled?t?t.update():this.accessibility=t=new Accessibility(this):t?(t.destroy&&t.destroy(),delete this.accessibility):this.renderTo.setAttribute("aria-hidden",!0)},addEvent(H.Chart,"render",function(t){this.a11yDirty&&this.renderTo&&(delete this.a11yDirty,this.updateA11yEnabled());var e=this.accessibility;e&&Object.keys(e.components).forEach(function(i){e.components[i].onChartRender(t)})}),addEvent(H.Chart,"update",function(t){var e=t.options.accessibility;e&&(e.customComponents&&(this.options.accessibility.customComponents=e.customComponents,delete e.customComponents),merge(!0,this.options.accessibility,e),this.accessibility&&this.accessibility.destroy&&(this.accessibility.destroy(),delete this.accessibility)),this.a11yDirty=!0}),addEvent(H.Point,"update",function(){this.series.chart.accessibility&&(this.series.chart.a11yDirty=!0)}),["addSeries","init"].forEach(function(t){addEvent(H.Chart,t,function(){this.a11yDirty=!0})}),["update","updatedData","remove"].forEach(function(t){addEvent(H.Series,t,function(){this.chart.accessibility&&(this.chart.a11yDirty=!0)})}),["afterDrilldown","drillupall"].forEach(function(t){addEvent(H.Chart,t,function(){this.accessibility&&this.accessibility.update()})}),addEvent(H.Chart,"destroy",function(){this.accessibility&&this.accessibility.destroy()});