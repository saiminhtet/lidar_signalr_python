"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var extend=U.extend,isArray=U.isArray,pick=U.pick;import"../parts/Axis.js";import"../parts/Series.js";var addEvent=H.addEvent,find=H.find,fireEvent=H.fireEvent,Axis=H.Axis,Series=H.Series,findBreakAt=function(i,t){return find(t,function(t){return t.from<i&&i<t.to})};extend(Axis.prototype,{isInBreak:function(i,t){var e=i.repeat||1/0,s=i.from,n=i.to-i.from,r=t>=s?(t-s)%e:e-(s-t)%e;return i.inclusive?r<=n:r<n&&0!==r},isInAnyBreak:function(i,t){var e,s,n,r=this.options.breaks,o=r&&r.length;if(o){for(;o--;)this.isInBreak(r[o],i)&&(e=!0,s||(s=pick(r[o].showPoints,!this.isXAxis)));n=e&&t?e&&!s:e}return n}}),addEvent(Axis,"afterInit",function(){"function"==typeof this.setBreaks&&this.setBreaks(this.options.breaks,!1)}),addEvent(Axis,"afterSetTickPositions",function(){if(this.isBroken){var i,t=this.tickPositions,e=this.tickPositions.info,s=[];for(i=0;i<t.length;i++)this.isInAnyBreak(t[i])||s.push(t[i]);this.tickPositions=s,this.tickPositions.info=e}}),addEvent(Axis,"afterSetOptions",function(){this.isBroken&&(this.options.ordinal=!1)}),Axis.prototype.setBreaks=function(i,t){var e=this,s=isArray(i)&&!!i.length;function n(i){var t,s,n=i;for(s=0;s<e.breakArray.length;s++)if((t=e.breakArray[s]).to<=i)n-=t.len;else{if(t.from>=i)break;if(e.isInBreak(t,i)){n-=i-t.from;break}}return n}e.isDirty=e.isBroken!==s,e.isBroken=s,e.options.breaks=e.userOptions.breaks=i,e.forceRedraw=!0,s||e.val2lin!==n||(delete e.val2lin,delete e.lin2val),s&&(e.userOptions.ordinal=!1,e.val2lin=n,e.lin2val=function(i){var t,s,n=i;for(s=0;s<e.breakArray.length&&!((t=e.breakArray[s]).from>=n);s++)t.to<n?n+=t.len:e.isInBreak(t,n)&&(n+=t.len);return n},e.setExtremes=function(i,t,e,s,n){if(this.isBroken){for(var r,o=this.options.breaks;r=findBreakAt(i,o);)i=r.to;for(;r=findBreakAt(t,o);)t=r.from;t<i&&(t=i)}Axis.prototype.setExtremes.call(this,i,t,e,s,n)},e.setAxisTranslation=function(i){if(Axis.prototype.setAxisTranslation.call(this,i),this.unitLength=null,this.isBroken){var t,s,n,r,o=e.options.breaks,a=[],f=[],h=0,p=e.userMin||e.min,c=e.userMax||e.max,k=pick(e.pointRangePadding,0);o.forEach(function(i){s=i.repeat||1/0,e.isInBreak(i,p)&&(p+=i.to%s-p%s),e.isInBreak(i,c)&&(c-=c%s-i.from%s)}),o.forEach(function(i){for(n=i.from,s=i.repeat||1/0;n-s>p;)n-=s;for(;n<p;)n+=s;for(r=n;r<c;r+=s)a.push({value:r,move:"in"}),a.push({value:r+(i.to-i.from),move:"out",size:i.breakSize})}),a.sort(function(i,t){return i.value===t.value?("in"===i.move?0:1)-("in"===t.move?0:1):i.value-t.value}),t=0,n=p,a.forEach(function(i){1===(t+="in"===i.move?1:-1)&&"in"===i.move&&(n=i.value),0===t&&(f.push({from:n,to:i.value,len:i.value-n-(i.size||0)}),h+=i.value-n-(i.size||0))}),e.breakArray=f,e.unitLength=c-p-h+k,fireEvent(e,"afterBreaks"),e.staticScale?e.transA=e.staticScale:e.unitLength&&(e.transA*=(c-e.min+k)/e.unitLength),k&&(e.minPixelPadding=e.transA*e.minPointOffset),e.min=p,e.max=c}}),pick(t,!0)&&this.chart.redraw()},addEvent(Series,"afterGeneratePoints",function(){var i,t=this.xAxis,e=this.yAxis,s=this.points,n=s.length,r=this.options.connectNulls;if(t&&e&&(t.options.breaks||e.options.breaks))for(;n--;)null===(i=s[n]).y&&!1===r||!t.isInAnyBreak(i.x,!0)&&!e.isInAnyBreak(i.y,!0)||(s.splice(n,1),this.data[n]&&this.data[n].destroyElements())}),addEvent(Series,"afterRender",function(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,pick(this.pointArrayMap,["y"]))}),H.Series.prototype.drawBreaks=function(i,t){var e,s,n,r,o=this,a=o.points;i&&t.forEach(function(t){e=i.breakArray||[],s=i.isXAxis?i.min:pick(o.options.threshold,i.min),a.forEach(function(o){r=pick(o["stack"+t.toUpperCase()],o[t]),e.forEach(function(t){n=!1,s<t.from&&r>t.to||s>t.from&&r<t.from?n="pointBreak":(s<t.from&&r>t.from&&r<t.to||s>t.from&&r>t.to&&r<t.from)&&(n="pointInBreak"),n&&fireEvent(i,n,{point:o,brk:t})})})})},H.Series.prototype.gappedPath=function(){var i,t=this.currentDataGrouping,e=t&&t.gapSize,s=this.options.gapSize,n=this.points.slice(),r=n.length-1,o=this.yAxis;if(s&&r>0)for("value"!==this.options.gapUnit&&(s*=this.basePointRange),e&&e>s&&e>=this.basePointRange&&(s=e);r--;)n[r+1].x-n[r].x>s&&(i=(n[r].x+n[r+1].x)/2,n.splice(r+1,0,{isNull:!0,x:i}),this.options.stacking&&((o.stacks[this.stackKey][i]=new H.StackItem(o,o.options.stackLabels,!1,i,this.stack)).total=0));return this.getGraphPath(n)};