"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var extend=U.extend;import"./data.src.js";H.wrap(H.Data.prototype,"init",function(t,e){t.call(this,e),e.svg&&this.loadSVG()}),extend(H.Data.prototype,{pathToArray:function(t,e){var a,r,n,i,o,s,l=0,p=0,c=[0,0],u=[0,0];if(1===(t=t.replace(/[0-9]+e-?[0-9]+/g,function(t){return+t}).replace(/([A-Za-z])/g," $1 ").replace(/-/g," -").replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/g," ").split(/[ ,]+/)).length)return[];for(l=0;l<t.length;l++)/[a-zA-Z]/.test(t[l])?(r=2,"c"!==(i=t[l])&&"C"!==i||(r=6),"m"===i?u=[parseFloat(t[l+1])+u[0],parseFloat(t[l+2])+u[1]]:"M"===i&&(u=[parseFloat(t[l+1]),parseFloat(t[l+2])]),"m"===i||"l"===i||"c"===i?(t[l]=i.toUpperCase(),n=!0):"M"===i||"L"===i||"C"===i?n=!1:"h"===i?(n=!0,t[l]="L",t.splice(l+2,0,0)):"v"===i?(n=!0,t[l]="L",t.splice(l+1,0,0)):"s"===i?(n=!0,t[l]="L",t.splice(l+1,2)):"S"===i?(n=!1,t[l]="L",t.splice(l+1,2)):"H"===i||"h"===i?(n=!1,t[l]="L",t.splice(l+2,0,c[1])):"V"===i||"v"===i?(n=!1,t[l]="L",t.splice(l+1,0,c[0])):"z"!==i&&"Z"!==i||(c=u)):(t[l]=parseFloat(t[l]),n&&(t[l]+=c[p%2]),p%2==1&&e&&(!n||"m"===i&&l<3)&&(o=[t[l-1],t[l]],a=[(s=e).a*o[0]+s.c*o[1]+s.e,s.b*o[0]+s.d*o[1]+s.f],t[l-1]=a[0],t[l]=a[1]),p===r-1?(c=[t[l-1],t[l]],p=0):p+=1);return"number"==typeof t[0]&&t.length>=4&&(t.unshift("M"),t.splice(3,0,"L")),t},pathToString:function(t){return t.forEach(function(t){var e=t.path;e=(e=e.join(",")).replace(/,?([a-zA-Z]),?/g,"$1"),t.path=e}),t},roundPaths:function(t,e){var a,r,n=H.seriesTypes.map.prototype;return a={xAxis:{translate:H.Axis.prototype.translate,options:{},minPixelPadding:0},yAxis:{translate:H.Axis.prototype.translate,options:{},minPixelPadding:0}},n.getBox.call(a,t),r=(e=e||1e3)/Math.max(a.maxX-a.minX,a.maxY-a.minY),a.xAxis.transA=a.yAxis.transA=r,a.xAxis.len=a.yAxis.len=e,a.xAxis.min=a.minX,a.yAxis.min=(a.minY+e)/r,t.forEach(function(t){var e,r;for(t.path=r=n.translatePath.call(a,t.path,!0),e=r.length;e--;)"number"==typeof r[e]&&(r[e]=Math.round(r[e]));delete t._foundBox}),t},loadSVG:function(){var t=this,e=this.options;function a(t){return Array.prototype.slice.call(t.getElementsByTagName("path")).concat(Array.prototype.slice.call(t.getElementsByTagName("polygon"))).concat(Array.prototype.slice.call(t.getElementsByTagName("rect")))}function r(t){if("path"===t.nodeName)return t.getAttribute("d");if("polygon"===t.nodeName)return t.getAttribute("points");if("rect"===t.nodeName){var e=+t.getAttribute("x"),a=+t.getAttribute("y"),r=+t.getAttribute("width"),n=+t.getAttribute("height");return[e,a,e+r,a,e+r,a+n,e,a+n,e,a].join(" ")}}function n(t){var e=t.getCTM();if(!isNaN(e.f))return e}function i(t){var e=t.getElementsByTagName("desc"),a=e[0]&&e[0].getElementsByTagName("name");return a&&a[0]&&a[0].innerText||t.getAttribute("inkscape:label")||t.getAttribute("id")||t.getAttribute("class")}function o(t){return!/fill[\s]?\:[\s]?none/.test(t.getAttribute("style"))&&"none"!==t.getAttribute("fill")}function s(s){var l,p,c,u,f,g=[];t.$frame=t.$frame||$("<div>").css({position:"absolute",top:"-9999em"}).appendTo($(document.body)),t.$frame.html(s),(s=$("svg",t.$frame)[0]).removeAttribute("viewBox"),p=a(s),["defs","clipPath"].forEach(function(t){s.getElementsByTagName(t).forEach(function(t){t.getElementsByTagName("path").forEach(function(t){t.skip=!0})})}),p.forEach(function(t,e){if(!t.skip){var a,r,n=[];for(e>0&&t.parentNode!==l&&(f=!0),l=t.parentNode,a=t;a;)n.push(a),a=a.parentNode;if(n.reverse(),c)for(r=0;r<c.length;r++)c[r]!==n[r]&&(c=c.slice(0,r));else c=n}}),u=c[c.length-1],f&&u.getElementsByTagName("g").forEach(function(e){var s,l=[];a(e).forEach(function(e){e.skip||(l=l.concat(t.pathToArray(r(e),n(e))),o(e)&&(s=!0),e.skip=!0)}),g.push({name:i(e),path:l,hasFill:s})}),p.forEach(function(e){e.skip||g.push({name:i(e),path:t.pathToArray(r(e),n(e)),hasFill:o(e)})}),t.roundPaths(g),e.complete({series:[{data:g}]})}-1!==e.svg.indexOf("<svg")?s(e.svg):jQuery.ajax({url:e.svg,dataType:"text",success:s})}});