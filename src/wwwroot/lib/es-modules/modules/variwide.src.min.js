"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isNumber=U.isNumber,pick=U.pick;import"../parts/AreaSeries.js";var addEvent=H.addEvent,seriesType=H.seriesType,seriesTypes=H.seriesTypes;seriesType("variwide","column",{pointPadding:0,groupPadding:0},{irregularWidths:!0,pointArrayMap:["y","z"],parallelArrays:["x","y","z"],processData:function(s){this.totalZ=0,this.relZ=[],seriesTypes.column.prototype.processData.call(this,s),(this.xAxis.reversed?this.zData.slice().reverse():this.zData).forEach(function(s,t){this.relZ[t]=this.totalZ,this.totalZ+=s},this),this.xAxis.categories&&(this.xAxis.variwide=!0,this.xAxis.zData=this.zData)},postTranslate:function(s,t,i){var r=this.xAxis,e=this.relZ,a=r.reversed?e.length-s:s,o=r.reversed?-1:1,h=r.len,n=this.totalZ,p=a/e.length*h,l=(a+o)/e.length*h,c=pick(e[a],n)/n*h,d=pick(e[a+o],n)/n*h,u=t-p;return i&&(i.crosshairWidth=d-c),c+u*(d-c)/(l-p)},translate:function(){var s=this.options.crisp,t=this.xAxis;this.options.crisp=!1,seriesTypes.column.prototype.translate.call(this),this.options.crisp=s;var i=this.chart.inverted,r=this.borderWidth%2/2;this.points.forEach(function(s,e){var a,o;t.variwide?(a=this.postTranslate(e,s.shapeArgs.x,s),o=this.postTranslate(e,s.shapeArgs.x+s.shapeArgs.width)):(a=s.plotX,o=t.translate(s.x+s.z,0,0,0,1)),this.options.crisp&&(a=Math.round(a)-r,o=Math.round(o)-r),s.shapeArgs.x=a,s.shapeArgs.width=Math.max(o-a,1),s.plotX=(a+o)/2,i?s.tooltipPos[1]=t.len-s.shapeArgs.x-s.shapeArgs.width/2:s.tooltipPos[0]=s.shapeArgs.x+s.shapeArgs.width/2},this),this.options.stacking&&this.correctStackLabels()},correctStackLabels:function(){var s,t,i,r,e=this,a=e.options,o=e.yAxis;e.points.forEach(function(h){r=h.x,t=h.shapeArgs.width,i=o.stacks[(e.negStacks&&h.y<(a.startFromThreshold?0:a.threshold)?"-":"")+e.stackKey],s=i[r],i&&s&&!h.isNull&&s.setOffset(-t/2||0,t||0,void 0,void 0,h.plotX)})}},{isValid:function(){return isNumber(this.y)&&isNumber(this.z)}}),H.Tick.prototype.postTranslate=function(s,t,i){var r=this.axis,e=s[t]-r.pos;r.horiz||(e=r.len-e),e=r.series[0].postTranslate(i,e),r.horiz||(e=r.len-e),s[t]=r.pos+e},addEvent(H.Axis,"afterDrawCrosshair",function(s){this.variwide&&this.cross&&this.cross.attr("stroke-width",s.point&&s.point.crosshairWidth)}),addEvent(H.Axis,"afterRender",function(){var s=this;!this.horiz&&this.variwide&&this.chart.labelCollectors.push(function(){return s.tickPositions.filter(function(t){return s.ticks[t].label}).map(function(t,i){var r=s.ticks[t].label;return r.labelrank=s.zData[i],r})})}),addEvent(H.Tick,"afterGetPosition",function(s){var t=this.axis,i=t.horiz?"x":"y";t.variwide&&(this[i+"Orig"]=s.pos[i],this.postTranslate(s.pos,i,this.pos))}),H.wrap(H.Tick.prototype,"getLabelPosition",function(s,t,i,r,e,a,o,h){var n,p=Array.prototype.slice.call(arguments,1),l=e?"x":"y";return this.axis.variwide&&"number"==typeof this[l+"Orig"]&&(p[e?0:1]=this[l+"Orig"]),n=s.apply(this,p),this.axis.variwide&&this.axis.categories&&this.postTranslate(n,l,h),n});