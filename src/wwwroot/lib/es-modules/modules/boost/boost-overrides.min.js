"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var isNumber=U.isNumber;import"../../parts/Color.js";import"../../parts/Series.js";import"../../parts/Options.js";import"../../parts/Point.js";import"../../parts/Interaction.js";import butils from"./boost-utils.js";import boostable from"./boostables.js";import boostableMap from"./boostable-map.js";var boostEnabled=butils.boostEnabled,shouldForceChartSeriesBoosting=butils.shouldForceChartSeriesBoosting,Chart=H.Chart,Series=H.Series,Point=H.Point,seriesTypes=H.seriesTypes,addEvent=H.addEvent,pick=H.pick,wrap=H.wrap,plotOptions=H.getOptions().plotOptions;Chart.prototype.isChartSeriesBoosting=function(){return pick(this.options.boost&&this.options.boost.seriesThreshold,50)<=this.series.length||shouldForceChartSeriesBoosting(this)},Chart.prototype.getBoostClipRect=function(t){var s={x:this.plotLeft,y:this.plotTop,width:this.plotWidth,height:this.plotHeight};return t===this&&this.yAxis.forEach(function(t){s.y=Math.min(t.pos,s.y),s.height=Math.max(t.pos-this.plotTop+t.len,s.height)},this),s},Series.prototype.getPoint=function(t){var s=t,i=this.xData||this.options.xData||this.processedXData||!1;return!t||t instanceof this.pointClass||((s=(new this.pointClass).init(this,this.options.data[t.i],i?i[t.i]:void 0)).category=pick(this.xAxis.categories?this.xAxis.categories[s.x]:s.x,s.x),s.dist=t.dist,s.distX=t.distX,s.plotX=t.plotX,s.plotY=t.plotY,s.index=t.i),s},wrap(Series.prototype,"searchPoint",function(t){return this.getPoint(t.apply(this,[].slice.call(arguments,1)))}),wrap(Point.prototype,"haloPath",function(t){var s,i=this.series,o=i.chart,e=this.plotX,r=this.plotY,a=o.inverted;return i.isSeriesBoosting&&a&&(this.plotX=i.yAxis.len-r,this.plotY=i.xAxis.len-e),s=t.apply(this,Array.prototype.slice.call(arguments,1)),i.isSeriesBoosting&&a&&(this.plotX=e,this.plotY=r),s}),wrap(Series.prototype,"markerAttribs",function(t,s){var i,o=this.chart,e=s.plotX,r=s.plotY,a=o.inverted;return this.isSeriesBoosting&&a&&(s.plotX=this.yAxis.len-r,s.plotY=this.xAxis.len-e),i=t.apply(this,Array.prototype.slice.call(arguments,1)),this.isSeriesBoosting&&a&&(s.plotX=e,s.plotY=r),i}),addEvent(Series,"destroy",function(){var t=this,s=t.chart;s.markerGroup===t.markerGroup&&(t.markerGroup=null),s.hoverPoints&&(s.hoverPoints=s.hoverPoints.filter(function(s){return s.series===t})),s.hoverPoint&&s.hoverPoint.series===t&&(s.hoverPoint=null)}),wrap(Series.prototype,"getExtremes",function(t){if(!this.isSeriesBoosting||!this.hasExtremes||!this.hasExtremes())return t.apply(this,Array.prototype.slice.call(arguments,1))}),["translate","generatePoints","drawTracker","drawPoints","render"].forEach(function(t){function s(s){var i=this.options.stacking&&("translate"===t||"generatePoints"===t);this.isSeriesBoosting&&!i&&boostEnabled(this.chart)&&"heatmap"!==this.type&&"treemap"!==this.type&&boostableMap[this.type]&&0!==this.options.boostThreshold?this[t+"Canvas"]&&this[t+"Canvas"]():s.call(this)}wrap(Series.prototype,t,s),"translate"===t&&["column","bar","arearange","columnrange","heatmap","treemap"].forEach(function(i){seriesTypes[i]&&wrap(seriesTypes[i].prototype,t,s)})}),wrap(Series.prototype,"processData",function(t){var s,i=this,o=this.options.data;function e(t){return i.chart.isChartSeriesBoosting()||(t?t.length:0)>=(i.options.boostThreshold||Number.MAX_VALUE)}boostEnabled(this.chart)&&boostableMap[this.type]?(e(o)&&"heatmap"!==this.type&&"treemap"!==this.type&&!this.options.stacking&&this.hasExtremes&&this.hasExtremes(!0)||(t.apply(this,Array.prototype.slice.call(arguments,1)),o=this.processedXData),this.isSeriesBoosting=e(o),this.isSeriesBoosting?(s=this.getFirstValidPoint(this.options.data),isNumber(s)||H.isArray(s)||H.error(12,!1,this.chart),this.enterBoost()):this.exitBoost&&this.exitBoost()):t.apply(this,Array.prototype.slice.call(arguments,1))}),addEvent(Series,"hide",function(){this.canvas&&this.renderTarget&&(this.ogl&&this.ogl.clear(),this.boostClear())}),Series.prototype.enterBoost=function(){this.alteredByBoost=[],["allowDG","directTouch","stickyTracking"].forEach(function(t){this.alteredByBoost.push({prop:t,val:this[t],own:Object.hasOwnProperty.call(this,t)})},this),this.allowDG=!1,this.directTouch=!1,this.stickyTracking=!0,this.animate=null,this.labelBySeries&&(this.labelBySeries=this.labelBySeries.destroy())},Series.prototype.exitBoost=function(){(this.alteredByBoost||[]).forEach(function(t){t.own?this[t.prop]=t.val:delete this[t.prop]},this),this.boostClear&&this.boostClear()},Series.prototype.hasExtremes=function(t){var s=this.options,i=s.data,o=this.xAxis&&this.xAxis.options,e=this.yAxis&&this.yAxis.options,r=this.colorAxis&&this.colorAxis.options;return i.length>(s.boostThreshold||Number.MAX_VALUE)&&isNumber(e.min)&&isNumber(e.max)&&(!t||isNumber(o.min)&&isNumber(o.max))&&(!r||isNumber(r.min)&&isNumber(r.max))},Series.prototype.destroyGraphics=function(){var t,s,i=this,o=this.points;if(o)for(s=0;s<o.length;s+=1)(t=o[s])&&t.destroyElements&&t.destroyElements();["graph","area","tracker"].forEach(function(t){i[t]&&(i[t]=i[t].destroy())})},boostable.forEach(function(t){plotOptions[t]&&(plotOptions[t].boostThreshold=5e3,plotOptions[t].boostData=[],seriesTypes[t].prototype.fillOpacity=!0)});