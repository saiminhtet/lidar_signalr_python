"use strict";import H from"../../parts/Globals.js";import U from"../../parts/Utilities.js";var pick=U.pick;function Earcon(n){this.init(n||{})}Earcon.prototype.init=function(n){this.options=n,this.options.id||(this.options.id=this.id=H.uniqueKey()),this.instrumentsPlaying={}},Earcon.prototype.sonify=function(n){var t=H.merge(this.options,n),i=pick(t.volume,1),o=t.pan,s=this,p=n&&n.onEnd,e=s.options.onEnd;t.instruments.forEach(function(n){var t,r,a,l="string"==typeof n.instrument?H.sonification.instruments[n.instrument]:n.instrument,c=H.merge(n.playOptions);l&&l.play?n.playOptions&&("function"!=typeof n.playOptions.volume&&(c.volume=pick(i,1)*pick(n.playOptions.volume,1)),c.pan=pick(o,c.pan),t=c.onEnd,c.onEnd=function(){delete s.instrumentsPlaying[a],t&&t.apply(this,arguments),Object.keys(s.instrumentsPlaying).length||(p&&p.apply(this,arguments),e&&e.apply(this,arguments))},r=l.copy(),a=r.id,s.instrumentsPlaying[a]=r,r.play(c)):H.error(30)})},Earcon.prototype.cancelSonify=function(n){var t=this.instrumentsPlaying,i=t&&Object.keys(t);i&&i.length&&(i.forEach(function(i){t[i].stop(!n,null,"cancelled")}),this.instrumentsPlaying={})};export default Earcon;