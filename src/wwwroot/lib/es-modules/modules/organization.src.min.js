"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var pick=U.pick,base=H.seriesTypes.sankey.prototype;H.seriesType("organization","sankey",{borderColor:"#666666",borderRadius:3,linkRadius:10,borderWidth:1,dataLabels:{nodeFormatter:function(){var t={width:"100%",height:"100%",display:"flex","flex-direction":"row","align-items":"center","justify-content":"center"},e={"max-height":"100%","border-radius":"50%"},i={width:"100%",padding:0,"text-align":"center","white-space":"normal"};function s(t){return Object.keys(t).reduce(function(e,i){return e+i+":"+t[i]+";"},'style="')+'"'}this.point.image&&(e["max-width"]="30%",i.width="70%"),this.series.chart.renderer.forExport&&(t.display="block",i.position="absolute",i.left=this.point.image?"30%":0,i.top=0);var r="<div "+s(t)+">";return this.point.image&&(r+='<img src="'+this.point.image+'" '+s(e)+">"),r+="<div "+s(i)+">",this.point.name&&(r+="<h4 "+s({margin:0})+">"+this.point.name+"</h4>"),this.point.title&&(r+="<p "+s({margin:0})+">"+(this.point.title||"")+"</p>"),this.point.description&&(r+="<p "+s({opacity:.75,margin:"5px"})+">"+this.point.description+"</p>"),r+="</div></div>"},style:{fontWeight:"normal",fontSize:"13px"},useHTML:!0},hangingIndent:20,linkColor:"#666666",linkLineWidth:1,nodeWidth:50,tooltip:{nodeFormat:"{point.name}<br>{point.title}<br>{point.description}"}},{pointAttribs:function(t,e){var i=this,s=base.pointAttribs.call(i,t,e),r=t.isNode?t.level:t.fromNode.level,n=i.mapOptionsToLevel[r||0]||{},o=t.options,a=n.states&&n.states[e]||{},h=["borderRadius","linkColor","linkLineWidth"].reduce(function(t,e){return t[e]=pick(a[e],o[e],n[e],i.options[e]),t},{});return t.isNode?h.borderRadius&&(s.r=h.borderRadius):(s.stroke=h.linkColor,s["stroke-width"]=h.linkLineWidth,delete s.fill),s},createNode:function(t){var e=base.createNode.call(this,t);return e.getSum=function(){return 1},e},createNodeColumn:function(){var t=base.createNodeColumn.call(this);return H.wrap(t,"offset",function(t,e,i){var s=t.call(this,e,i);return e.hangsFrom?{absoluteTop:e.hangsFrom.nodeY}:s}),t},translateNode:function(t,e){base.translateNode.call(this,t,e),t.hangsFrom&&(t.shapeArgs.height-=this.options.hangingIndent,this.chart.inverted||(t.shapeArgs.y+=this.options.hangingIndent)),t.nodeHeight=this.chart.inverted?t.shapeArgs.width:t.shapeArgs.height},curvedPath:function(t,e){var i,s,r,n,o,a,h,p,d,l=[];for(i=0;i<t.length;i++)s=t[i][0],r=t[i][1],0===i?l.push("M",s,r):i===t.length-1?l.push("L",s,r):e?(n=t[i-1][0],a=t[i-1][1],o=t[i+1][0],h=t[i+1][1],n!==o&&a!==h&&(p=n<o?1:-1,d=a<h?1:-1,l.push("L",s-p*Math.min(Math.abs(s-n),e),r-d*Math.min(Math.abs(r-a),e),"C",s,r,s,r,s+p*Math.min(Math.abs(s-o),e),r+d*Math.min(Math.abs(r-h),e)))):l.push("L",s,r);return l},translateLink:function(t){var e,i=t.fromNode,s=t.toNode,r=Math.round(this.options.linkLineWidth)%2/2,n=Math.floor(i.shapeArgs.x+i.shapeArgs.width)+r,o=Math.floor(i.shapeArgs.y+i.shapeArgs.height/2)+r,a=Math.floor(s.shapeArgs.x)+r,h=Math.floor(s.shapeArgs.y+s.shapeArgs.height/2)+r,p=this.options.hangingIndent,d=s.options.offset,l=/%$/.test(d)&&parseInt(d,10),g=this.chart.inverted;g&&(n-=i.shapeArgs.width,a+=s.shapeArgs.width),e=Math.floor(a+(g?1:-1)*(this.colDistance-this.nodeWidth)/2)+r,l&&(l>=50||l<=-50)&&(e=a=Math.floor(a+(g?-.5:.5)*s.shapeArgs.width)+r,h=s.shapeArgs.y,l>0&&(h+=s.shapeArgs.height)),s.hangsFrom===i&&(this.chart.inverted?(o=Math.floor(i.shapeArgs.y+i.shapeArgs.height-p/2)+r,h=s.shapeArgs.y+s.shapeArgs.height):o=Math.floor(i.shapeArgs.y+p/2)+r,e=a=Math.floor(s.shapeArgs.x+s.shapeArgs.width/2)+r),t.plotY=1,t.shapeType="path",t.shapeArgs={d:this.curvedPath([[n,o],[e,o],[e,h],[a,h]],this.options.linkRadius)}},alignDataLabel:function(t,e,i){if(i.useHTML){var s=t.shapeArgs.width,r=t.shapeArgs.height,n=this.options.borderWidth+2*this.options.dataLabels.padding;this.chart.inverted&&(s=r,r=t.shapeArgs.width),r-=n,s-=n,H.css(e.text.element.parentNode,{width:s+"px",height:r+"px"}),H.css(e.text.element,{left:0,top:0,width:"100%",height:"100%",overflow:"hidden"}),e.getBBox=function(){return{width:s,height:r}}}H.seriesTypes.column.prototype.alignDataLabel.apply(this,arguments)}});