"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var defined=U.defined,extend=U.extend,isNumber=U.isNumber,pick=U.pick,fireEvent=H.fireEvent,merge=H.merge,correctFloat=H.correctFloat,bindingsUtils=H.NavigationBindings.prototype.utils,PREFIX="highcharts-";bindingsUtils.addFlagFromForm=function(t){return function(i){var n=this,e=n.chart,s=e.stockTools,a=bindingsUtils.getFieldType,o=bindingsUtils.attractToPoint(i,e),r={x:o.x,y:o.y},l={type:"flags",onSeries:o.series.id,shape:t,data:[r],point:{events:{click:function(){var t=this,i=t.options;fireEvent(n,"showPopup",{point:t,formType:"annotation-toolbar",options:{langKey:"flags",type:"flags",title:[i.title,a(i.title)],name:[i.name,a(i.name)]},onSubmit:function(i){"remove"===i.actionType?t.remove():t.update(n.fieldsToOptions(i.fields,{}))}})}}}};s&&s.guiEnabled||e.addSeries(l),fireEvent(n,"showPopup",{formType:"flag",options:{langKey:"flags",type:"flags",title:["A",a("A")],name:["Flag A",a("Flag A")]},onSubmit:function(t){n.fieldsToOptions(t.fields,l.data[0]),e.addSeries(l)}})}},bindingsUtils.manageIndicators=function(t){var i,n,e=this.chart,s={linkedTo:t.linkedTo,type:t.type},a=["ad","atr","cci","cmf","macd","mfi","roc","rsi","ao","aroon","aroonoscillator","trix","apo","dpo","ppo","natr","williamsr","stochastic","linearRegression","linearRegressionSlope","linearRegressionIntercept","linearRegressionAngle"];"edit"===t.actionType?(this.fieldsToOptions(t.fields,s),(n=e.get(t.seriesId))&&n.update(s,!1)):"remove"===t.actionType?(n=e.get(t.seriesId))&&(i=n.yAxis,n.linkedSeries&&n.linkedSeries.forEach(function(t){t.remove(!1)}),n.remove(!1),a.indexOf(n.type)>=0&&(i.remove(!1),this.resizeYAxes())):(s.id=H.uniqueKey(),this.fieldsToOptions(t.fields,s),a.indexOf(t.type)>=0?(i=e.addAxis({id:H.uniqueKey(),offset:0,opposite:!0,title:{text:""},tickPixelInterval:40,showLastLabel:!1,labels:{align:"left",y:-2}},!1,!1),s.yAxis=i.options.id,this.resizeYAxes()):s.yAxis=e.get(t.linkedTo).options.yAxis,["ad","cmf","mfi","vbp","vwap"].indexOf(t.type)>=0&&(s.params.volumeSeriesID=e.series.filter(function(t){return"column"===t.options.type})[0].options.id),e.addSeries(s,!1)),fireEvent(this,"deselectButton",{button:this.selectedButtonElement}),e.redraw()},bindingsUtils.updateHeight=function(t,i){i.update({typeOptions:{height:this.chart.pointer.getCoordinates(t).yAxis[0].value-i.options.typeOptions.points[1].y}})},bindingsUtils.attractToPoint=function(t,i){var n,e=i.pointer.getCoordinates(t),s=e.xAxis[0].value,a=e.yAxis[0].value,o=Number.MAX_VALUE;return i.series.forEach(function(t){t.points.forEach(function(t){t&&o>Math.abs(t.x-s)&&(o=Math.abs(t.x-s),n=t)})}),{x:n.x,y:n.y,below:a<n.y,series:n.series,xAxis:n.series.xAxis.index||0,yAxis:n.series.yAxis.index||0}},bindingsUtils.isNotNavigatorYAxis=function(t){return t.userOptions.className!==PREFIX+"navigator-yaxis"},bindingsUtils.updateNthPoint=function(t){return function(i,n){var e=n.options.typeOptions,s=this.chart.pointer.getCoordinates(i),a=s.xAxis[0].value,o=s.yAxis[0].value;e.points.forEach(function(i,n){n>=t&&(i.x=a,i.y=o)}),n.update({typeOptions:{points:e.points}})}},extend(H.NavigationBindings.prototype,{getYAxisPositions:function(t,i,n){var e,s=0;function a(t){return defined(t)&&!isNumber(t)&&t.match("%")}return(e=t.map(function(t){var e=a(t.options.height)?parseFloat(t.options.height)/100:t.height/i,o=a(t.options.top)?parseFloat(t.options.top)/100:correctFloat(t.top-t.chart.plotTop)/i;return isNumber(e)||(e=n/100),s=correctFloat(s+e),{height:100*e,top:100*o}})).allAxesHeight=s,e},getYAxisResizers:function(t){var i=[];return t.forEach(function(n,e){var s=t[e+1];i[e]=s?{enabled:!0,controlledAxis:{next:[pick(s.options.id,s.options.index)]}}:{enabled:!1}}),i},resizeYAxes:function(t){t=t||20;var i=this.chart,n=i.yAxis.filter(this.utils.isNotNavigatorYAxis),e=i.plotHeight,s=n.length,a=this.getYAxisPositions(n,e,t),o=this.getYAxisResizers(n),r=a.allAxesHeight,l=t;r>1?(s<6?(a[0].height=correctFloat(a[0].height-l),a=this.recalculateYAxisPositions(a,l)):(l=(t=100/s)/(s-1),a=this.recalculateYAxisPositions(a,l,!0,-1)),a[s-1]={top:correctFloat(100-t),height:t}):(l=100*correctFloat(1-r),s<5?(a[0].height=correctFloat(a[0].height+l),a=this.recalculateYAxisPositions(a,l)):(l/=s,a=this.recalculateYAxisPositions(a,l,!0,1))),a.forEach(function(t,i){n[i].update({height:t.height+"%",top:t.top+"%",resize:o[i]},!1)})},recalculateYAxisPositions:function(t,i,n,e){return t.forEach(function(s,a){var o=t[a-1];s.top=o?correctFloat(o.height+o.top):0,n&&(s.height=correctFloat(s.height+e*i))}),t}});var stockToolsBindings={segment:{className:"highcharts-segment",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"segment",type:"crookedLine",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.segment.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},arrowSegment:{className:"highcharts-arrow-segment",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"arrowSegment",type:"crookedLine",typeOptions:{line:{markerEnd:"arrow"},points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.arrowSegment.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},ray:{className:"highcharts-ray",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"ray",type:"crookedLine",typeOptions:{type:"ray",points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.ray.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},arrowRay:{className:"highcharts-arrow-ray",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"arrowRay",type:"infinityLine",typeOptions:{type:"ray",line:{markerEnd:"arrow"},points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.arrowRay.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},infinityLine:{className:"highcharts-infinity-line",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"infinityLine",type:"infinityLine",typeOptions:{type:"line",points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.infinityLine.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},arrowInfinityLine:{className:"highcharts-arrow-infinity-line",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"arrowInfinityLine",type:"infinityLine",typeOptions:{type:"line",line:{markerEnd:"arrow"},points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.arrowInfinityLine.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1)]},horizontalLine:{className:"highcharts-horizontal-line",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"horizontalLine",type:"infinityLine",draggable:"y",typeOptions:{type:"horizontalLine",points:[{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.horizontalLine.annotationsOptions);this.chart.addAnnotation(e)}},verticalLine:{className:"highcharts-vertical-line",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"verticalLine",type:"infinityLine",draggable:"x",typeOptions:{type:"verticalLine",points:[{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.verticalLine.annotationsOptions);this.chart.addAnnotation(e)}},crooked3:{className:"highcharts-crooked3",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"crooked3",type:"crookedLine",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.crooked3.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2)]},crooked5:{className:"highcharts-crooked5",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"crookedLine",type:"crookedLine",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.crooked5.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3),bindingsUtils.updateNthPoint(4)]},elliott3:{className:"highcharts-elliott3",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"elliott3",type:"elliottWave",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.elliott3.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3)]},elliott5:{className:"highcharts-elliott5",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"elliott5",type:"elliottWave",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.elliott5.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3),bindingsUtils.updateNthPoint(4),bindingsUtils.updateNthPoint(5)]},measureX:{className:"highcharts-measure-x",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"x",point:{x:i.xAxis[0].value,y:i.yAxis[0].value,xAxis:0,yAxis:0},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{enabled:!1,strokeWidth:0,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.measureX.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateRectSize]},measureY:{className:"highcharts-measure-y",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"y",point:{x:i.xAxis[0].value,y:i.yAxis[0].value,xAxis:0,yAxis:0},crosshairX:{enabled:!1,strokeWidth:0,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.measureY.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateRectSize]},measureXY:{className:"highcharts-measure-xy",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"xy",point:{x:i.xAxis[0].value,y:i.yAxis[0].value,xAxis:0,yAxis:0},background:{width:0,height:0,strokeWidth:10},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"}},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.measureXY.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateRectSize]},fibonacci:{className:"highcharts-fibonacci",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"fibonacci",type:"fibonacci",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]},labelOptions:{style:{color:"#666666"}}},n.annotationsOptions,n.bindings.fibonacci.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateHeight]},parallelChannel:{className:"highcharts-parallel-channel",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"parallelChannel",type:"tunnel",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}]}},n.annotationsOptions,n.bindings.parallelChannel.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateHeight]},pitchfork:{className:"highcharts-pitchfork",start:function(t){var i=this.chart.pointer.getCoordinates(t),n=this.chart.options.navigation,e=merge({langKey:"pitchfork",type:"pitchfork",typeOptions:{points:[{x:i.xAxis[0].value,y:i.yAxis[0].value,controlPoint:{style:{fill:"red"}}},{x:i.xAxis[0].value,y:i.yAxis[0].value},{x:i.xAxis[0].value,y:i.yAxis[0].value}],innerBackground:{fill:"rgba(100, 170, 255, 0.8)"}},shapeOptions:{strokeWidth:2}},n.annotationsOptions,n.bindings.pitchfork.annotationsOptions);return this.chart.addAnnotation(e)},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2)]},verticalCounter:{className:"highcharts-vertical-counter",start:function(t){var i,n=bindingsUtils.attractToPoint(t,this.chart),e=this.chart.options.navigation,s=defined(this.verticalCounter)?this.verticalCounter:0,a=merge({langKey:"verticalCounter",type:"verticalLine",typeOptions:{point:{x:n.x,y:n.y,xAxis:n.xAxis,yAxis:n.yAxis},label:{offset:n.below?40:-40,text:s.toString()}},labelOptions:{style:{color:"#666666",fontSize:"11px"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},e.annotationsOptions,e.bindings.verticalCounter.annotationsOptions);s++,(i=this.chart.addAnnotation(a)).options.events.click.call(i,{})}},verticalLabel:{className:"highcharts-vertical-label",start:function(t){var i,n=bindingsUtils.attractToPoint(t,this.chart),e=this.chart.options.navigation,s=merge({langKey:"verticalLabel",type:"verticalLine",typeOptions:{point:{x:n.x,y:n.y,xAxis:n.xAxis,yAxis:n.yAxis},label:{offset:n.below?40:-40}},labelOptions:{style:{color:"#666666",fontSize:"11px"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},e.annotationsOptions,e.bindings.verticalLabel.annotationsOptions);(i=this.chart.addAnnotation(s)).options.events.click.call(i,{})}},verticalArrow:{className:"highcharts-vertical-arrow",start:function(t){var i,n=bindingsUtils.attractToPoint(t,this.chart),e=this.chart.options.navigation,s=merge({langKey:"verticalArrow",type:"verticalLine",typeOptions:{point:{x:n.x,y:n.y,xAxis:n.xAxis,yAxis:n.yAxis},label:{offset:n.below?40:-40,format:" "},connector:{fill:"none",stroke:n.below?"red":"green"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},e.annotationsOptions,e.bindings.verticalArrow.annotationsOptions);(i=this.chart.addAnnotation(s)).options.events.click.call(i,{})}},flagCirclepin:{className:"highcharts-flag-circlepin",start:bindingsUtils.addFlagFromForm("circlepin")},flagDiamondpin:{className:"highcharts-flag-diamondpin",start:bindingsUtils.addFlagFromForm("flag")},flagSquarepin:{className:"highcharts-flag-squarepin",start:bindingsUtils.addFlagFromForm("squarepin")},flagSimplepin:{className:"highcharts-flag-simplepin",start:bindingsUtils.addFlagFromForm("nopin")},zoomX:{className:"highcharts-zoom-x",init:function(t){this.chart.update({chart:{zoomType:"x"}}),fireEvent(this,"deselectButton",{button:t})}},zoomY:{className:"highcharts-zoom-y",init:function(t){this.chart.update({chart:{zoomType:"y"}}),fireEvent(this,"deselectButton",{button:t})}},zoomXY:{className:"highcharts-zoom-xy",init:function(t){this.chart.update({chart:{zoomType:"xy"}}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeLine:{className:"highcharts-series-type-line",init:function(t){this.chart.series[0].update({type:"line",useOhlcData:!0}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeOhlc:{className:"highcharts-series-type-ohlc",init:function(t){this.chart.series[0].update({type:"ohlc"}),fireEvent(this,"deselectButton",{button:t})}},seriesTypeCandlestick:{className:"highcharts-series-type-candlestick",init:function(t){this.chart.series[0].update({type:"candlestick"}),fireEvent(this,"deselectButton",{button:t})}},fullScreen:{className:"highcharts-full-screen",init:function(t){var i=this.chart;i.fullScreen=new H.FullScreen(i.container),fireEvent(this,"deselectButton",{button:t})}},currentPriceIndicator:{className:"highcharts-current-price-indicator",init:function(t){var i=this.chart,n=i.series[0],e=n.options,s=e.lastVisiblePrice&&e.lastVisiblePrice.enabled,a=e.lastPrice&&e.lastPrice.enabled,o=i.stockTools,r=o.getIconsURL();o&&o.guiEnabled&&(t.firstChild.style["background-image"]=a?'url("'+r+'current-price-show.svg")':'url("'+r+'current-price-hide.svg")'),n.update({lastPrice:{enabled:!a,color:"red"},lastVisiblePrice:{enabled:!s,label:{enabled:!0}}}),fireEvent(this,"deselectButton",{button:t})}},indicators:{className:"highcharts-indicators",init:function(){var t=this;fireEvent(t,"showPopup",{formType:"indicators",options:{},onSubmit:function(i){t.utils.manageIndicators.call(t,i)}})}},toggleAnnotations:{className:"highcharts-toggle-annotations",init:function(t){var i=this.chart,n=i.stockTools,e=n.getIconsURL();this.toggledAnnotations=!this.toggledAnnotations,(i.annotations||[]).forEach(function(t){t.setVisibility(!this.toggledAnnotations)},this),n&&n.guiEnabled&&(this.toggledAnnotations?t.firstChild.style["background-image"]='url("'+e+'annotations-hidden.svg")':t.firstChild.style["background-image"]='url("'+e+'annotations-visible.svg")'),fireEvent(this,"deselectButton",{button:t})}},saveChart:{className:"highcharts-save-chart",init:function(t){var i=this,n=i.chart,e=[],s=[],a=[],o=[];n.annotations.forEach(function(t,i){e[i]=t.userOptions}),n.series.forEach(function(t){t instanceof H.seriesTypes.sma?s.push(t.userOptions):"flags"===t.type&&a.push(t.userOptions)}),n.yAxis.forEach(function(t){i.utils.isNotNavigatorYAxis(t)&&o.push(t.options)}),H.win.localStorage.setItem(PREFIX+"chart",JSON.stringify({annotations:e,indicators:s,flags:a,yAxes:o})),fireEvent(this,"deselectButton",{button:t})}}};H.setOptions({navigation:{bindings:stockToolsBindings}});