"use strict";import H from"../parts/Globals.js";import"../parts/Utilities.js";import"../parts/Options.js";import"../mixins/nodes.js";var base=H.seriesTypes.sankey.prototype;H.seriesType("dependencywheel","sankey",{center:[null,null],curveFactor:.6,startAngle:0},{orderNodes:!1,getCenter:H.seriesTypes.pie.prototype.getCenter,createNodeColumns:function(){var t=[this.createNodeColumn()];return this.nodes.forEach(function(e){e.column=0,t[0].push(e)}),t},getNodePadding:function(){return this.options.nodePadding/Math.PI},createNode:function(t){var e=base.createNode.call(this,t);return e.index=this.nodes.length-1,e.getSum=function(){return e.linksFrom.concat(e.linksTo).reduce(function(t,e){return t+e.weight},0)},e.offset=function(t){var n,a,i=0,r=e.linksFrom.concat(e.linksTo);function s(t){return t.fromNode===e?t.toNode:t.fromNode}for(r.sort(function(t,e){return s(t).index-s(e).index}),n=0;n<r.length;n++)if(s(r[n]).index>e.index){r=r.slice(0,n).reverse().concat(r.slice(n).reverse()),a=!0;break}for(a||r.reverse(),n=0;n<r.length;n++){if(r[n]===t)return i;i+=r[n].weight}},e},translate:function(){var t=this.options,e=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),n=this.getCenter(),a=(t.startAngle-90)*H.deg2rad;base.translate.call(this),this.nodeColumns[0].forEach(function(i){var r=i.shapeArgs,s=n[0],o=n[1],c=n[2]/2,h=c-t.nodeWidth,d=a+e*r.y,p=a+e*(r.y+r.height);i.angle=d+(p-d)/2,i.shapeType="arc",i.shapeArgs={x:s,y:o,r:c,innerR:h,start:d,end:p},i.dlBox={x:s+Math.cos((d+p)/2)*(c+h)/2,y:o+Math.sin((d+p)/2)*(c+h)/2,width:1,height:1},i.linksFrom.forEach(function(n){var i,r=n.linkBase.map(function(r,c){var d=e*r,p=Math.cos(a+d)*(h+1),l=Math.sin(a+d)*(h+1),u=t.curveFactor;return(i=Math.abs(n.linkBase[3-c]*e-d))>Math.PI&&(i=2*Math.PI-i),(i*=h)<h&&(u*=i/h),{x:s+p,y:o+l,cpX:s+(1-u)*p,cpY:o+(1-u)*l}});n.shapeArgs={d:["M",r[0].x,r[0].y,"A",h,h,0,0,1,r[1].x,r[1].y,"C",r[1].cpX,r[1].cpY,r[2].cpX,r[2].cpY,r[2].x,r[2].y,"A",h,h,0,0,1,r[3].x,r[3].y,"C",r[3].cpX,r[3].cpY,r[0].cpX,r[0].cpY,r[0].x,r[0].y]}})})},animate:function(t){if(!t){var e=H.animObject(this.options.animation).duration/2/this.nodes.length;this.nodes.forEach(function(t,n){var a=t.graphic;a&&(a.attr({opacity:0}),setTimeout(function(){a.animate({opacity:1},{duration:e})},e*n))},this),this.points.forEach(function(t){var e=t.graphic;!t.isNode&&e&&e.attr({opacity:0}).animate({opacity:1},this.options.animation)},this),this.animate=null}}},{setState:H.NodesMixin.setNodeState,getDataLabelPath:function(t){var e=this.series.chart.renderer,n=this.shapeArgs,a=this.angle<0||this.angle>Math.PI,i=n.start,r=n.end;return this.dataLabelPath||(this.dataLabelPath=e.arc({open:!0}).add(t)),this.dataLabelPath.attr({x:n.x,y:n.y,r:n.r+(this.dataLabel.options.distance||0),start:a?i:r,end:a?r:i,clockwise:+a}),this.dataLabelPath},isValid:function(){return!0}});