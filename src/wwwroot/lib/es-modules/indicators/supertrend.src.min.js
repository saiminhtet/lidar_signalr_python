"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isArray=U.isArray,objectEach=U.objectEach,ATR=H.seriesTypes.atr,SMA=H.seriesTypes.sma,merge=H.merge,correctFloat=H.correctFloat;function createPointObj(e,o,t){return{index:o,close:e.yData[o][t],x:e.xData[o]}}H.seriesType("supertrend","sma",{params:{multiplier:3,period:10},risingTrendColor:"#06B535",fallingTrendColor:"#F21313",changeTrendLine:{styles:{lineWidth:1,lineColor:"#333333",dashStyle:"LongDash"}}},{nameBase:"Supertrend",nameComponents:["multiplier","period"],requiredIndicators:["atr"],init:function(){var e,o;SMA.prototype.init.apply(this,arguments),e=this.options,o=this.linkedParent.options,e.cropThreshold=o.cropThreshold-(e.params.period-1)},drawGraph:function(){for(var e,o,t,r,i,l,n,s,a,p=this,c=p.options,h=p.linkedParent,d=h?h.points:[],u=p.points,y=p.graph,g=u.length,x=d.length-g,m=x>0?x:0,T={options:{gapSize:c.gapSize}},f={top:[],bottom:[],intersect:[]},C={top:{styles:{lineWidth:c.lineWidth,lineColor:c.fallingTrendColor,dashStyle:c.dashStyle}},bottom:{styles:{lineWidth:c.lineWidth,lineColor:c.risingTrendColor,dashStyle:c.dashStyle}},intersect:c.changeTrendLine};g--;)e=u[g],o=u[g-1],t=d[g-1+m],r=d[g-2+m],i=d[g+m],l=d[g+m+1],n=e.options.color,s={x:e.x,plotX:e.plotX,plotY:e.plotY,isNull:!1},!r&&t&&h.yData[t.index-1]&&(r=createPointObj(h,t.index-1,3)),!l&&i&&h.yData[i.index+1]&&(l=createPointObj(h,i.index+1,3)),!t&&r&&h.yData[r.index+1]?t=createPointObj(h,r.index+1,3):!t&&i&&h.yData[i.index-1]&&(t=createPointObj(h,i.index-1,3)),e&&t&&i&&r&&e.x!==t.x&&(e.x===i.x?(r=t,t=i):e.x===r.x?(t=r,r={close:h.yData[t.index-1][3],x:h.xData[t.index-1]}):l&&e.x===l.x&&(t=l,r=i)),o&&r&&t?(a={x:o.x,plotX:o.plotX,plotY:o.plotY,isNull:!1},e.y>=t.close&&o.y>=r.close?(e.color=n||c.fallingTrendColor,f.top.push(s)):e.y<t.close&&o.y<r.close?(e.color=n||c.risingTrendColor,f.bottom.push(s)):(f.intersect.push(s),f.intersect.push(a),f.intersect.push(merge(a,{isNull:!0})),e.y>=t.close&&o.y<r.close?(e.color=n||c.fallingTrendColor,o.color=n||c.risingTrendColor,f.top.push(s),f.top.push(merge(a,{isNull:!0}))):e.y<t.close&&o.y>=r.close&&(e.color=n||c.risingTrendColor,o.color=n||c.fallingTrendColor,f.bottom.push(s),f.bottom.push(merge(a,{isNull:!0}))))):t&&(e.y>=t.close?(e.color=n||c.fallingTrendColor,f.top.push(s)):(e.color=n||c.risingTrendColor,f.bottom.push(s)));objectEach(f,function(e,o){p.points=e,p.options=merge(C[o].styles,T),p.graph=p["graph"+o+"Line"],SMA.prototype.drawGraph.call(p),p["graph"+o+"Line"]=p.graph}),p.points=u,p.options=c,p.graph=y},getValues:function(e,o){var t,r,i,l,n,s,a,p,c,h,d=o.period,u=o.multiplier,y=e.xData,g=e.yData,x=[],m=[],T=[],f=0===d?0:d-1,C=[],b=[];if(y.length<=d||!isArray(g[0])||4!==g[0].length||d<0)return!1;for(t=ATR.prototype.getValues.call(this,e,{period:d}).yData,h=0;h<t.length;h++)c=g[f+h],p=g[f+h-1]||[],n=C[h-1],s=b[h-1],a=T[h-1],0===h&&(n=s=a=0),r=correctFloat((c[1]+c[2])/2+u*t[h]),i=correctFloat((c[1]+c[2])/2-u*t[h]),r<n||p[3]>n?C[h]=r:C[h]=n,i>s||p[3]<s?b[h]=i:b[h]=s,a===n&&c[3]<C[h]||a===s&&c[3]<b[h]?l=C[h]:(a===n&&c[3]>C[h]||a===s&&c[3]>b[h])&&(l=b[h]),x.push([y[f+h],l]),m.push(y[f+h]),T.push(l);return{values:x,xData:m,yData:T}}});