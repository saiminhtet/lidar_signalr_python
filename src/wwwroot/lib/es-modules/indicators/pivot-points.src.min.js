"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var defined=U.defined,isArray=U.isArray,SMA=H.seriesTypes.sma;function destroyExtraLabels(t,a){var e,n=t.series.pointArrayMap,o=n.length;for(SMA.prototype.pointClass.prototype[a].call(t);o--;)t[e="dataLabel"+n[o]]&&t[e].element&&t[e].destroy(),t[e]=null}H.seriesType("pivotpoints","sma",{params:{period:28,algorithm:"standard"},marker:{enabled:!1},enableMouseTracking:!1,dataLabels:{enabled:!0,format:"{point.pivotLine}"},dataGrouping:{approximation:"averages"}},{nameBase:"Pivot Points",pointArrayMap:["R4","R3","R2","R1","P","S1","S2","S3","S4"],pointValKey:"P",toYData:function(t){return[t.P]},translate:function(){var t=this;SMA.prototype.translate.apply(t),t.points.forEach(function(a){t.pointArrayMap.forEach(function(e){defined(a[e])&&(a["plot"+e]=t.yAxis.toPixels(a[e],!0))})}),t.plotEndPoint=t.xAxis.toPixels(t.endPoint,!0)},getGraphPath:function(t){for(var a,e,n,o=this,l=t.length,r=[[],[],[],[],[],[],[],[],[]],i=[],s=o.plotEndPoint,p=o.pointArrayMap.length;l--;){for(e=t[l],n=0;n<p;n++)a=o.pointArrayMap[n],defined(e[a])&&r[n].push({plotX:e.plotX,plotY:e["plot"+a],isNull:!1},{plotX:s,plotY:e["plot"+a],isNull:!1},{plotX:s,plotY:null,isNull:!0});s=e.plotX}return r.forEach(function(t){i=i.concat(SMA.prototype.getGraphPath.call(o,t))}),i},drawDataLabels:function(){var t,a,e,n,o=this,l=o.pointArrayMap;o.options.dataLabels.enabled&&(a=o.points.length,l.concat([!1]).forEach(function(r,i){for(n=a;n--;)e=o.points[n],r?(e.y=e[r],e.pivotLine=r,e.plotY=e["plot"+r],t=e["dataLabel"+r],i&&(e["dataLabel"+l[i-1]]=e.dataLabel),e.dataLabels||(e.dataLabels=[]),e.dataLabels[0]=e.dataLabel=t=t&&t.element?t:null):e["dataLabel"+l[i-1]]=e.dataLabel;SMA.prototype.drawDataLabels.apply(o,arguments)}))},getValues:function(t,a){var e,n,o,l,r,i,s,p=a.period,d=t.xData,u=t.yData,c=u?u.length:0,f=this[a.algorithm+"Placement"],h=[],y=[],m=[];if(d.length<p||!isArray(u[0])||4!==u[0].length)return!1;for(s=p+1;s<=c+p;s+=p)o=d.slice(s-p-1,s),l=u.slice(s-p-1,s),e=o[(n=o.length)-1],i=f(this.getPivotAndHLC(l)),r=h.push([e].concat(i)),y.push(e),m.push(h[r-1].slice(1));return this.endPoint=o[0]+(e-o[0])/n*p,{values:h,xData:y,yData:m}},getPivotAndHLC:function(t){var a=-1/0,e=1/0,n=t[t.length-1][3];return t.forEach(function(t){a=Math.max(a,t[1]),e=Math.min(e,t[2])}),[(a+e+n)/3,a,e,n]},standardPlacement:function(t){var a=t[1]-t[2];return[null,null,t[0]+a,2*t[0]-t[2],t[0],2*t[0]-t[1],t[0]-a,null,null]},camarillaPlacement:function(t){var a=t[1]-t[2];return[t[3]+1.5*a,t[3]+1.25*a,t[3]+1.1666*a,t[3]+1.0833*a,t[0],t[3]-1.0833*a,t[3]-1.1666*a,t[3]-1.25*a,t[3]-1.5*a]},fibonacciPlacement:function(t){var a=t[1]-t[2];return[null,t[0]+a,t[0]+.618*a,t[0]+.382*a,t[0],t[0]-.382*a,t[0]-.618*a,t[0]-a,null]}},{destroyElements:function(){destroyExtraLabels(this,"destroyElements")},destroy:function(){destroyExtraLabels(this,"destroyElements")}});