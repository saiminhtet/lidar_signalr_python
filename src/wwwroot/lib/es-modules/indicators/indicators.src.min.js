"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var extend=U.extend,isArray=U.isArray,pick=U.pick,splat=U.splat;import requiredIndicatorMixin from"../mixins/indicator-required.js";var error=H.error,Series=H.Series,addEvent=H.addEvent,seriesType=H.seriesType,seriesTypes=H.seriesTypes,ohlcProto=H.seriesTypes.ohlc.prototype,generateMessage=requiredIndicatorMixin.generateMessage;addEvent(H.Series,"init",function(e){var a=e.options;a.useOhlcData&&"highcharts-navigator-series"!==a.id&&extend(this,{pointValKey:ohlcProto.pointValKey,keys:ohlcProto.keys,pointArrayMap:ohlcProto.pointArrayMap,toYData:ohlcProto.toYData})}),addEvent(Series,"afterSetOptions",function(e){var a=e.options,t=a.dataGrouping;t&&a.useOhlcData&&"highcharts-navigator-series"!==a.id&&(t.approximation="ohlc")}),seriesType("sma","line",{name:void 0,tooltip:{valueDecimals:4},linkedTo:void 0,compareToMain:!1,params:{index:0,period:14}},{processData:function(){var e=this.options.compareToMain,a=this.linkedParent;Series.prototype.processData.apply(this,arguments),a&&a.compareValue&&e&&(this.compareValue=a.compareValue)},bindTo:{series:!0,eventName:"updatedData"},hasDerivedData:!0,useCommonDataGrouping:!0,nameComponents:["period"],nameSuffixes:[],calculateOn:"init",requiredIndicators:[],requireIndicators:function(){var e={allLoaded:!0};return this.requiredIndicators.forEach(function(a){seriesTypes[a]?seriesTypes[a].prototype.requireIndicators():(e.allLoaded=!1,e.needed=a)}),e},init:function(e,a){var t=this,i=t.requireIndicators();if(!i.allLoaded)return error(generateMessage(t.type,i.needed));function r(){var e,a,i,r,n,s,o=t.points||[],p=(t.xData||[]).length,d=t.getValues(t.linkedParent,t.options.params)||{values:[],xData:[],yData:[]},l=[],c=!0;if(p&&!t.hasGroupedData&&t.visible&&t.points)if(t.cropped){for(t.xAxis&&(r=t.xAxis.min,n=t.xAxis.max),i=t.cropData(d.xData,d.yData,r,n),s=0;s<i.xData.length;s++)l.push([i.xData[s]].concat(splat(i.yData[s])));e=d.xData.indexOf(t.xData[0]),a=d.xData.indexOf(t.xData[t.xData.length-1]),-1===e&&a===d.xData.length-2&&l[0][0]===o[0].x&&l.shift(),t.updateData(l)}else d.xData.length!==p-1&&d.xData.length!==p+1&&(c=!1,t.updateData(d.values));c&&(t.xData=d.xData,t.yData=d.yData,t.options.data=d.values),!1===t.bindTo.series&&(delete t.processedXData,t.isDirty=!0,t.redraw()),t.isDirtyData=!1}if(Series.prototype.init.call(t,e,a),e.linkSeries(),t.dataEventsToUnbind=[],!t.linkedParent)return error("Series "+t.options.linkedTo+" not found! Check `linkedTo`.",!1,e);if(t.dataEventsToUnbind.push(addEvent(t.bindTo.series?t.linkedParent:t.linkedParent.xAxis,t.bindTo.eventName,r)),"init"===t.calculateOn)r();else var n=addEvent(t.chart,t.calculateOn,function(){r(),n()});return t},getName:function(){var e=this.name,a=[];return e||((this.nameComponents||[]).forEach(function(e,t){a.push(this.options.params[e]+pick(this.nameSuffixes[t],""))},this),e=(this.nameBase||this.type.toUpperCase())+(this.nameComponents?" ("+a.join(", ")+")":"")),e},getValues:function(e,a){var t,i,r=a.period,n=e.xData,s=e.yData,o=s.length,p=0,d=0,l=[],c=[],u=[],h=-1;if(n.length<r)return!1;for(isArray(s[0])&&(h=a.index?a.index:0);p<r-1;)d+=h<0?s[p]:s[p][h],p++;for(t=p;t<o;t++)d+=h<0?s[t]:s[t][h],i=[n[t],d/r],l.push(i),c.push(i[0]),u.push(i[1]),d-=h<0?s[t-p]:s[t-p][h];return{values:l,xData:c,yData:u}},destroy:function(){this.dataEventsToUnbind.forEach(function(e){e()}),Series.prototype.destroy.call(this)}});