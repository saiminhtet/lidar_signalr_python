"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isArray=U.isArray;import multipleLinesMixin from"../mixins/multipe-lines.js";var merge=H.merge,SMA=H.seriesTypes.sma;function getStandardDeviation(t,i,e,o){for(var a,r=0,n=t.length,s=0;s<n;s++)r+=(a=(e?t[s][i]:t[s])-o)*a;return r/=n-1,Math.sqrt(r)}H.seriesType("bb","sma",{params:{period:20,standardDeviation:2,index:3},bottomLine:{styles:{lineWidth:1,lineColor:void 0}},topLine:{styles:{lineWidth:1,lineColor:void 0}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span><b> {series.name}</b><br/>Top: {point.top}<br/>Middle: {point.middle}<br/>Bottom: {point.bottom}<br/>'},marker:{enabled:!1},dataGrouping:{approximation:"averages"}},H.merge(multipleLinesMixin,{pointArrayMap:["top","middle","bottom"],pointValKey:"middle",nameComponents:["period","standardDeviation"],linesApiNames:["topLine","bottomLine"],init:function(){SMA.prototype.init.apply(this,arguments),this.options=merge({topLine:{styles:{lineColor:this.color}},bottomLine:{styles:{lineColor:this.color}}},this.options)},getValues:function(t,i){var e,o,a,r,n,s,l,p,m,d,y=i.period,u=i.standardDeviation,b=t.xData,h=t.yData,g=h?h.length:0,v=[],D=[],c=[];if(b.length<y)return!1;for(p=isArray(h[0]),d=y;d<=g;d++)n=b.slice(d-y,d),s=h.slice(d-y,d),r=(m=SMA.prototype.getValues.call(this,{xData:n,yData:s},i)).xData[0],o=(e=m.yData[0])+u*(l=getStandardDeviation(s,i.index,p,e)),a=e-u*l,v.push([r,o,e,a]),D.push(r),c.push([o,e,a]);return{values:v,xData:D,yData:c}}}));