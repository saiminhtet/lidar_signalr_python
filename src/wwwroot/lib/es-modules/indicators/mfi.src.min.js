"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var isArray=U.isArray;function sumArray(e){return e.reduce(function(e,r){return e+r})}function toFixed(e,r){return parseFloat(e.toFixed(r))}function calculateTypicalPrice(e){return(e[1]+e[2]+e[3])/3}function calculateRawMoneyFlow(e,r){return e*r}H.seriesType("mfi","sma",{params:{period:14,volumeSeriesID:"volume",decimals:4}},{nameBase:"Money Flow Index",getValues:function(e,r){var a,t,i,u,l,s,c=r.period,o=e.xData,n=e.yData,p=n?n.length:0,m=r.decimals,y=1,f=e.chart.get(r.volumeSeriesID),h=f&&f.yData,d=[],D=!1,v=[],F=[],w=[],x=[];if(!f)return H.error("Series "+r.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,e.chart);if(o.length<=c||!isArray(n[0])||4!==n[0].length||!h)return!1;for(a=calculateTypicalPrice(n[y]);y<c+1;)t=a,D=(a=calculateTypicalPrice(n[y]))>=t,i=calculateRawMoneyFlow(a,h[y]),w.push(D?i:0),x.push(D?0:i),y++;for(s=y-1;s<p;s++)s>y-1&&(w.shift(),x.shift(),t=a,D=(a=calculateTypicalPrice(n[s]))>t,i=calculateRawMoneyFlow(a,h[s]),w.push(D?i:0),x.push(D?0:i)),u=sumArray(x),l=toFixed(100-100/(1+sumArray(w)/u),m),d.push([o[s],l]),v.push(o[s]),F.push(l);return{values:d,xData:v,yData:F}}});