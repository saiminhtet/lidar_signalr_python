"use strict";import H from"../parts/Globals.js";import U from"../parts/Utilities.js";var erase=U.erase,extend=U.extend,isNumber=U.isNumber,pick=U.pick,splat=U.splat;import"../parts/Axis.js";import"../parts/Chart.js";import"../parts/Color.js";import"../parts/Legend.js";import"./ColorSeriesMixin.js";var ColorAxis,addEvent=H.addEvent,Axis=H.Axis,Chart=H.Chart,Series=H.Series,Point=H.Point,color=H.color,Legend=H.Legend,LegendSymbolMixin=H.LegendSymbolMixin,colorPointMixin=H.colorPointMixin,colorSeriesMixin=H.colorSeriesMixin,noop=H.noop,merge=H.merge;extend(Series.prototype,colorSeriesMixin),extend(Point.prototype,colorPointMixin),ColorAxis=H.ColorAxis=function(){this.init.apply(this,arguments)},extend(ColorAxis.prototype,Axis.prototype),extend(ColorAxis.prototype,{defaultColorAxisOptions:{lineWidth:0,minPadding:0,maxPadding:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{overflow:"justify",rotation:0},minColor:"#e6ebf5",maxColor:"#003399",tickLength:5,showInLegend:!0},keepProps:["legendGroup","legendItemHeight","legendItemWidth","legendItem","legendSymbol"].concat(Axis.prototype.keepProps),init:function(t,i){var e;this.coll="colorAxis",e=this.buildOptions.call(t,this.defaultColorAxisOptions,i),Axis.prototype.init.call(this,t,e),i.dataClasses&&this.initDataClasses(i),this.initStops(),this.horiz=!e.opposite,this.zoomEnabled=!1,this.defaultLegendLength=200},initDataClasses:function(t){var i,e=this.chart,o=0,s=e.options.chart.colorCount,r=this.options,n=t.dataClasses.length;this.dataClasses=i=[],this.legendItems=[],t.dataClasses.forEach(function(t,a){var l;t=merge(t),i.push(t),!e.styledMode&&t.color||("category"===r.dataClassColor?(e.styledMode||(l=e.options.colors,s=l.length,t.color=l[o]),t.colorIndex=o,++o===s&&(o=0)):t.color=color(r.minColor).tweenTo(color(r.maxColor),n<2?.5:a/(n-1)))})},hasData:function(){return!(!this.tickPositions||!this.tickPositions.length)},setTickPositions:function(){if(!this.dataClasses)return Axis.prototype.setTickPositions.call(this)},initStops:function(){this.stops=this.options.stops||[[0,this.options.minColor],[1,this.options.maxColor]],this.stops.forEach(function(t){t.color=color(t[1])})},buildOptions:function(t,i){var e=this.options.legend,o=i.layout?"vertical"!==i.layout:"vertical"!==e.layout;return merge(t,{side:o?2:1,reversed:!o},i,{opposite:!o,showEmpty:!1,title:null,visible:e.enabled&&(!i||!1!==i.visible)})},setOptions:function(t){Axis.prototype.setOptions.call(this,t),this.options.crosshair=this.options.marker},setAxisSize:function(){var t,i,e,o,s=this.legendSymbol,r=this.chart,n=r.options.legend||{};s?(this.left=t=s.attr("x"),this.top=i=s.attr("y"),this.width=e=s.attr("width"),this.height=o=s.attr("height"),this.right=r.chartWidth-t-e,this.bottom=r.chartHeight-i-o,this.len=this.horiz?e:o,this.pos=this.horiz?t:i):this.len=(this.horiz?n.symbolWidth:n.symbolHeight)||this.defaultLegendLength},normalizedValue:function(t){return this.isLog&&(t=this.val2lin(t)),1-(this.max-t)/(this.max-this.min||1)},toColor:function(t,i){var e,o,s,r,n,a,l=this.stops,h=this.dataClasses;if(h){for(a=h.length;a--;)if(o=(n=h[a]).from,s=n.to,(void 0===o||t>=o)&&(void 0===s||t<=s)){r=n.color,i&&(i.dataClass=a,i.colorIndex=n.colorIndex);break}}else{for(e=this.normalizedValue(t),a=l.length;a--&&!(e>l[a][0]););o=l[a]||l[a+1],e=1-((s=l[a+1]||o)[0]-e)/(s[0]-o[0]||1),r=o.color.tweenTo(s.color,e)}return r},getOffset:function(){var t=this.legendGroup,i=this.chart.axisOffset[this.side];t&&(this.axisParent=t,Axis.prototype.getOffset.call(this),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=i)},setLegendColor:function(){var t,i=this.horiz,e=this.reversed,o=e?1:0,s=e?0:1;t=i?[o,0,s,0]:[0,s,0,o],this.legendColor={linearGradient:{x1:t[0],y1:t[1],x2:t[2],y2:t[3]},stops:this.stops}},drawLegendSymbol:function(t,i){var e=t.padding,o=t.options,s=this.horiz,r=pick(o.symbolWidth,s?this.defaultLegendLength:12),n=pick(o.symbolHeight,s?12:this.defaultLegendLength),a=pick(o.labelPadding,s?16:30),l=pick(o.itemDistance,10);this.setLegendColor(),i.legendSymbol=this.chart.renderer.rect(0,t.baseline-11,r,n).attr({zIndex:1}).add(i.legendGroup),this.legendItemWidth=r+e+(s?l:a),this.legendItemHeight=n+e+(s?a:0)},setState:function(t){this.series.forEach(function(i){i.setState(t)})},visible:!0,setVisible:noop,getSeriesExtremes:function(){var t,i,e,o,s,r,n,a,l=this.series,h=l.length;for(this.dataMin=1/0,this.dataMax=-1/0;h--;){if(i=(r=l[h]).colorKey=pick(r.options.colorKey,r.colorKey,r.pointValKey,r.zoneAxis,"y"),o=r.pointArrayMap,s=r[i+"Min"]&&r[i+"Max"],r[i+"Data"])t=r[i+"Data"];else if(o){if(t=[],e=o.indexOf(i),n=r.yData,e>=0&&n)for(a=0;a<n.length;a++)t.push(pick(n[a][e],n[a]))}else t=r.yData;s?(r.minColorValue=r[i+"Min"],r.maxColorValue=r[i+"Max"]):(Series.prototype.getExtremes.call(r,t),r.minColorValue=r.dataMin,r.maxColorValue=r.dataMax),void 0!==r.minColorValue&&(this.dataMin=Math.min(this.dataMin,r.minColorValue),this.dataMax=Math.max(this.dataMax,r.maxColorValue)),s||Series.prototype.getExtremes.call(r)}},drawCrosshair:function(t,i){var e,o=i&&i.plotX,s=i&&i.plotY,r=this.pos,n=this.len;i&&((e=this.toPixels(i[i.series.colorKey]))<r?e=r-2:e>r+n&&(e=r+n+2),i.plotX=e,i.plotY=this.len-e,Axis.prototype.drawCrosshair.call(this,t,i),i.plotX=o,i.plotY=s,this.cross&&!this.cross.addedToColorAxis&&this.legendGroup&&(this.cross.addClass("highcharts-coloraxis-marker").add(this.legendGroup),this.cross.addedToColorAxis=!0,this.chart.styledMode||this.cross.attr({fill:this.crosshair.color})))},getPlotLinePath:function(t){var i=t.translatedValue;return isNumber(i)?this.horiz?["M",i-4,this.top-6,"L",i+4,this.top-6,i,this.top,"Z"]:["M",this.left,i,"L",this.left-6,i+6,this.left-6,i-6,"Z"]:Axis.prototype.getPlotLinePath.apply(this,arguments)},update:function(t,i){var e=this.chart,o=e.legend,s=this.buildOptions.call(e,{},t);this.series.forEach(function(t){t.isDirtyData=!0}),(t.dataClasses&&o.allItems||this.dataClasses)&&this.destroyItems(),e.options[this.coll]=merge(this.userOptions,s),Axis.prototype.update.call(this,s,i),this.legendItem&&(this.setLegendColor(),o.colorizeItem(this,!0))},destroyItems:function(){var t=this.chart;this.legendItem?t.legend.destroyItem(this):this.legendItems&&this.legendItems.forEach(function(i){t.legend.destroyItem(i)}),t.isDirtyLegend=!0},remove:function(t){this.destroyItems(),Axis.prototype.remove.call(this,t)},getDataClassLegendSymbols:function(){var t,i=this,e=this.chart,o=this.legendItems,s=e.options.legend,r=s.valueDecimals,n=s.valueSuffix||"";return o.length||this.dataClasses.forEach(function(s,a){var l=!0,h=s.from,d=s.to;t="",void 0===h?t="< ":void 0===d&&(t="> "),void 0!==h&&(t+=H.numberFormat(h,r)+n),void 0!==h&&void 0!==d&&(t+=" - "),void 0!==d&&(t+=H.numberFormat(d,r)+n),o.push(extend({chart:e,name:t,options:{},drawLegendSymbol:LegendSymbolMixin.drawRectangle,visible:!0,setState:noop,isDataClass:!0,setVisible:function(){l=this.visible=!l,i.series.forEach(function(t){t.points.forEach(function(t){t.dataClass===a&&t.setVisible(l)})}),e.legend.colorizeItem(this,l)}},s))}),o},beforePadding:!1,name:""}),["fill","stroke"].forEach(function(t){H.Fx.prototype[t+"Setter"]=function(){this.elem.attr(t,color(this.start).tweenTo(color(this.end),this.pos),null,!0)}}),addEvent(Chart,"afterGetAxes",function(){var t=this,i=t.options;this.colorAxis=[],i.colorAxis&&(i.colorAxis=splat(i.colorAxis),i.colorAxis.forEach(function(i,e){i.index=e,new ColorAxis(t,i)}))}),addEvent(Series,"bindAxes",function(){var t=this.axisTypes;t?-1===t.indexOf("colorAxis")&&t.push("colorAxis"):this.axisTypes=["colorAxis"]}),addEvent(Legend,"afterGetAllItems",function(t){var i,e,o=[];for((this.chart.colorAxis||[]).forEach(function(e){(i=e.options)&&i.showInLegend&&(i.dataClasses&&i.visible?o=o.concat(e.getDataClassLegendSymbols()):i.visible&&o.push(e),e.series.forEach(function(e){e.options.showInLegend&&!i.dataClasses||("point"===e.options.legendType?e.points.forEach(function(i){erase(t.allItems,i)}):erase(t.allItems,e))}))}),e=o.length;e--;)t.allItems.unshift(o[e])}),addEvent(Legend,"afterColorizeItem",function(t){t.visible&&t.item.legendColor&&t.item.legendSymbol.attr({fill:t.item.legendColor})}),addEvent(Legend,"afterUpdate",function(){var t=this.chart.colorAxis;t&&t.forEach(function(t){t.update({},arguments[2])})}),addEvent(Series,"afterTranslate",function(){(this.chart.colorAxis&&this.chart.colorAxis.length||this.colorAttribs)&&this.translateColors()});