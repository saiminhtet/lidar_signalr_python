"use strict";import H from"./Globals.js";import U from"./Utilities.js";var defined=U.defined,extend=U.extend,isArray=U.isArray,isObject=U.isObject,objectEach=U.objectEach,pick=U.pick;import"./Chart.js";import"./Options.js";import"./Legend.js";import"./Point.js";import"./Series.js";var TrackerMixin,addEvent=H.addEvent,Chart=H.Chart,createElement=H.createElement,css=H.css,defaultOptions=H.defaultOptions,defaultPlotOptions=H.defaultPlotOptions,fireEvent=H.fireEvent,hasTouch=H.hasTouch,Legend=H.Legend,merge=H.merge,Point=H.Point,Series=H.Series,seriesTypes=H.seriesTypes,svg=H.svg;TrackerMixin=H.TrackerMixin={drawTrackerPoint:function(){var t,e=this,i=e.chart,o=i.pointer,s=function(t){var e=o.getPointFromEvent(t);void 0!==e&&(o.isDirectTouch=!0,e.onMouseOver(t))};e.points.forEach(function(e){t=isArray(e.dataLabels)?e.dataLabels:e.dataLabel?[e.dataLabel]:[],e.graphic&&(e.graphic.element.point=e),t.forEach(function(t){t.div?t.div.point=e:t.element.point=e})}),e._hasTracking||(e.trackerGroups.forEach(function(t){e[t]&&(e[t].addClass("highcharts-tracker").on("mouseover",s).on("mouseout",function(t){o.onTrackerMouseOut(t)}),hasTouch&&e[t].on("touchstart",s),!i.styledMode&&e.options.cursor&&e[t].css(css).css({cursor:e.options.cursor}))}),e._hasTracking=!0),fireEvent(this,"afterDrawTracker")},drawTrackerGraph:function(){var t,e=this,i=e.options,o=i.trackByArea,s=[].concat(o?e.areaPath:e.graphPath),r=s.length,n=e.chart,a=n.pointer,c=n.renderer,h=n.options.tooltip.snap,l=e.tracker,d=function(){n.hoverSeries!==e&&e.onMouseOver()},p="rgba(192,192,192,"+(svg?1e-4:.002)+")";if(r&&!o)for(t=r+1;t--;)"M"===s[t]&&s.splice(t+1,0,s[t+1]-h,s[t+2],"L"),(t&&"M"===s[t]||t===r)&&s.splice(t,0,"L",s[t-2]+h,s[t-1]);l?l.attr({d:s}):e.graph&&(e.tracker=c.path(s).attr({visibility:e.visible?"visible":"hidden",zIndex:2}).addClass(o?"highcharts-tracker-area":"highcharts-tracker-line").add(e.group),n.styledMode||e.tracker.attr({"stroke-linejoin":"round",stroke:p,fill:o?p:"none","stroke-width":e.graph.strokeWidth()+(o?0:2*h)}),[e.tracker,e.markerGroup].forEach(function(t){t.addClass("highcharts-tracker").on("mouseover",d).on("mouseout",function(t){a.onTrackerMouseOut(t)}),i.cursor&&!n.styledMode&&t.css({cursor:i.cursor}),hasTouch&&t.on("touchstart",d)})),fireEvent(this,"afterDrawTracker")}},seriesTypes.column&&(seriesTypes.column.prototype.drawTracker=TrackerMixin.drawTrackerPoint),seriesTypes.pie&&(seriesTypes.pie.prototype.drawTracker=TrackerMixin.drawTrackerPoint),seriesTypes.scatter&&(seriesTypes.scatter.prototype.drawTracker=TrackerMixin.drawTrackerPoint),extend(Legend.prototype,{setItemEvents:function(t,e,i){var o=this,s=o.chart.renderer.boxWrapper,r=t instanceof Point,n="highcharts-legend-"+(r?"point":"series")+"-active",a=o.chart.styledMode;(i?e:t.legendGroup).on("mouseover",function(){t.visible&&o.allItems.forEach(function(e){t!==e&&e.setState("inactive",!r)}),t.setState("hover"),t.visible&&s.addClass(n),a||e.css(o.options.itemHoverStyle)}).on("mouseout",function(){o.chart.styledMode||e.css(merge(t.visible?o.itemStyle:o.itemHiddenStyle)),o.allItems.forEach(function(e){t!==e&&e.setState("",!r)}),s.removeClass(n),t.setState()}).on("click",function(e){var i=function(){t.setVisible&&t.setVisible(),o.allItems.forEach(function(e){t!==e&&e.setState(t.visible?"inactive":"",!r)})};s.removeClass(n),e={browserEvent:e},t.firePointEvent?t.firePointEvent("legendItemClick",e,i):fireEvent(t,"legendItemClick",e,i)})},createCheckboxForItem:function(t){t.checkbox=createElement("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:t.selected,defaultChecked:t.selected},this.options.itemCheckboxStyle,this.chart.container),addEvent(t.checkbox,"click",function(e){var i=e.target;fireEvent(t.series||t,"checkboxClick",{checked:i.checked,item:t},function(){t.select()})})}}),extend(Chart.prototype,{showResetZoom:function(){var t=this,e=defaultOptions.lang,i=t.options.chart.resetZoomButton,o=i.theme,s=o.states,r="chart"===i.relativeTo||"spaceBox"===i.relativeTo?null:"plotBox";function n(){t.zoomOut()}fireEvent(this,"beforeShowResetZoom",null,function(){t.resetZoomButton=t.renderer.button(e.resetZoom,null,null,n,o,s&&s.hover).attr({align:i.position.align,title:e.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(i.position,!1,r)}),fireEvent(this,"afterShowResetZoom")},zoomOut:function(){fireEvent(this,"selection",{resetSelection:!0},this.zoom)},zoom:function(t){var e,i,o=this,s=o.pointer,r=!1,n=o.inverted?s.mouseDownX:s.mouseDownY;!t||t.resetSelection?(o.axes.forEach(function(t){e=t.zoom()}),s.initiated=!1):t.xAxis.concat(t.yAxis).forEach(function(t){var i=t.axis,a=o.inverted?i.left:i.top,c=o.inverted?a+i.width:a+i.height,h=i.isXAxis,l=!1;(!h&&n>=a&&n<=c||h||!defined(n))&&(l=!0),s[h?"zoomX":"zoomY"]&&l&&(e=i.zoom(t.min,t.max),i.displayBtn&&(r=!0))}),i=o.resetZoomButton,r&&!i?o.showResetZoom():!r&&isObject(i)&&(o.resetZoomButton=i.destroy()),e&&o.redraw(pick(o.options.chart.animation,t&&t.animation,o.pointCount<100))},pan:function(t,e){var i,o=this,s=o.hoverPoints;fireEvent(this,"pan",{originalEvent:t},function(){s&&s.forEach(function(t){t.setState()}),("xy"===e?[1,0]:[1]).forEach(function(e){var s,r=o[e?"xAxis":"yAxis"][0],n=r.horiz,a=t[n?"chartX":"chartY"],c=n?"mouseDownX":"mouseDownY",h=o[c],l=(r.pointRange||0)/2,d=r.reversed&&!o.inverted||!r.reversed&&o.inverted?-1:1,p=r.getExtremes(),u=r.toValue(h-a,!0)+l*d,m=r.toValue(h+r.len-a,!0)-l*d,f=m<u,v=f?m:u,k=f?u:m,g=Math.min(p.dataMin,l?p.min:r.toValue(r.toPixels(p.min)-r.minPixelPadding)),b=Math.max(p.dataMax,l?p.max:r.toValue(r.toPixels(p.max)+r.minPixelPadding));(s=g-v)>0&&(k+=s,v=g),(s=k-b)>0&&(k=b,v-=s),r.series.length&&v!==p.min&&k!==p.max&&(r.setExtremes(v,k,!1,!1,{trigger:"pan"}),i=!0),o[c]=a}),i&&o.redraw(!1),css(o.container,{cursor:"move"})})}}),extend(Point.prototype,{select:function(t,e){var i=this,o=i.series,s=o.chart;t=pick(t,!i.selected),this.selectedStaging=t,i.firePointEvent(t?"select":"unselect",{accumulate:e},function(){i.selected=i.options.selected=t,o.options.data[o.data.indexOf(i)]=i.options,i.setState(t&&"select"),e||s.getSelectedPoints().forEach(function(t){var e=t.series;t.selected&&t!==i&&(t.selected=t.options.selected=!1,e.options.data[e.data.indexOf(t)]=t.options,t.setState(s.hoverPoints&&e.options.inactiveOtherPoints?"inactive":""),t.firePointEvent("unselect"))})}),delete this.selectedStaging},onMouseOver:function(t){var e=this.series.chart,i=e.pointer;t=t?i.normalize(t):i.getChartCoordinatesFromPoint(this,e.inverted),i.runPointActions(t,this)},onMouseOut:function(){var t=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(t.hoverPoints||[]).forEach(function(t){t.setState()}),t.hoverPoints=t.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var t=this,e=merge(t.series.options.point,t.options).events;t.events=e,objectEach(e,function(e,i){H.isFunction(e)&&addEvent(t,i,e)}),this.hasImportedEvents=!0}},setState:function(t,e){var i,o,s,r,n,a=this.series,c=this.state,h=a.options.states[t||"normal"]||{},l=defaultPlotOptions[a.type].marker&&a.options.marker,d=l&&!1===l.enabled,p=l&&l.states&&l.states[t||"normal"]||{},u=!1===p.enabled,m=a.stateMarkerGraphic,f=this.marker||{},v=a.chart,k=a.halo,g=l&&a.markerAttribs;if(!((t=t||"")===this.state&&!e||this.selected&&"select"!==t||!1===h.enabled||t&&(u||d&&!1===p.enabled)||t&&f.states&&f.states[t]&&!1===f.states[t].enabled)){this.state=t,g&&(o=a.markerAttribs(this,t)),this.graphic?(c&&this.graphic.removeClass("highcharts-point-"+c),t&&this.graphic.addClass("highcharts-point-"+t),v.styledMode||(s=a.pointAttribs(this,t),r=pick(v.options.chart.animation,h.animation),a.options.inactiveOtherPoints&&((this.dataLabels||[]).forEach(function(t){t&&t.animate({opacity:s.opacity},r)}),this.connector&&this.connector.animate({opacity:s.opacity},r)),this.graphic.animate(s,r)),o&&this.graphic.animate(o,pick(v.options.chart.animation,p.animation,l.animation)),m&&m.hide()):(t&&p&&(n=f.symbol||a.symbol,m&&m.currentSymbol!==n&&(m=m.destroy()),o&&(m?m[e?"animate":"attr"]({x:o.x,y:o.y}):n&&(a.stateMarkerGraphic=m=v.renderer.symbol(n,o.x,o.y,o.width,o.height).add(a.markerGroup),m.currentSymbol=n)),!v.styledMode&&m&&m.attr(a.pointAttribs(this,t))),m&&(m[t&&this.isInside?"show":"hide"](),m.element.point=this)),i=h.halo;var b=this.graphic||m,y=b&&b.visibility||"inherit";i&&i.size&&b&&"hidden"!==y?(k||(a.halo=k=v.renderer.path().add(b.parentGroup)),k.show()[e?"animate":"attr"]({d:this.haloPath(i.size)}),k.attr({class:"highcharts-halo highcharts-color-"+pick(this.colorIndex,a.colorIndex)+(this.className?" "+this.className:""),visibility:y,zIndex:-1}),k.point=this,v.styledMode||k.attr(extend({fill:this.color||a.color,"fill-opacity":i.opacity},i.attributes))):k&&k.point&&k.point.haloPath&&k.animate({d:k.point.haloPath(0)},null,k.hide),fireEvent(this,"afterSetState")}},haloPath:function(t){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-t,this.plotY-t,2*t,2*t)}}),extend(Series.prototype,{onMouseOver:function(){var t=this.chart,e=t.hoverSeries;e&&e!==this&&e.onMouseOut(),this.options.events.mouseOver&&fireEvent(this,"mouseOver"),this.setState("hover"),t.hoverSeries=this},onMouseOut:function(){var t=this.options,e=this.chart,i=e.tooltip,o=e.hoverPoint;e.hoverSeries=null,o&&o.onMouseOut(),this&&t.events.mouseOut&&fireEvent(this,"mouseOut"),!i||this.stickyTracking||i.shared&&!this.noSharedTooltip||i.hide(),e.series.forEach(function(t){t.setState("",!0)})},setState:function(t,e){var i,o=this,s=o.options,r=o.graph,n=s.inactiveOtherPoints,a=s.states,c=s.lineWidth,h=s.opacity,l=pick(a[t||"normal"]&&a[t||"normal"].animation,o.chart.options.chart.animation),d=0;if(t=t||"",o.state!==t&&([o.group,o.markerGroup,o.dataLabelsGroup].forEach(function(e){e&&(o.state&&e.removeClass("highcharts-series-"+o.state),t&&e.addClass("highcharts-series-"+t))}),o.state=t,!o.chart.styledMode)){if(a[t]&&!1===a[t].enabled)return;if(t&&(c=a[t].lineWidth||c+(a[t].lineWidthPlus||0),h=pick(a[t].opacity,h)),r&&!r.dashstyle)for(i={"stroke-width":c},r.animate(i,l);o["zone-graph-"+d];)o["zone-graph-"+d].attr(i),d+=1;n||[o.group,o.markerGroup,o.dataLabelsGroup,o.labelBySeries].forEach(function(t){t&&t.animate({opacity:h},l)})}e&&n&&o.points&&o.setAllPointsToState(t)},setAllPointsToState:function(t){this.points.forEach(function(e){e.setState&&e.setState(t)})},setVisible:function(t,e){var i,o=this,s=o.chart,r=o.legendItem,n=s.options.chart.ignoreHiddenSeries,a=o.visible;o.visible=t=o.options.visible=o.userOptions.visible=void 0===t?!a:t,i=t?"show":"hide",["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(function(t){o[t]&&o[t][i]()}),s.hoverSeries!==o&&(s.hoverPoint&&s.hoverPoint.series)!==o||o.onMouseOut(),r&&s.legend.colorizeItem(o,t),o.isDirty=!0,o.options.stacking&&s.series.forEach(function(t){t.options.stacking&&t.visible&&(t.isDirty=!0)}),o.linkedSeries.forEach(function(e){e.setVisible(t,!1)}),n&&(s.isDirtyBox=!0),fireEvent(o,i),!1!==e&&s.redraw()},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(t){this.selected=t=this.options.selected=void 0===t?!this.selected:t,this.checkbox&&(this.checkbox.checked=t),fireEvent(this,t?"select":"unselect")},drawTracker:TrackerMixin.drawTrackerGraph});