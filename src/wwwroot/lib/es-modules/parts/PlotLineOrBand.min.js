"use strict";import H from"./Globals.js";import Axis from"./Axis.js";import U from"./Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,extend=U.extend,objectEach=U.objectEach,pick=U.pick,merge=H.merge;H.PlotLineOrBand=function(t,e){this.axis=t,e&&(this.options=e,this.id=e.id)},H.PlotLineOrBand.prototype={render:function(){H.fireEvent(this,"render");var t,e=this,i=e.axis,n=i.horiz,r=e.options,s=r.label,a=e.label,o=r.to,d=r.from,l=r.value,h=defined(d)&&defined(o),c=defined(l),f=e.svgElem,p=!f,u=[],g=r.color,P=pick(r.zIndex,0),x=r.events,L={class:"highcharts-plot-"+(h?"band ":"line ")+(r.className||"")},m={},y=i.chart.renderer,b=h?"bands":"lines";if(i.isLog&&(d=i.log2lin(d),o=i.log2lin(o),l=i.log2lin(l)),i.chart.styledMode||(c?(L.stroke=g||"#999999",L["stroke-width"]=pick(r.width,1),r.dashStyle&&(L.dashstyle=r.dashStyle)):h&&(L.fill=g||"#e6ebf5",r.borderWidth&&(L.stroke=r.borderColor,L["stroke-width"]=r.borderWidth))),m.zIndex=P,b+="-"+P,(t=i.plotLinesAndBandsGroups[b])||(i.plotLinesAndBandsGroups[b]=t=y.g("plot-"+b).attr(m).add()),p&&(e.svgElem=f=y.path().attr(L).add(t)),c)u=i.getPlotLinePath({value:l,lineWidth:f.strokeWidth(),acrossPanes:r.acrossPanes});else{if(!h)return;u=i.getPlotBandPath(d,o,r)}return(p||!f.d)&&u&&u.length?(f.attr({d:u}),x&&objectEach(x,function(t,i){f.on(i,function(t){x[i].apply(e,[t])})})):f&&(u?(f.show(!0),f.animate({d:u})):f.d&&(f.hide(),a&&(e.label=a=a.destroy()))),s&&(defined(s.text)||defined(s.formatter))&&u&&u.length&&i.width>0&&i.height>0&&!u.isFlat?(s=merge({align:n&&h&&"center",x:n?!h&&4:10,verticalAlign:!n&&h&&"middle",y:n?h?16:10:h?6:-4,rotation:n&&!h&&90},s),this.renderLabel(s,u,h,P)):a&&a.hide(),e},renderLabel:function(t,e,i,n){var r,s,a,o,d,l,h=this.label,c=this.axis.chart.renderer;h||((r={align:t.textAlign||t.align,rotation:t.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(t.className||"")}).zIndex=n,l=this.getLabelText(t),this.label=h=c.text(l,0,0,t.useHTML).attr(r).add(),this.axis.chart.styledMode||h.css(t.style)),s=e.xBounds||[e[1],e[4],i?e[6]:e[1]],a=e.yBounds||[e[2],e[5],i?e[7]:e[2]],o=arrayMin(s),d=arrayMin(a),h.align(t,!1,{x:o,y:d,width:arrayMax(s)-o,height:arrayMax(a)-d}),h.show(!0)},getLabelText:function(t){return defined(t.formatter)?t.formatter.call(this):t.text},destroy:function(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)}},extend(Axis.prototype,{getPlotBandPath:function(t,e){var i,n,r=this.getPlotLinePath({value:e,force:!0,acrossPanes:this.options.acrossPanes}),s=this.getPlotLinePath({value:t,force:!0,acrossPanes:this.options.acrossPanes}),a=[],o=this.horiz,d=1,l=t<this.min&&e<this.min||t>this.max&&e>this.max;if(s&&r)for(l&&(n=s.toString()===r.toString(),d=0),i=0;i<s.length;i+=6)o&&r[i+1]===s[i+1]?(r[i+1]+=d,r[i+4]+=d):o||r[i+2]!==s[i+2]||(r[i+2]+=d,r[i+5]+=d),a.push("M",s[i+1],s[i+2],"L",s[i+4],s[i+5],r[i+4],r[i+5],r[i+1],r[i+2],"z"),a.isFlat=n;else s=null;return a},addPlotBand:function(t){return this.addPlotBandOrLine(t,"plotBands")},addPlotLine:function(t){return this.addPlotBandOrLine(t,"plotLines")},addPlotBandOrLine:function(t,e){var i=new H.PlotLineOrBand(this,t).render(),n=this.userOptions;if(i){if(e){var r=n[e]||[];r.push(t),n[e]=r}this.plotLinesAndBands.push(i)}return i},removePlotBandOrLine:function(t){for(var e=this.plotLinesAndBands,i=this.options,n=this.userOptions,r=e.length;r--;)e[r].id===t&&e[r].destroy();[i.plotLines||[],n.plotLines||[],i.plotBands||[],n.plotBands||[]].forEach(function(e){for(r=e.length;r--;)e[r].id===t&&erase(e,e[r])})},removePlotBand:function(t){this.removePlotBandOrLine(t)},removePlotLine:function(t){this.removePlotBandOrLine(t)}});