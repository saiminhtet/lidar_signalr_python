"use strict";import H from"./Globals.js";import U from"./Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,erase=U.erase,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isString=U.isString,objectEach=U.objectEach,pick=U.pick,splat=U.splat,syncTimeout=U.syncTimeout;import"./Options.js";import"./Legend.js";import"./Point.js";import"./SvgRenderer.js";var addEvent=H.addEvent,animObject=H.animObject,correctFloat=H.correctFloat,defaultOptions=H.defaultOptions,defaultPlotOptions=H.defaultPlotOptions,fireEvent=H.fireEvent,LegendSymbolMixin=H.LegendSymbolMixin,merge=H.merge,Point=H.Point,removeEvent=H.removeEvent,SVGElement=H.SVGElement,win=H.win;H.Series=H.seriesType("line",null,{lineWidth:2,allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},marker:{lineWidth:0,lineColor:"#ffffff",enabledThreshold:2,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:50},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",formatter:function(){return null===this.y?"":H.numberFormat(this.y,-1)},padding:5,style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:50},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,isCartesian:!0,parallelArrays:["x","y"],pointClass:Point,requireSorting:!0,sorted:!0,init:function(t,i){fireEvent(this,"init",{options:i});var e,s,r=this,o=t.series;this.eventOptions=this.eventOptions||{},r.chart=t,r.options=i=r.setOptions(i),r.linkedSeries=[],r.bindAxes(),extend(r,{name:i.name,state:"",visible:!1!==i.visible,selected:!0===i.selected}),e=i.events,objectEach(e,function(t,i){H.isFunction(t)&&r.eventOptions[i]!==t&&(H.isFunction(r.eventOptions[i])&&removeEvent(r,i,r.eventOptions[i]),r.eventOptions[i]=t,addEvent(r,i,t))}),(e&&e.click||i.point&&i.point.events&&i.point.events.click||i.allowPointSelect)&&(t.runTrackerClick=!0),r.getColor(),r.getSymbol(),r.parallelArrays.forEach(function(t){r[t+"Data"]||(r[t+"Data"]=[])}),r.points||r.data||r.setData(i.data,!1),r.isCartesian&&(t.hasCartesianSeries=!0),o.length&&(s=o[o.length-1]),r._i=pick(s&&s._i,-1)+1,t.orderSeries(this.insert(o)),fireEvent(this,"afterInit")},insert:function(t){var i,e=this.options.index;if(isNumber(e)){for(i=t.length;i--;)if(e>=pick(t[i].options.index,t[i]._i)){t.splice(i+1,0,this);break}-1===i&&t.unshift(this),i+=1}else t.push(this);return pick(i,t.length-1)},bindAxes:function(){var t,i=this,e=i.options,s=i.chart;fireEvent(this,"bindAxes",null,function(){(i.axisTypes||[]).forEach(function(r){s[r].forEach(function(s){t=s.options,(e[r]===t.index||void 0!==e[r]&&e[r]===t.id||void 0===e[r]&&0===t.index)&&(i.insert(s.series),i[r]=s,s.isDirty=!0)}),i[r]||i.optionalAxis===r||H.error(18,!0,s)})})},updateParallelArrays:function(t,i){var e=t.series,s=arguments,r=isNumber(i)?function(s){var r="y"===s&&e.toYData?e.toYData(t):t[s];e[s+"Data"][i]=r}:function(t){Array.prototype[i].apply(e[t+"Data"],Array.prototype.slice.call(s,2))};e.parallelArrays.forEach(r)},hasData:function(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&this.yData&&this.yData.length>0},autoIncrement:function(){var t,i,e=this.options,s=this.xIncrement,r=e.pointIntervalUnit,o=this.chart.time;return s=pick(s,e.pointStart,0),this.pointInterval=i=pick(this.pointInterval,e.pointInterval,1),r&&(t=new o.Date(s),"day"===r?o.set("Date",t,o.get("Date",t)+i):"month"===r?o.set("Month",t,o.get("Month",t)+i):"year"===r&&o.set("FullYear",t,o.get("FullYear",t)+i),i=t.getTime()-s),this.xIncrement=s+i,s},setOptions:function(t){var i,e,s,r=this.chart,o=r.options,n=o.plotOptions,a=r.userOptions||{},h=merge(t),l=r.styledMode,p={plotOptions:n,userOptions:h};fireEvent(this,"setOptions",p);var c=p.plotOptions[this.type],d=a.plotOptions||{};return this.userOptions=p.userOptions,i=merge(c,n.series,a.plotOptions&&a.plotOptions[this.type],h),this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions.series&&defaultOptions.plotOptions.series.tooltip,defaultOptions.plotOptions[this.type].tooltip,o.tooltip.userOptions,n.series&&n.series.tooltip,n[this.type].tooltip,h.tooltip),this.stickyTracking=pick(h.stickyTracking,d[this.type]&&d[this.type].stickyTracking,d.series&&d.series.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||i.stickyTracking),null===c.marker&&delete i.marker,this.zoneAxis=i.zoneAxis,e=this.zones=(i.zones||[]).slice(),!i.negativeColor&&!i.negativeFillColor||i.zones||(s={value:i[this.zoneAxis+"Threshold"]||i.threshold||0,className:"highcharts-negative"},l||(s.color=i.negativeColor,s.fillColor=i.negativeFillColor),e.push(s)),e.length&&defined(e[e.length-1].value)&&e.push(l?{}:{color:this.color,fillColor:this.fillColor}),fireEvent(this,"afterSetOptions",{options:i}),i},getName:function(){return pick(this.options.name,"Series "+(this.index+1))},getCyclic:function(t,i,e){var s,r,o=this.chart,n=this.userOptions,a=t+"Index",h=t+"Counter",l=e?e.length:pick(o.options.chart[t+"Count"],o[t+"Count"]);i||(r=pick(n[a],n["_"+a]),defined(r)?s=r:(o.series.length||(o[h]=0),n["_"+a]=s=o[h]%l,o[h]+=1),e&&(i=e[s])),void 0!==s&&(this[a]=s),this[t]=i},getColor:function(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.options.color=null:this.getCyclic("color",this.options.color||defaultPlotOptions[this.type].color,this.chart.options.colors)},getSymbol:function(){var t=this.options.marker;this.getCyclic("symbol",t.symbol,this.chart.options.symbols)},findPointIndex:function(t,i){var e,s,r,o=t.id,n=t.x,a=this.points;return o&&void 0!==(r=(e=this.chart.get(o))&&e.index)&&(s=!0),void 0===r&&isNumber(n)&&(r=this.xData.indexOf(n,i)),-1!==r&&void 0!==r&&this.cropped&&(r=r>=this.cropStart?r-this.cropStart:r),!s&&a[r]&&a[r].touched&&(r=void 0),r},drawLegendSymbol:LegendSymbolMixin.drawLineMarker,updateData:function(t){var i,e,s,r,o=this.options,n=this.points,a=[],h=this.requireSorting,l=t.length===n.length,p=!0;if(this.xIncrement=null,t.forEach(function(t,e){var s,p,c=defined(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{};s=c.x,(c.id||isNumber(s))&&(-1===(p=this.findPointIndex(c,r))||void 0===p?a.push(t):n[p]&&t!==o.data[p]?(n[p].update(t,!1,null,!1),n[p].touched=!0,h&&(r=p+1)):n[p]&&(n[p].touched=!0),l&&e===p&&!this.hasDerivedData||(i=!0))},this),i)for(e=n.length;e--;)(s=n[e])&&!s.touched&&s.remove(!1);else l?t.forEach(function(t,i){n[i].update&&t!==n[i].y&&n[i].update(t,!1,null,!1)}):p=!1;return n.forEach(function(t){t&&(t.touched=!1)}),!!p&&(a.forEach(function(t){this.addPoint(t,!1,null,null,!1)},this),!0)},setData:function(t,i,e,s){var r,o,n,a,h=this,l=h.points,p=l&&l.length||0,c=h.options,d=h.chart,u=null,f=h.xAxis,g=c.turboThreshold,m=this.xData,y=this.yData,x=h.pointArrayMap,v=x&&x.length,k=c.keys,b=0,A=1;if(r=(t=t||[]).length,i=pick(i,!0),!1!==s&&r&&p&&!h.cropped&&!h.hasGroupedData&&h.visible&&!h.isSeriesBoosting&&(a=this.updateData(t)),!a){if(h.xIncrement=null,h.colorCounter=0,this.parallelArrays.forEach(function(t){h[t+"Data"].length=0}),g&&r>g)if(u=h.getFirstValidPoint(t),isNumber(u))for(o=0;o<r;o++)m[o]=this.autoIncrement(),y[o]=t[o];else if(isArray(u))if(v)for(o=0;o<r;o++)n=t[o],m[o]=n[0],y[o]=n.slice(1,v+1);else for(k&&(b=(b=k.indexOf("x"))>=0?b:0,A=(A=k.indexOf("y"))>=0?A:1),o=0;o<r;o++)n=t[o],m[o]=n[b],y[o]=n[A];else H.error(12,!1,d);else for(o=0;o<r;o++)void 0!==t[o]&&(n={series:h},h.pointClass.prototype.applyOptions.apply(n,[t[o]]),h.updateParallelArrays(n,o));for(y&&isString(y[0])&&H.error(14,!0,d),h.data=[],h.options.data=h.userOptions.data=t,o=p;o--;)l[o]&&l[o].destroy&&l[o].destroy();f&&(f.minRange=f.userMinRange),h.isDirty=d.isDirtyBox=!0,h.isDirtyData=!!l,e=!1}"point"===c.legendType&&(this.processData(),this.generatePoints()),i&&d.redraw(e)},processData:function(t){var i,e,s,r,o,n,a,h,l=this.xData,p=this.yData,c=l.length,d=0,u=this.xAxis,f=this.options,g=f.cropThreshold,m=this.getExtremesFromAll||f.getExtremesFromAll,y=this.isCartesian,x=u&&u.val2lin,v=u&&u.isLog,k=this.requireSorting;if(y&&!this.isDirty&&!u.isDirty&&!this.yAxis.isDirty&&!t)return!1;for(u&&(a=(n=u.getExtremes()).min,h=n.max),y&&this.sorted&&!m&&(!g||c>g||this.forceCrop)&&(l[c-1]<a||l[0]>h?(l=[],p=[]):this.yData&&(l[0]<a||l[c-1]>h)&&(l=(i=this.cropData(this.xData,this.yData,a,h)).xData,p=i.yData,d=i.start,e=!0)),o=l.length||1;--o;)(s=v?x(l[o])-x(l[o-1]):l[o]-l[o-1])>0&&(void 0===r||s<r)?r=s:s<0&&k&&(H.error(15,!1,this.chart),k=!1);this.cropped=e,this.cropStart=d,this.processedXData=l,this.processedYData=p,this.closestPointRange=this.basePointRange=r},cropData:function(t,i,e,s,r){var o,n,a=t.length,h=0,l=a;for(r=pick(r,this.cropShoulder),o=0;o<a;o++)if(t[o]>=e){h=Math.max(0,o-r);break}for(n=o;n<a;n++)if(t[n]>s){l=n+r;break}return{xData:t.slice(h,l),yData:i.slice(h,l),start:h,end:l}},generatePoints:function(){var t,i,e,s,r=this.options,o=r.data,n=this.data,a=this.processedXData,h=this.processedYData,l=this.pointClass,p=a.length,c=this.cropStart||0,d=this.hasGroupedData,u=r.keys,f=[];if(!n&&!d){var g=[];g.length=o.length,n=this.data=g}for(u&&d&&(this.options.keys=!1),s=0;s<p;s++)i=c+s,d?((e=(new l).init(this,[a[s]].concat(splat(h[s])))).dataGroup=this.groupMap[s],e.dataGroup.options&&(e.options=e.dataGroup.options,extend(e,e.dataGroup.options),delete e.dataLabels)):(e=n[i])||void 0===o[i]||(n[i]=e=(new l).init(this,o[i],a[s])),e&&(e.index=i,f[s]=e);if(this.options.keys=u,n&&(p!==(t=n.length)||d))for(s=0;s<t;s++)s!==c||d||(s+=p),n[s]&&(n[s].destroyElements(),n[s].plotX=void 0);this.data=n,this.points=f,fireEvent(this,"afterGeneratePoints")},getXExtremes:function(t){return{min:arrayMin(t),max:arrayMax(t)}},getExtremes:function(t){var i,e,s,r,o,n,a,h,l=this.xAxis,p=this.yAxis,c=this.processedXData||this.xData,d=[],u=0,f=0,g=0,m=this.requireSorting?this.cropShoulder:0,y=!!p&&p.positiveValuesOnly;for(i=(t=t||this.stackedYData||this.processedYData||[]).length,l&&(f=(e=l.getExtremes()).min,g=e.max),a=0;a<i;a++)if(o=c[a],n=t[a],s=(isNumber(n)||isArray(n))&&(n.length||n>0||!y),r=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!l||(c[a+m]||o)>=f&&(c[a-m]||o)<=g,s&&r)if(h=n.length)for(;h--;)isNumber(n[h])&&(d[u++]=n[h]);else d[u++]=n;this.dataMin=arrayMin(d),this.dataMax=arrayMax(d),fireEvent(this,"afterGetExtremes")},getFirstValidPoint:function(t){for(var i=null,e=t.length,s=0;null===i&&s<e;)i=t[s],s++;return i},translate:function(){this.processedXData||this.processData(),this.generatePoints();var t,i,e,s,r,o=this.options,n=o.stacking,a=this.xAxis,h=a.categories,l=this.yAxis,p=this.points,c=p.length,d=!!this.modifyValue,u=this.pointPlacementToXValue(),f=isNumber(u),g=o.threshold,m=o.startFromThreshold?g:0,y=this.zoneAxis||"y",x=Number.MAX_VALUE;function v(t){return Math.min(Math.max(-1e5,t),1e5)}for(t=0;t<c;t++){var k,b,A=p[t],D=A.x,E=A.y,C=A.low,P=n&&l.stacks[(this.negStacks&&E<(m?0:g)?"-":"")+this.stackKey];l.positiveValuesOnly&&null!==E&&E<=0&&(A.isNull=!0),A.plotX=i=correctFloat(v(a.translate(D,0,0,0,1,u,"flags"===this.type))),n&&this.visible&&P&&P[D]&&(r=this.getStackIndicator(r,D,this.index),A.isNull||(b=(k=P[D]).points[r.key])),isArray(b)&&(C=b[0],E=b[1],C===m&&r.key===P[D].base&&(C=pick(isNumber(g)&&g,l.min)),l.positiveValuesOnly&&C<=0&&(C=null),A.total=A.stackTotal=k.total,A.percentage=k.total&&A.y/k.total*100,A.stackY=E,this.irregularWidths||k.setOffset(this.pointXOffset||0,this.barW||0)),A.yBottom=defined(C)?v(l.translate(C,0,1,0,1)):null,d&&(E=this.modifyValue(E,A)),A.plotY=e="number"==typeof E&&E!==1/0?v(l.translate(E,0,1,0,1)):void 0,A.isInside=void 0!==e&&e>=0&&e<=l.len&&i>=0&&i<=a.len,A.clientX=f?correctFloat(a.translate(D,0,0,0,1,u)):i,A.negative=A[y]<(o[y+"Threshold"]||g||0),A.category=h&&void 0!==h[A.x]?h[A.x]:A.x,A.isNull||(void 0!==s&&(x=Math.min(x,Math.abs(i-s))),s=i),A.zone=this.zones.length&&A.getZone()}this.closestPointRangePx=x,fireEvent(this,"afterTranslate")},getValidPoints:function(t,i,e){var s=this.chart;return(t||this.points||[]).filter(function(t){return!(i&&!s.isInsidePlot(t.plotX,t.plotY,s.inverted))&&(e||!t.isNull)})},getClipBox:function(t,i){var e,s=this.options,r=this.chart,o=r.inverted,n=this.xAxis,a=n&&this.yAxis;return t&&!1===s.clip&&a?e=o?{y:-r.chartWidth+a.len+a.pos,height:r.chartWidth,width:r.chartHeight,x:-r.chartHeight+n.len+n.pos}:{y:-a.pos,height:r.chartHeight,width:r.chartWidth,x:-n.pos}:(e=this.clipBox||r.clipBox,i&&(e.width=r.plotSizeX,e.x=0)),i?{width:e.width,x:e.x}:e},setClip:function(t){var i=this.chart,e=this.options,s=i.renderer,r=i.inverted,o=this.clipBox,n=this.getClipBox(t),a=this.sharedClipKey||["_sharedClip",t&&t.duration,t&&t.easing,n.height,e.xAxis,e.yAxis].join(","),h=i[a],l=i[a+"m"];h||(t&&(n.width=0,r&&(n.x=i.plotSizeX+(!1!==e.clip?0:i.plotTop)),i[a+"m"]=l=s.clipRect(r?i.plotSizeX+99:-99,r?-i.plotLeft:-i.plotTop,99,r?i.chartWidth:i.chartHeight)),i[a]=h=s.clipRect(n),h.count={length:0}),t&&(h.count[this.index]||(h.count[this.index]=!0,h.count.length+=1)),(!1!==e.clip||t)&&(this.group.clip(t||o?h:i.clipRect),this.markerGroup.clip(l),this.sharedClipKey=a),t||(h.count[this.index]&&(delete h.count[this.index],h.count.length-=1),0===h.count.length&&a&&i[a]&&(o||(i[a]=i[a].destroy()),i[a+"m"]&&(i[a+"m"]=i[a+"m"].destroy())))},animate:function(t){var i,e,s,r=this.chart,o=animObject(this.options.animation);t?this.setClip(o):(i=r[e=this.sharedClipKey],s=this.getClipBox(o,!0),i&&i.animate(s,o),r[e+"m"]&&r[e+"m"].animate({width:s.width+99,x:s.x-(r.inverted?0:99)},o),this.animate=null)},afterAnimate:function(){this.setClip(),fireEvent(this,"afterAnimate"),this.finishedAnimating=!0},drawPoints:function(){var t,i,e,s,r,o,n,a,h,l=this.points,p=this.chart,c=this.options.marker,d=this[this.specialGroup]||this.markerGroup,u=this.xAxis,f=pick(c.enabled,!(u&&!u.isRadial)||null,this.closestPointRangePx>=c.enabledThreshold*c.radius);if(!1!==c.enabled||this._hasPointMarkers)for(t=0;t<l.length;t++)if(s=(e=(i=l[t]).graphic)?"animate":"attr",r=i.marker||{},o=!!i.marker,n=f&&void 0===r.enabled||r.enabled,a=!1!==i.isInside,n&&!i.isNull){var g=pick(r.symbol,this.symbol);h=this.markerAttribs(i,i.selected&&"select"),e?e[a?"show":"hide"](a).animate(h):a&&(h.width>0||i.hasImage)&&(i.graphic=e=p.renderer.symbol(g,h.x,h.y,h.width,h.height,o?r:c).add(d)),e&&!p.styledMode&&e[s](this.pointAttribs(i,i.selected&&"select")),e&&e.addClass(i.getClassName(),!0)}else e&&(i.graphic=e.destroy())},markerAttribs:function(t,i){var e,s,r,o=this.options.marker,n=t.marker||{},a=n.symbol||o.symbol,h=pick(n.radius,o.radius);return i&&(e=o.states[i],s=n.states&&n.states[i],h=pick(s&&s.radius,e&&e.radius,h+(e&&e.radiusPlus||0))),t.hasImage=a&&0===a.indexOf("url"),t.hasImage&&(h=0),r={x:Math.floor(t.plotX)-h,y:t.plotY-h},h&&(r.width=r.height=2*h),r},pointAttribs:function(t,i){var e,s,r,o,n=this.options.marker,a=t&&t.options,h=a&&a.marker||{},l=this.color,p=a&&a.color,c=t&&t.color,d=pick(h.lineWidth,n.lineWidth),u=t&&t.zone&&t.zone.color,f=1;return l=p||u||c||l,r=h.fillColor||n.fillColor||l,o=h.lineColor||n.lineColor||l,(i=i||"normal")&&(e=n.states[i],s=h.states&&h.states[i]||{},d=pick(s.lineWidth,e.lineWidth,d+pick(s.lineWidthPlus,e.lineWidthPlus,0)),r=s.fillColor||e.fillColor||r,o=s.lineColor||e.lineColor||o,f=pick(s.opacity,e.opacity,f)),{stroke:o,"stroke-width":d,fill:r,opacity:f}},destroy:function(t){var i,e,s,r=this,o=r.chart,n=/AppleWebKit\/533/.test(win.navigator.userAgent),a=r.data||[];for(fireEvent(r,"destroy"),t||removeEvent(r),(r.axisTypes||[]).forEach(function(t){(s=r[t])&&s.series&&(erase(s.series,r),s.isDirty=s.forceRedraw=!0)}),r.legendItem&&r.chart.legend.destroyItem(r),i=a.length;i--;)(e=a[i])&&e.destroy&&e.destroy();r.points=null,H.clearTimeout(r.animationTimeout),objectEach(r,function(t,i){t instanceof SVGElement&&!t.survive&&t[n&&"group"===i?"hide":"destroy"]()}),o.hoverSeries===r&&(o.hoverSeries=null),erase(o.series,r),o.orderSeries(),objectEach(r,function(i,e){t&&"hcEvents"===e||delete r[e]})},getGraphPath:function(t,i,e){var s,r,o=this,n=o.options,a=n.step,h=[],l=[];return(s=(t=t||o.points).reversed)&&t.reverse(),(a={right:1,center:2}[a]||a&&3)&&s&&(a=4-a),!n.connectNulls||i||e||(t=this.getValidPoints(t)),t.forEach(function(s,p){var c,d=s.plotX,u=s.plotY,f=t[p-1];(s.leftCliff||f&&f.rightCliff)&&!e&&(r=!0),s.isNull&&!defined(i)&&p>0?r=!n.connectNulls:s.isNull&&!i?r=!0:(0===p||r?c=["M",s.plotX,s.plotY]:o.getPointSpline?c=o.getPointSpline(t,s,p):a?(c=1===a?["L",f.plotX,u]:2===a?["L",(f.plotX+d)/2,f.plotY,"L",(f.plotX+d)/2,u]:["L",d,f.plotY]).push("L",d,u):c=["L",d,u],l.push(s.x),a&&(l.push(s.x),2===a&&l.push(s.x)),h.push.apply(h,c),r=!1)}),h.xMap=l,o.graphPath=h,h},drawGraph:function(){var t=this,i=this.options,e=(this.gappedPath||this.getGraphPath).call(this),s=this.chart.styledMode,r=[["graph","highcharts-graph"]];s||r[0].push(i.lineColor||this.color||"#cccccc",i.dashStyle),(r=t.getZonesGraphs(r)).forEach(function(r,o){var n,a=r[0],h=t[a],l=h?"animate":"attr";h?(h.endX=t.preventGraphAnimation?null:e.xMap,h.animate({d:e})):e.length&&(t[a]=h=t.chart.renderer.path(e).addClass(r[1]).attr({zIndex:1}).add(t.group)),h&&!s&&(n={stroke:r[2],"stroke-width":i.lineWidth,fill:t.fillGraph&&t.color||"none"},r[3]?n.dashstyle=r[3]:"square"!==i.linecap&&(n["stroke-linecap"]=n["stroke-linejoin"]="round"),h[l](n).shadow(o<2&&i.shadow)),h&&(h.startX=e.xMap,h.isArea=e.isArea)})},getZonesGraphs:function(t){return this.zones.forEach(function(i,e){var s=["zone-graph-"+e,"highcharts-graph highcharts-zone-graph-"+e+" "+(i.className||"")];this.chart.styledMode||s.push(i.color||this.color,i.dashStyle||this.options.dashStyle),t.push(s)},this),t},applyZones:function(){var t,i,e,s,r,o,n,a,h,l=this,p=this.chart,c=p.renderer,d=this.zones,u=this.clips||[],f=this.graph,g=this.area,m=Math.max(p.chartWidth,p.chartHeight),y=this[(this.zoneAxis||"y")+"Axis"],x=p.inverted,v=!1;d.length&&(f||g)&&y&&void 0!==y.min?(r=y.reversed,o=y.horiz,f&&!this.showLine&&f.hide(),g&&g.hide(),s=y.getExtremes(),d.forEach(function(d,k){t=r?o?p.plotWidth:0:o?0:y.toPixels(s.min)||0,t=Math.min(Math.max(pick(i,t),0),m),i=Math.min(Math.max(Math.round(y.toPixels(pick(d.value,s.max),!0)||0),0),m),v&&(t=i=y.toPixels(s.max)),n=Math.abs(t-i),a=Math.min(t,i),h=Math.max(t,i),y.isXAxis?(e={x:x?h:a,y:0,width:n,height:m},o||(e.x=p.plotHeight-e.x)):(e={x:0,y:x?h:a,width:m,height:n},o&&(e.y=p.plotWidth-e.y)),x&&c.isVML&&(e=y.isXAxis?{x:0,y:r?a:h,height:e.width,width:p.chartWidth}:{x:e.y-p.plotLeft-p.spacingBox.x,y:0,width:e.height,height:p.chartHeight}),u[k]?u[k].animate(e):u[k]=c.clipRect(e),f&&l["zone-graph-"+k].clip(u[k]),g&&l["zone-area-"+k].clip(u[k]),v=d.value>s.max,l.resetZones&&0===i&&(i=void 0)}),this.clips=u):l.visible&&(f&&f.show(!0),g&&g.show(!0))},invertGroups:function(t){var i,e=this,s=e.chart;function r(){["group","markerGroup"].forEach(function(i){e[i]&&(s.renderer.isVML&&e[i].attr({width:e.yAxis.len,height:e.xAxis.len}),e[i].width=e.yAxis.len,e[i].height=e.xAxis.len,e[i].invert(t))})}e.xAxis&&(i=addEvent(s,"resize",r),addEvent(e,"destroy",i),r(),e.invertGroups=r)},plotGroup:function(t,i,e,s,r){var o=this[t],n=!o;return n&&(this[t]=o=this.chart.renderer.g().attr({zIndex:s||.1}).add(r)),o.addClass("highcharts-"+i+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(defined(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(o.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),o.attr({visibility:e})[n?"attr":"animate"](this.getPlotBox()),o},getPlotBox:function(){var t=this.chart,i=this.xAxis,e=this.yAxis;return t.inverted&&(i=e,e=this.xAxis),{translateX:i?i.left:t.plotLeft,translateY:e?e.top:t.plotTop,scaleX:1,scaleY:1}},render:function(){var t,i=this,e=i.chart,s=i.options,r=!!i.animate&&e.renderer.isSVG&&animObject(s.animation).duration,o=i.visible?"inherit":"hidden",n=s.zIndex,a=i.hasRendered,h=e.seriesGroup,l=e.inverted;fireEvent(this,"render"),t=i.plotGroup("group","series",o,n,h),i.markerGroup=i.plotGroup("markerGroup","markers",o,n,h),r&&i.animate(!0),t.inverted=!(!i.isCartesian&&!i.invertable)&&l,i.drawGraph&&(i.drawGraph(),i.applyZones()),i.visible&&i.drawPoints(),i.drawDataLabels&&i.drawDataLabels(),i.redrawPoints&&i.redrawPoints(),i.drawTracker&&!1!==i.options.enableMouseTracking&&i.drawTracker(),i.invertGroups(l),!1===s.clip||i.sharedClipKey||a||t.clip(e.clipRect),r&&i.animate(),a||(i.animationTimeout=syncTimeout(function(){i.afterAnimate()},r||0)),i.isDirty=!1,i.hasRendered=!0,fireEvent(i,"afterRender")},redraw:function(){var t=this.chart,i=this.isDirty||this.isDirtyData,e=this.group,s=this.xAxis,r=this.yAxis;e&&(t.inverted&&e.attr({width:t.plotWidth,height:t.plotHeight}),e.animate({translateX:pick(s&&s.left,t.plotLeft),translateY:pick(r&&r.top,t.plotTop)})),this.translate(),this.render(),i&&delete this.kdTree},kdAxisArray:["clientX","plotY"],searchPoint:function(t,i){var e=this.xAxis,s=this.yAxis,r=this.chart.inverted;return this.searchKDTree({clientX:r?e.len-t.chartY+e.pos:t.chartX-e.pos,plotY:r?s.len-t.chartX+s.pos:t.chartY-s.pos},i,t)},buildKDTree:function(t){this.buildingKdTree=!0;var i=this,e=i.options.findNearestPointBy.indexOf("y")>-1?2:1;delete i.kdTree,syncTimeout(function(){i.kdTree=function t(e,s,r){var o,n,a=e&&e.length;if(a)return o=i.kdAxisArray[s%r],e.sort(function(t,i){return t[o]-i[o]}),{point:e[n=Math.floor(a/2)],left:t(e.slice(0,n),s+1,r),right:t(e.slice(n+1),s+1,r)}}(i.getValidPoints(null,!i.directTouch),e,e),i.buildingKdTree=!1},i.options.kdNow||t&&"touchstart"===t.type?0:1)},searchKDTree:function(t,i,e){var s=this,r=this.kdAxisArray[0],o=this.kdAxisArray[1],n=i?"distX":"dist",a=s.options.findNearestPointBy.indexOf("y")>-1?2:1;if(this.kdTree||this.buildingKdTree||this.buildKDTree(e),this.kdTree)return function t(i,e,a,h){var l,p,c,d,u,f,g,m,y,x=e.point,v=s.kdAxisArray[a%h],k=x;return g=x,m=defined((f=i)[r])&&defined(g[r])?Math.pow(f[r]-g[r],2):null,y=(m||0)+((defined(f[o])&&defined(g[o])?Math.pow(f[o]-g[o],2):null)||0),g.dist=defined(y)?Math.sqrt(y):Number.MAX_VALUE,g.distX=defined(m)?Math.sqrt(m):Number.MAX_VALUE,c=(l=i[v]-x[v])<0?"right":"left",e[p=l<0?"left":"right"]&&(k=(d=t(i,e[p],a+1,h))[n]<k[n]?d:x),e[c]&&Math.sqrt(l*l)<k[n]&&(k=(u=t(i,e[c],a+1,h))[n]<k[n]?u:k),k}(t,this.kdTree,a,a)},pointPlacementToXValue:function(){var t=this.xAxis,i=this.options.pointPlacement;return"between"===i&&(i=t.reversed?-.5:.5),isNumber(i)&&(i*=pick(this.options.pointRange||t.pointRange)),i}});