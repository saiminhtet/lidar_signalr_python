"use strict";import H from"./Globals.js";import U from"./Utilities.js";var defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isNumber=U.isNumber,pick=U.pick,correctFloat=H.correctFloat,fireEvent=H.fireEvent,merge=H.merge,deg2rad=H.deg2rad;H.Tick=function(t,e,i,s,r){this.axis=t,this.pos=e,this.type=i||"",this.isNew=!0,this.isNewLabel=!0,this.parameters=r||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,i||s||this.addLabel()},H.Tick.prototype={addLabel:function(){var t,e,i,s,r,a=this,o=a.axis,h=o.options,n=o.chart,l=o.categories,d=o.names,c=a.pos,f=pick(a.options&&a.options.labels,h.labels),p=o.tickPositions,g=c===p[0],k=c===p[p.length-1],x=this.parameters.category||(l?pick(l[c],d[c],c):c),m=a.label,b=p.info;o.isDatetimeAxis&&b&&(e=(i=n.time.resolveDTLFormat(h.dateTimeLabelFormats[!h.grid&&b.higherRanks[c]||b.unitName])).main),a.isFirst=g,a.isLast=k,a.formatCtx={axis:o,chart:n,isFirst:g,isLast:k,dateTimeLabelFormat:e,tickPositionInfo:b,value:o.isLog?correctFloat(o.lin2log(x)):x,pos:c},t=o.labelFormatter.call(a.formatCtx,this.formatCtx),(r=i&&i.list)&&(a.shortenLabel=function(){for(s=0;s<r.length;s++)if(m.attr({text:o.labelFormatter.call(extend(a.formatCtx,{dateTimeLabelFormat:r[s]}))}),m.getBBox().width<o.getSlotWidth(a)-2*pick(f.padding,5))return;m.attr({text:""})}),defined(m)?m&&m.textStr!==t&&(!m.textWidth||f.style&&f.style.width||m.styles.width||m.css({width:null}),m.attr({text:t}),m.textPxLength=m.getBBox().width):(a.label=m=defined(t)&&f.enabled?n.renderer.text(t,0,0,f.useHTML).add(o.labelGroup):null,m&&(n.styledMode||m.css(merge(f.style)),m.textPxLength=m.getBBox().width),a.rotation=0)},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(t){var e,i,s=this.axis,r=s.options.labels,a=t.x,o=s.chart.chartWidth,h=s.chart.spacing,n=pick(s.labelLeft,Math.min(s.pos,h[3])),l=pick(s.labelRight,Math.max(s.isRadial?0:s.pos+s.len,o-h[1])),d=this.label,c=this.rotation,f={left:0,center:.5,right:1}[s.labelAlign||d.attr("align")],p=d.getBBox().width,g=s.getSlotWidth(this),k=g,x=f,m=1,b={};c||"justify"!==pick(r.overflow,"justify")?c<0&&a-f*p<n?i=Math.round(a/Math.cos(c*deg2rad)-n):c>0&&a+f*p>l&&(i=Math.round((o-a)/Math.cos(c*deg2rad))):(e=a+(1-f)*p,a-f*p<n?k=t.x+k*(1-f)-n:e>l&&(k=l-t.x+k*f,m=-1),(k=Math.min(g,k))<g&&"center"===s.labelAlign&&(t.x+=m*(g-k-x*(g-Math.min(p,k)))),(p>k||s.autoRotation&&(d.styles||{}).width)&&(i=k)),i&&(this.shortenLabel?this.shortenLabel():(b.width=Math.floor(i),(r.style||{}).textOverflow||(b.textOverflow="ellipsis"),d.css(b)))},getPosition:function(t,e,i,s){var r,a=this.axis,o=a.chart,h=s&&o.oldChartHeight||o.chartHeight;return(r={x:t?H.correctFloat(a.translate(e+i,null,null,s)+a.transB):a.left+a.offset+(a.opposite?(s&&o.oldChartWidth||o.chartWidth)-a.right-a.left:0),y:t?h-a.bottom+a.offset-(a.opposite?a.height:0):H.correctFloat(h-a.translate(e+i,null,null,s)-a.transB)}).y=Math.max(Math.min(r.y,1e5),-1e5),fireEvent(this,"afterGetPosition",{pos:r}),r},getLabelPosition:function(t,e,i,s,r,a,o,h){var n,l=this.axis,d=l.transA,c=l.isLinked&&l.linkedParent?l.linkedParent.reversed:l.reversed,f=l.staggerLines,p=l.tickRotCorr||{x:0,y:0},g=r.y,k=s||l.reserveSpaceDefault?0:-l.labelOffset*("center"===l.labelAlign?.5:1),x={};return defined(g)||(g=0===l.side?i.rotation?-8:-i.getBBox().height:2===l.side?p.y+8:Math.cos(i.rotation*deg2rad)*(p.y-i.getBBox(!1,0).height/2)),t=t+r.x+k+p.x-(a&&s?a*d*(c?-1:1):0),e=e+g-(a&&!s?a*d*(c?1:-1):0),f&&(n=o/(h||1)%f,l.opposite&&(n=f-n-1),e+=n*(l.labelOffset/f)),x.x=t,x.y=Math.round(e),fireEvent(this,"afterGetLabelPosition",{pos:x,tickmarkOffset:a,index:o}),x},getMarkPath:function(t,e,i,s,r,a){return a.crispLine(["M",t,e,"L",t+(r?0:-i),e+(r?i:0)],s)},renderGridLine:function(t,e,i){var s,r=this.axis,a=r.options,o=this.gridLine,h={},n=this.pos,l=this.type,d=pick(this.tickmarkOffset,r.tickmarkOffset),c=r.chart.renderer,f=l?l+"Grid":"grid",p=a[f+"LineWidth"],g=a[f+"LineColor"],k=a[f+"LineDashStyle"];o||(r.chart.styledMode||(h.stroke=g,h["stroke-width"]=p,k&&(h.dashstyle=k)),l||(h.zIndex=1),t&&(e=0),this.gridLine=o=c.path().attr(h).addClass("highcharts-"+(l?l+"-":"")+"grid-line").add(r.gridGroup)),o&&(s=r.getPlotLinePath({value:n+d,lineWidth:o.strokeWidth()*i,force:"pass",old:t}))&&o[t||this.isNew?"attr":"animate"]({d:s,opacity:e})},renderMark:function(t,e,i){var s=this.axis,r=s.options,a=s.chart.renderer,o=this.type,h=o?o+"Tick":"tick",n=s.tickSize(h),l=this.mark,d=!l,c=t.x,f=t.y,p=pick(r[h+"Width"],!o&&s.isXAxis?1:0),g=r[h+"Color"];n&&(s.opposite&&(n[0]=-n[0]),d&&(this.mark=l=a.path().addClass("highcharts-"+(o?o+"-":"")+"tick").add(s.axisGroup),s.chart.styledMode||l.attr({stroke:g,"stroke-width":p})),l[d?"attr":"animate"]({d:this.getMarkPath(c,f,n[0],l.strokeWidth()*i,s.horiz,a),opacity:e}))},renderLabel:function(t,e,i,s){var r=this.axis,a=r.horiz,o=r.options,h=this.label,n=o.labels,l=n.step,d=pick(this.tickmarkOffset,r.tickmarkOffset),c=!0,f=t.x,p=t.y;h&&isNumber(f)&&(h.xy=t=this.getLabelPosition(f,p,h,a,n,d,s,l),this.isFirst&&!this.isLast&&!pick(o.showFirstLabel,1)||this.isLast&&!this.isFirst&&!pick(o.showLastLabel,1)?c=!1:!a||n.step||n.rotation||e||0===i||this.handleOverflow(t),l&&s%l&&(c=!1),c&&isNumber(t.y)?(t.opacity=i,h[this.isNewLabel?"attr":"animate"](t),this.isNewLabel=!1):(h.attr("y",-9999),this.isNewLabel=!0))},render:function(t,e,i){var s=this.axis,r=s.horiz,a=this.pos,o=pick(this.tickmarkOffset,s.tickmarkOffset),h=this.getPosition(r,a,o,e),n=h.x,l=h.y,d=r&&n===s.pos+s.len||!r&&l===s.pos?-1:1;i=pick(i,1),this.isActive=!0,this.renderGridLine(e,i,d),this.renderMark(h,i,d),this.renderLabel(h,e,i,t),this.isNew=!1,H.fireEvent(this,"afterRender")},destroy:function(){destroyObjectProperties(this,this.axis)}};