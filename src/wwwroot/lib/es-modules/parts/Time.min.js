"use strict";import Highcharts from"./Globals.js";import U from"./Utilities.js";var defined=U.defined,extend=U.extend,isObject=U.isObject,objectEach=U.objectEach,pick=U.pick,splat=U.splat,H=Highcharts,merge=H.merge,timeUnits=H.timeUnits,win=H.win;Highcharts.Time=function(e){this.update(e,!1)},Highcharts.Time.prototype={defaultOptions:{Date:void 0,getTimezoneOffset:void 0,timezone:void 0,timezoneOffset:0,useUTC:!0},update:function(e){var t=pick(e&&e.useUTC,!0),i=this;this.options=e=merge(!0,this.options||{},e),this.Date=e.Date||win.Date||Date,this.useUTC=t,this.timezoneOffset=t&&e.timezoneOffset,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.variableTimezone=!(t&&!e.getTimezoneOffset&&!e.timezone),this.variableTimezone||this.timezoneOffset?(this.get=function(e,t){var n,s=t.getTime(),o=s-i.getTimezoneOffset(t);return t.setTime(o),n=t["getUTC"+e](),t.setTime(s),n},this.set=function(e,t,n){var s,o,a;"Milliseconds"===e||"Seconds"===e||"Minutes"===e&&t.getTimezoneOffset()%60==0?t["set"+e](n):(o=i.getTimezoneOffset(t),s=t.getTime()-o,t.setTime(s),t["setUTC"+e](n),a=i.getTimezoneOffset(t),s=t.getTime()+a,t.setTime(s))}):t?(this.get=function(e,t){return t["getUTC"+e]()},this.set=function(e,t,i){return t["setUTC"+e](i)}):(this.get=function(e,t){return t["get"+e]()},this.set=function(e,t,i){return t["set"+e](i)})},makeTime:function(e,t,i,n,s,o){var a,r,m;return this.useUTC?(a=this.Date.UTC.apply(0,arguments),a+=r=this.getTimezoneOffset(a),r!==(m=this.getTimezoneOffset(a))?a+=m-r:r-36e5!==this.getTimezoneOffset(a-36e5)||H.isSafari||(a-=36e5)):a=new this.Date(e,t,pick(i,1),pick(n,0),pick(s,0),pick(o,0)).getTime(),a},timezoneOffsetFunction:function(){var e=this,t=this.options,i=win.moment;if(!this.useUTC)return function(e){return 6e4*new Date(e).getTimezoneOffset()};if(t.timezone){if(i)return function(e){return 6e4*-i.tz(e,t.timezone).utcOffset()};H.error(25)}return this.useUTC&&t.getTimezoneOffset?function(e){return 6e4*t.getTimezoneOffset(e)}:function(){return 6e4*(e.timezoneOffset||0)}},dateFormat:function(e,t,i){if(!defined(t)||isNaN(t))return H.defaultOptions.lang.invalidDate||"";e=pick(e,"%Y-%m-%d %H:%M:%S");var n=this,s=new this.Date(t),o=this.get("Hours",s),a=this.get("Day",s),r=this.get("Date",s),m=this.get("Month",s),f=this.get("FullYear",s),u=H.defaultOptions.lang,h=u.weekdays,g=u.shortWeekdays,c=H.pad,T=extend({a:g?g[a]:h[a].substr(0,3),A:h[a],d:c(r),e:c(r,2," "),w:a,b:u.shortMonths[m],B:u.months[m],m:c(m+1),o:m+1,y:f.toString().substr(2,2),Y:f,H:c(o),k:o,I:c(o%12||12),l:o%12||12,M:c(n.get("Minutes",s)),p:o<12?"AM":"PM",P:o<12?"am":"pm",S:c(s.getSeconds()),L:c(Math.floor(t%1e3),3)},H.dateFormats);return objectEach(T,function(i,s){for(;-1!==e.indexOf("%"+s);)e=e.replace("%"+s,"function"==typeof i?i.call(n,t):i)}),i?e.substr(0,1).toUpperCase()+e.substr(1):e},resolveDTLFormat:function(e){return isObject(e,!0)?e:{main:(e=splat(e))[0],from:e[1],to:e[2]}},getTimeTicks:function(e,t,i,n){var s,o,a,r,m=this,f=m.Date,u=[],h={},g=new f(t),c=e.unitRange,T=e.count||1;if(n=pick(n,1),defined(t)){m.set("Milliseconds",g,c>=timeUnits.second?0:T*Math.floor(m.get("Milliseconds",g)/T)),c>=timeUnits.second&&m.set("Seconds",g,c>=timeUnits.minute?0:T*Math.floor(m.get("Seconds",g)/T)),c>=timeUnits.minute&&m.set("Minutes",g,c>=timeUnits.hour?0:T*Math.floor(m.get("Minutes",g)/T)),c>=timeUnits.hour&&m.set("Hours",g,c>=timeUnits.day?0:T*Math.floor(m.get("Hours",g)/T)),c>=timeUnits.day&&m.set("Date",g,c>=timeUnits.month?1:Math.max(1,T*Math.floor(m.get("Date",g)/T))),c>=timeUnits.month&&(m.set("Month",g,c>=timeUnits.year?0:T*Math.floor(m.get("Month",g)/T)),o=m.get("FullYear",g)),c>=timeUnits.year&&(o-=o%T,m.set("FullYear",g,o)),c===timeUnits.week&&(r=m.get("Day",g),m.set("Date",g,m.get("Date",g)-r+n+(r<n?-7:0))),o=m.get("FullYear",g);var d=m.get("Month",g),l=m.get("Date",g),U=m.get("Hours",g);t=g.getTime(),m.variableTimezone&&(a=i-t>4*timeUnits.month||m.getTimezoneOffset(t)!==m.getTimezoneOffset(i));var p=g.getTime();for(s=1;p<i;)u.push(p),c===timeUnits.year?p=m.makeTime(o+s*T,0):c===timeUnits.month?p=m.makeTime(o,d+s*T):!a||c!==timeUnits.day&&c!==timeUnits.week?a&&c===timeUnits.hour&&T>1?p=m.makeTime(o,d,l,U+s*T):p+=c*T:p=m.makeTime(o,d,l+s*T*(c===timeUnits.day?1:7)),s++;u.push(p),c<=timeUnits.hour&&u.length<1e4&&u.forEach(function(e){e%18e5==0&&"000000000"===m.dateFormat("%H%M%S%L",e)&&(h[e]="day")})}return u.info=extend(e,{higherRanks:h,totalRange:c*T}),u}};