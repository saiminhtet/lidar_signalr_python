"use strict";import H from"./Globals.js";import U from"./Utilities.js";var extend=U.extend,pick=U.pick,charts=H.charts,noop=H.noop,Pointer=H.Pointer;extend(Pointer.prototype,{pinchTranslate:function(t,n,a,o,i,h){this.zoomHor&&this.pinchTranslateDirection(!0,t,n,a,o,i,h),this.zoomVert&&this.pinchTranslateDirection(!1,t,n,a,o,i,h)},pinchTranslateDirection:function(t,n,a,o,i,h,e,r){var c,s,l,p,u,d,m=this.chart,x=t?"x":"y",M=t?"X":"Y",f="chart"+M,v=t?"width":"height",T=m["plot"+(t?"Left":"Top")],g=r||1,k=m.inverted,C=m.bounds[t?"h":"v"],P=1===n.length,H=n[0][f],X=a[0][f],Y=!P&&n[1][f],z=!P&&a[1][f],b=function(){!P&&Math.abs(H-Y)>20&&(g=r||Math.abs(X-z)/Math.abs(H-Y)),l=(T-X)/g+H,c=m["plot"+(t?"Width":"Height")]/g};b(),(s=l)<C.min?(s=C.min,p=!0):s+c>C.max&&(s=C.max-c,p=!0),p?(X-=.8*(X-e[x][0]),P||(z-=.8*(z-e[x][1])),b()):e[x]=[X,z],k||(h[x]=l-T,h[v]=c),d=k?t?"scaleY":"scaleX":"scale"+M,u=k?1/g:g,i[v]=c,i[x]=s,o[d]=g,o["translate"+M]=u*T+(X-u*H)},pinch:function(t){var n=this,a=n.chart,o=n.pinchDown,i=t.touches,h=i.length,e=n.lastValidTouch,r=n.hasZoom,c=n.selectionMarker,s={},l=1===h&&(n.inClass(t.target,"highcharts-tracker")&&a.runTrackerClick||n.runChartClick),p={};h>1&&(n.initiated=!0),r&&n.initiated&&!l&&t.preventDefault(),[].map.call(i,function(t){return n.normalize(t)}),"touchstart"===t.type?([].forEach.call(i,function(t,n){o[n]={chartX:t.chartX,chartY:t.chartY}}),e.x=[o[0].chartX,o[1]&&o[1].chartX],e.y=[o[0].chartY,o[1]&&o[1].chartY],a.axes.forEach(function(t){if(t.zoomEnabled){var n=a.bounds[t.horiz?"h":"v"],o=t.minPixelPadding,i=t.toPixels(Math.min(pick(t.options.min,t.dataMin),t.dataMin)),h=t.toPixels(Math.max(pick(t.options.max,t.dataMax),t.dataMax)),e=Math.min(i,h),r=Math.max(i,h);n.min=Math.min(t.pos,e-o),n.max=Math.max(t.pos+t.len,r+o)}}),n.res=!0):n.followTouchMove&&1===h?this.runPointActions(n.normalize(t)):o.length&&(c||(n.selectionMarker=c=extend({destroy:noop,touch:!0},a.plotBox)),n.pinchTranslate(o,i,s,c,p,e),n.hasPinched=r,n.scaleGroups(s,p),n.res&&(n.res=!1,this.reset(!1,0)))},touch:function(t,n){var a,o,i=this.chart;i.index!==H.hoverChartIndex&&this.onContainerMouseLeave({relatedTarget:!0}),H.hoverChartIndex=i.index,1===t.touches.length?(t=this.normalize(t),i.isInsidePlot(t.chartX-i.plotLeft,t.chartY-i.plotTop)&&!i.openMenu?(n&&this.runPointActions(t),"touchmove"===t.type&&(a=!!(o=this.pinchDown)[0]&&Math.sqrt(Math.pow(o[0].chartX-t.chartX,2)+Math.pow(o[0].chartY-t.chartY,2))>=4),pick(a,!0)&&this.pinch(t)):n&&this.reset()):2===t.touches.length&&this.pinch(t)},onContainerTouchStart:function(t){this.zoomOption(t),this.touch(t,!0)},onContainerTouchMove:function(t){this.touch(t)},onDocumentTouchEnd:function(t){charts[H.hoverChartIndex]&&charts[H.hoverChartIndex].pointer.drop(t)}});