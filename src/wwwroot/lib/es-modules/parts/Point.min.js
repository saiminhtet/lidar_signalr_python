"use strict";import Highcharts from"./Globals.js";import U from"./Utilities.js";var Point,defined=U.defined,erase=U.erase,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,pick=U.pick,H=Highcharts,fireEvent=H.fireEvent,format=H.format,uniqueKey=H.uniqueKey,removeEvent=H.removeEvent;Highcharts.Point=Point=function(){},Highcharts.Point.prototype={init:function(t,e,i){return this.series=t,this.applyOptions(e,i),this.id=defined(this.id)?this.id:uniqueKey(),this.resolveColor(),t.chart.pointCount++,fireEvent(this,"afterInit"),this},resolveColor:function(){var t,e,i=this.series,o=i.chart.options.chart.colorCount,s=i.chart.styledMode;s||this.options.color||(this.color=i.color),i.options.colorByPoint?(s||(t=i.options.colors||i.chart.options.colors,this.color=this.color||t[i.colorCounter],o=t.length),e=i.colorCounter,i.colorCounter++,i.colorCounter===o&&(i.colorCounter=0)):e=i.colorIndex,this.colorIndex=pick(this.colorIndex,e)},applyOptions:function(t,e){var i=this.series,o=i.options.pointValKey||i.pointValKey;return t=Point.prototype.optionsToObject.call(this,t),extend(this,t),this.options=this.options?extend(this.options,t):t,t.group&&delete this.group,t.dataLabels&&delete this.dataLabels,o&&(this.y=this[o]),this.isNull=pick(this.isValid&&!this.isValid(),null===this.x||!isNumber(this.y)),this.formatPrefix=this.isNull?"null":"point",this.selected&&(this.state="select"),"name"in this&&void 0===e&&i.xAxis&&i.xAxis.hasNames&&(this.x=i.xAxis.nameToX(this)),void 0===this.x&&i&&(this.x=void 0===e?i.autoIncrement(this):e),this},setNestedProperty:function(t,e,i){return i.split(".").reduce(function(t,i,o,s){var r=s.length-1===o;return t[i]=r?e:isObject(t[i],!0)?t[i]:{},t[i]},t),t},optionsToObject:function(t){var e,i={},o=this.series,s=o.options.keys,r=s||o.pointArrayMap||["y"],n=r.length,h=0,a=0;if(isNumber(t)||null===t)i[r[0]]=t;else if(isArray(t))for(!s&&t.length>n&&("string"===(e=typeof t[0])?i.name=t[0]:"number"===e&&(i.x=t[0]),h++);a<n;)s&&void 0===t[h]||(r[a].indexOf(".")>0?H.Point.prototype.setNestedProperty(i,t[h],r[a]):i[r[a]]=t[h]),h++,a++;else"object"==typeof t&&(i=t,t.dataLabels&&(o._hasPointLabels=!0),t.marker&&(o._hasPointMarkers=!0));return i},getClassName:function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(void 0!==this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")},getZone:function(){var t,e=this.series,i=e.zones,o=e.zoneAxis||"y",s=0;for(t=i[s];this[o]>=t.value;)t=i[++s];return this.nonZonedColor||(this.nonZonedColor=this.color),t&&t.color&&!this.options.color?this.color=t.color:this.color=this.nonZonedColor,t},hasNewShapeType:function(){return this.graphic&&this.graphic.element.nodeName!==this.shapeType},destroy:function(){var t,e=this.series.chart,i=e.hoverPoints;for(t in e.pointCount--,i&&(this.setState(),erase(i,this),i.length||(e.hoverPoints=null)),this===e.hoverPoint&&this.onMouseOut(),(this.graphic||this.dataLabel||this.dataLabels)&&(removeEvent(this),this.destroyElements()),this.legendItem&&e.legend.destroyItem(this),this)this[t]=null},destroyElements:function(t){var e,i,o=this,s=[];for((t=t||{graphic:1,dataLabel:1}).graphic&&s.push("graphic","shadowGroup"),t.dataLabel&&s.push("dataLabel","dataLabelUpper","connector"),i=s.length;i--;)e=s[i],o[e]&&(o[e]=o[e].destroy());["dataLabel","connector"].forEach(function(e){var i=e+"s";t[e]&&o[i]&&(o[i].forEach(function(t){t.element&&t.destroy()}),delete o[i])})},getLabelConfig:function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(t){var e=this.series,i=e.tooltipOptions,o=pick(i.valueDecimals,""),s=i.valuePrefix||"",r=i.valueSuffix||"";return e.chart.styledMode&&(t=e.chart.tooltip.styledModeFormat(t)),(e.pointArrayMap||["y"]).forEach(function(e){e="{point."+e,(s||r)&&(t=t.replace(RegExp(e+"}","g"),s+e+"}"+r)),t=t.replace(RegExp(e+"}","g"),e+":,."+o+"f}")}),format(t,{point:this,series:this.series},e.chart.time)},firePointEvent:function(t,e,i){var o=this,s=this.series.options;(s.point.events[t]||o.options&&o.options.events&&o.options.events[t])&&this.importEvents(),"click"===t&&s.allowPointSelect&&(i=function(t){o.select&&o.select(null,t.ctrlKey||t.metaKey||t.shiftKey)}),fireEvent(this,t,e,i)},visible:!0};