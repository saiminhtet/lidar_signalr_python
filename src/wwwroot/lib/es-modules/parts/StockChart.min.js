"use strict";import H from"./Globals.js";import U from"./Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,extend=U.extend,isNumber=U.isNumber,isString=U.isString,pick=U.pick,splat=U.splat;import"./Chart.js";import"./Axis.js";import"./Point.js";import"./Pointer.js";import"./Series.js";import"./SvgRenderer.js";import"./Navigator.js";import"./Scrollbar.js";import"./RangeSelector.js";var addEvent=H.addEvent,Axis=H.Axis,Chart=H.Chart,format=H.format,merge=H.merge,Point=H.Point,Renderer=H.Renderer,Series=H.Series,SVGRenderer=H.SVGRenderer,VMLRenderer=H.VMLRenderer,seriesProto=Series.prototype,seriesInit=seriesProto.init,seriesProcessData=seriesProto.processData,pointTooltipFormatter=Point.prototype.tooltipFormatter;H.StockChart=H.stockChart=function(t,i,e){var s,r=isString(t)||t.nodeName,a=arguments[r?1:0],o=a,n=a.series,h=H.getOptions(),l=pick(a.navigator&&a.navigator.enabled,h.navigator.enabled,!0),p=l?{startOnTick:!1,endOnTick:!1}:null;return a.xAxis=splat(a.xAxis||{}).map(function(t,i){return merge({minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0},h.xAxis,h.xAxis&&h.xAxis[i],t,{type:"datetime",categories:null},p)}),a.yAxis=splat(a.yAxis||{}).map(function(t,i){return s=pick(t.opposite,!0),merge({labels:{y:-2},opposite:s,showLastLabel:!(!t.categories&&"category"!==t.type),title:{text:null}},h.yAxis,h.yAxis&&h.yAxis[i],t)}),a.series=null,(a=merge({chart:{panning:!0,pinchType:"x"},navigator:{enabled:l},scrollbar:{enabled:pick(h.scrollbar.enabled,!0)},rangeSelector:{enabled:pick(h.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(h.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},a,{isStock:!0})).series=o.series=n,r?new Chart(t,a,e):new Chart(a,i)},addEvent(Series,"setOptions",function(t){var i,e=this;function s(t){return H.seriesTypes[t]&&e instanceof H.seriesTypes[t]}this.chart.options.isStock&&(s("column")||s("columnrange")?i={borderWidth:0,shadow:!1}:!s("line")||s("scatter")||s("sma")||(i={marker:{enabled:!1,radius:2}}),i&&(t.plotOptions[this.type]=merge(t.plotOptions[this.type],i)))}),addEvent(Axis,"autoLabelAlign",function(t){var i,e=this.chart,s=this.options,r=e._labelPanes=e._labelPanes||{},a=this.options.labels;this.chart.options.isStock&&"yAxis"===this.coll&&!r[i=s.top+","+s.height]&&a.enabled&&(15===a.x&&(a.x=0),void 0===a.align&&(a.align="right"),r[i]=this,t.align="right",t.preventDefault())}),addEvent(Axis,"destroy",function(){var t=this.chart,i=this.options&&this.options.top+","+this.options.height;i&&t._labelPanes&&t._labelPanes[i]===this&&delete t._labelPanes[i]}),addEvent(Axis,"getPlotLinePath",function(t){var i,e,s,r,a,o,n,h,l,p=this,d=this.isLinked&&!this.series?this.linkedParent.series:this.series,c=p.chart,x=c.renderer,f=p.left,u=p.top,g=[],m=[],y=t.translatedValue,b=t.value,A=t.force;(c.options.isStock&&!1!==t.acrossPanes&&"xAxis"===p.coll||"yAxis"===p.coll)&&(t.preventDefault(),n=p.coll,h="xAxis"===n?"yAxis":"xAxis",l=p.options[h],m=isNumber(l)?[c[h][l]]:isString(l)?[c.get(l)]:d.map(function(t){return t[h]}),(p.isXAxis?c.yAxis:c.xAxis).forEach(function(t){if(!defined(t.options.id)||-1===t.options.id.indexOf("navigator")){var i=t.isXAxis?"yAxis":"xAxis",e=defined(t.options[i])?c[i][t.options[i]]:c[i][0];p===e&&m.push(t)}}),a=m.length?[]:[p.isXAxis?c.yAxis[0]:c.xAxis[0]],m.forEach(function(t){-1!==a.indexOf(t)||H.find(a,function(i){return i.pos===t.pos&&i.len===t.len})||a.push(t)}),o=pick(y,p.translate(b,null,null,t.old)),isNumber(o)&&(p.horiz?a.forEach(function(t){var a;e=t.pos,r=e+t.len,i=s=Math.round(o+p.transB),"pass"!==A&&(i<f||i>f+p.width)&&(A?i=s=Math.min(Math.max(f,i),f+p.width):a=!0),a||g.push("M",i,e,"L",s,r)}):a.forEach(function(t){var a;i=t.pos,s=i+t.len,e=r=Math.round(u+p.height-o),"pass"!==A&&(e<u||e>u+p.height)&&(A?e=r=Math.min(Math.max(u,e),p.top+p.height):a=!0),a||g.push("M",i,e,"L",s,r)})),t.path=g.length>0?x.crispPolyLine(g,t.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(t,i){var e;for(e=0;e<t.length;e+=6)t[e+1]===t[e+4]&&(t[e+1]=t[e+4]=Math.round(t[e+1])-i%2/2),t[e+2]===t[e+5]&&(t[e+2]=t[e+5]=Math.round(t[e+2])+i%2/2);return t},Renderer===VMLRenderer&&(VMLRenderer.prototype.crispPolyLine=SVGRenderer.prototype.crispPolyLine),addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(t){if(defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var i,e,s,r,a,o,n,h,l=this.chart,p=this.options.crosshair.label,d=this.horiz,c=this.opposite,x=this.left,f=this.top,u=this.crossLabel,g=p.format,m="",y="inside"===this.options.tickPosition,b=!1!==this.crosshair.snap,A=0,v=t.e||this.cross&&this.cross.e,P=t.point,k=this.lin2log;this.isLog?(n=k(this.min),h=k(this.max)):(n=this.min,h=this.max),a=d?"center":c?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",u||(u=this.crossLabel=l.renderer.label(null,null,null,p.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:p.align||a,padding:pick(p.padding,8),r:pick(p.borderRadius,3),zIndex:2}).add(this.labelGroup),l.styledMode||u.attr({fill:p.backgroundColor||this.series[0]&&this.series[0].color||"#666666",stroke:p.borderColor||"","stroke-width":p.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},p.style))),d?(i=b?P.plotX+x:v.chartX,e=f+(c?0:this.height)):(i=c?this.width+x:0,e=b?P.plotY+f:v.chartY),g||p.formatter||(this.isDatetimeAxis&&(m="%b %d, %Y"),g="{value"+(m?":"+m:"")+"}"),o=b?P[this.isXAxis?"x":"y"]:this.toValue(d?v.chartX:v.chartY),u.attr({text:g?format(g,{value:o},l.time):p.formatter.call(this,o),x:i,y:e,visibility:o<n||o>h?"hidden":"visible"}),s=u.getBBox(),d?(y&&!c||!y&&c)&&(e=u.y-s.height):e=u.y-s.height/2,r=d?{left:x-s.x,right:x+this.width-s.x}:{left:"left"===this.labelAlign?x:0,right:"right"===this.labelAlign?x+this.width:l.chartWidth},u.translateX<r.left&&(A=r.left-u.translateX),u.translateX+s.width>=r.right&&(A=-(u.translateX+s.width-r.right)),u.attr({x:i+A,y:e,anchorX:d?i:this.opposite?0:l.chartWidth,anchorY:d?this.opposite?l.chartHeight:0:e+s.height/2})}}),seriesProto.init=function(){seriesInit.apply(this,arguments),this.setCompare(this.options.compare)},seriesProto.setCompare=function(t){this.modifyValue="value"===t||"percent"===t?function(i,e){var s=this.compareValue;return void 0!==i&&void 0!==s?("value"===t?i-=s:i=i/s*100-(100===this.options.compareBase?0:100),e&&(e.change=i),i):0}:null,this.userOptions.compare=t,this.chart.hasRendered&&(this.isDirty=!0)},seriesProto.processData=function(t){var i,e,s,r,a,o=-1,n=!0===this.options.compareStart?0:1;if(seriesProcessData.apply(this,arguments),this.xAxis&&this.processedYData)for(e=this.processedXData,r=(s=this.processedYData).length,this.pointArrayMap&&(o=this.pointArrayMap.indexOf(this.options.pointValKey||this.pointValKey||"y")),i=0;i<r-n;i++)if(a=s[i]&&o>-1?s[i][o]:s[i],isNumber(a)&&e[i+n]>=this.xAxis.min&&0!==a){this.compareValue=a;break}},addEvent(Series,"afterGetExtremes",function(){if(this.modifyValue){var t=[this.modifyValue(this.dataMin),this.modifyValue(this.dataMax)];this.dataMin=arrayMin(t),this.dataMax=arrayMax(t)}}),Axis.prototype.setCompare=function(t,i){this.isXAxis||(this.series.forEach(function(i){i.setCompare(t)}),pick(i,!0)&&this.chart.redraw())},Point.prototype.tooltipFormatter=function(t){return t=t.replace("{point.change}",(this.change>0?"+":"")+H.numberFormat(this.change,pick(this.series.tooltipOptions.changeDecimals,2))),pointTooltipFormatter.apply(this,[t])},addEvent(Series,"render",function(){var t,i=this.chart;if((!i.is3d||!i.is3d())&&!i.polar&&this.xAxis&&!this.xAxis.isRadial){if(t=this.yAxis.len,this.xAxis.axisLine){var e=i.plotTop+i.plotHeight-this.yAxis.pos-this.yAxis.len,s=Math.floor(this.xAxis.axisLine.strokeWidth()/2);e>=0&&(t-=Math.max(s-e,0))}!this.clipBox&&this.animate?(this.clipBox=merge(i.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=t):i[this.sharedClipKey]&&(i[this.sharedClipKey].animate({width:this.xAxis.len,height:t}),i[this.sharedClipKey+"m"]&&i[this.sharedClipKey+"m"].animate({width:this.xAxis.len}))}}),addEvent(Chart,"update",function(t){var i=t.options;"scrollbar"in i&&this.navigator&&(merge(!0,this.options.scrollbar,i.scrollbar),this.navigator.update({},!1),delete i.scrollbar)});