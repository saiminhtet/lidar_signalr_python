"use strict";import H from"./Globals.js";import U from"./Utilities.js";var defined=U.defined,isNumber=U.isNumber,pick=U.pick,setAnimation=U.setAnimation;import"./ColumnSeries.js";import"../mixins/centered-series.js";import"./Legend.js";import"./Options.js";import"./Point.js";import"./Series.js";var addEvent=H.addEvent,CenteredSeriesMixin=H.CenteredSeriesMixin,getStartAndEndRadians=CenteredSeriesMixin.getStartAndEndRadians,LegendSymbolMixin=H.LegendSymbolMixin,merge=H.merge,noop=H.noop,Point=H.Point,Series=H.Series,seriesType=H.seriesType,seriesTypes=H.seriesTypes,fireEvent=H.fireEvent;seriesType("pie","line",{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,connectorPadding:5,distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},softConnector:!0,x:0,connectorShape:"fixedOffset",crookDistance:"70%"},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}},{isCartesian:!1,requireSorting:!1,directTouch:!0,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttribs:seriesTypes.column.prototype.pointAttribs,animate:function(t){var e=this,i=e.points,n=e.startAngleRad;t||(i.forEach(function(t){var i=t.graphic,a=t.shapeArgs;i&&(i.attr({r:t.startR||e.center[3]/2,start:n,end:n}),i.animate({r:a.r,start:a.start,end:a.end},e.options.animation))}),e.animate=null)},hasData:function(){return!!this.processedXData.length},updateTotals:function(){var t,e,i=0,n=this.points,a=n.length,s=this.options.ignoreHiddenPoint;for(t=0;t<a;t++)e=n[t],i+=s&&!e.visible?0:e.isNull?0:e.y;for(this.total=i,t=0;t<a;t++)(e=n[t]).percentage=i>0&&(e.visible||!s)?e.y/i*100:0,e.total=i},generatePoints:function(){Series.prototype.generatePoints.call(this),this.updateTotals()},getX:function(t,e,i){var n,a=this.center,s=this.radii?this.radii[i.index]:a[2]/2;return n=Math.asin(Math.max(Math.min((t-a[1])/(s+i.labelDistance),1),-1)),a[0]+(e?-1:1)*(Math.cos(n)*(s+i.labelDistance))+(i.labelDistance>0?(e?-1:1)*this.options.dataLabels.padding:0)},translate:function(t){this.generatePoints();var e,i,n,a,s,r,o,l,d=0,h=this.options,c=h.slicedOffset,p=c+(h.borderWidth||0),g=getStartAndEndRadians(h.startAngle,h.endAngle),u=this.startAngleRad=g.start,f=(this.endAngleRad=g.end)-u,y=this.points,m=h.dataLabels.distance,b=h.ignoreHiddenPoint,v=y.length;for(t||(this.center=t=this.getCenter()),o=0;o<v;o++)l=y[o],i=u+d*f,b&&!l.visible||(d+=l.percentage/100),n=u+d*f,l.shapeType="arc",l.shapeArgs={x:t[0],y:t[1],r:t[2]/2,innerR:t[3]/2,start:Math.round(1e3*i)/1e3,end:Math.round(1e3*n)/1e3},l.labelDistance=pick(l.options.dataLabels&&l.options.dataLabels.distance,m),l.labelDistance=H.relativeLength(l.labelDistance,l.shapeArgs.r),this.maxLabelDistance=Math.max(this.maxLabelDistance||0,l.labelDistance),(a=(n+i)/2)>1.5*Math.PI?a-=2*Math.PI:a<-Math.PI/2&&(a+=2*Math.PI),l.slicedTranslation={translateX:Math.round(Math.cos(a)*c),translateY:Math.round(Math.sin(a)*c)},s=Math.cos(a)*t[2]/2,r=Math.sin(a)*t[2]/2,l.tooltipPos=[t[0]+.7*s,t[1]+.7*r],l.half=a<-Math.PI/2||a>Math.PI/2?1:0,l.angle=a,e=Math.min(p,l.labelDistance/5),l.labelPosition={natural:{x:t[0]+s+Math.cos(a)*l.labelDistance,y:t[1]+r+Math.sin(a)*l.labelDistance},final:{},alignment:l.labelDistance<0?"center":l.half?"right":"left",connectorPosition:{breakAt:{x:t[0]+s+Math.cos(a)*e,y:t[1]+r+Math.sin(a)*e},touchingSliceAt:{x:t[0]+s,y:t[1]+r}}};fireEvent(this,"afterTranslate")},drawEmpty:function(){var t,e,i=this.options;0===this.total?(t=this.center[0],e=this.center[1],this.graph||(this.graph=this.chart.renderer.circle(t,e,0).addClass("highcharts-graph").add(this.group)),this.graph.animate({"stroke-width":i.borderWidth,cx:t,cy:e,r:this.center[2]/2,fill:i.fillColor||"none",stroke:i.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())},redrawPoints:function(){var t,e,i,n,a=this,s=a.chart,r=s.renderer,o=a.options.shadow;this.drawEmpty(),!o||a.shadowGroup||s.styledMode||(a.shadowGroup=r.g("shadow").attr({zIndex:-1}).add(a.group)),a.points.forEach(function(l){var d={};if(e=l.graphic,!l.isNull&&e){if(n=l.shapeArgs,t=l.getTranslate(),!s.styledMode){var h=l.shadowGroup;o&&!h&&(h=l.shadowGroup=r.g("shadow").add(a.shadowGroup)),h&&h.attr(t),i=a.pointAttribs(l,l.selected&&"select")}l.delayedRendering?(e.setRadialReference(a.center).attr(n).attr(t),s.styledMode||e.attr(i).attr({"stroke-linejoin":"round"}).shadow(o,h),l.delayedRendering=!1):(e.setRadialReference(a.center),s.styledMode||merge(!0,d,i),merge(!0,d,n,t),e.animate(d)),e.attr({visibility:l.visible?"inherit":"hidden"}),e.addClass(l.getClassName())}else e&&(l.graphic=e.destroy())})},drawPoints:function(){var t=this.chart.renderer;this.points.forEach(function(e){e.graphic||(e.graphic=t[e.shapeType](e.shapeArgs).add(e.series.group),e.delayedRendering=!0)})},searchPoint:noop,sortByAngle:function(t,e){t.sort(function(t,i){return void 0!==t.angle&&(i.angle-t.angle)*e})},drawLegendSymbol:LegendSymbolMixin.drawRectangle,getCenter:CenteredSeriesMixin.getCenter,getSymbol:noop,drawGraph:null},{init:function(){Point.prototype.init.apply(this,arguments);var t,e=this;return e.name=pick(e.name,"Slice"),addEvent(e,"select",t=function(t){e.slice("select"===t.type)}),addEvent(e,"unselect",t),e},isValid:function(){return isNumber(this.y)&&this.y>=0},setVisible:function(t,e){var i=this,n=i.series,a=n.chart,s=n.options.ignoreHiddenPoint;e=pick(e,s),t!==i.visible&&(i.visible=i.options.visible=t=void 0===t?!i.visible:t,n.options.data[n.data.indexOf(i)]=i.options,["graphic","dataLabel","connector","shadowGroup"].forEach(function(e){i[e]&&i[e][t?"show":"hide"](!0)}),i.legendItem&&a.legend.colorizeItem(i,t),t||"hover"!==i.state||i.setState(""),s&&(n.isDirty=!0),e&&a.redraw())},slice:function(t,e,i){var n=this.series,a=n.chart;setAnimation(i,a),e=pick(e,!0),this.sliced=this.options.sliced=t=defined(t)?t:!this.sliced,n.options.data[n.data.indexOf(this)]=this.options,this.graphic.animate(this.getTranslate()),this.shadowGroup&&this.shadowGroup.animate(this.getTranslate())},getTranslate:function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}},haloPath:function(t){var e=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(e.x,e.y,e.r+t,e.r+t,{innerR:e.r-1,start:e.start,end:e.end})},connectorShapes:{fixedOffset:function(t,e,i){var n=e.breakAt,a=e.touchingSliceAt,s=i.softConnector?["C",t.x+("left"===t.alignment?-5:5),t.y,2*n.x-a.x,2*n.y-a.y,n.x,n.y]:["L",n.x,n.y];return["M",t.x,t.y].concat(s).concat(["L",a.x,a.y])},straight:function(t,e){var i=e.touchingSliceAt;return["M",t.x,t.y,"L",i.x,i.y]},crookedLine:function(t,e,i){var n=e.touchingSliceAt,a=this.series,s=a.center[0],r=a.chart.plotWidth,o=a.chart.plotLeft,l=t.alignment,d=this.shapeArgs.r,h=H.relativeLength(i.crookDistance,1),c="left"===l?s+d+(r+o-s-d)*(1-h):o+(s-d)*h,p=["L",c,t.y];return("left"===l?c>t.x||c<n.x:c<t.x||c>n.x)&&(p=[]),["M",t.x,t.y].concat(p).concat(["L",n.x,n.y])}},getConnectorPath:function(){var t=this.labelPosition,e=this.series.options.dataLabels,i=e.connectorShape,n=this.connectorShapes;return n[i]&&(i=n[i]),i.call(this,{x:t.final.x,y:t.final.y,alignment:t.alignment},t.connectorPosition,e)}});